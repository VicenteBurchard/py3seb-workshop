{"version":2,"kind":"Notebook","sha256":"eb71f95616680a5f42e53a231dbe1e2395998d292fdce877331a46645e008166","slug":"seb-introduction","location":"/104-3SEB_introduction.ipynb","dependencies":[],"frontmatter":{"title":"How 3SEB works?","short_title":"3SEB","subtitle":"Quick overview of 3SEB and and its py3SEB code implementation","keywords":["TSEB","radiation","Beer-Lambert law","albedo"],"authors":[{"nameParsed":{"literal":"Vicente Burchard-Levine","given":"Vicente","family":"Burchard-Levine"},"name":"Vicente Burchard-Levine","orcid":"0000-0003-0222-8706","email":"vburchard@ica.csic.es","affiliations":["Insituto de Ciencias Agrarias","CSIC"],"id":"contributors-104-3SEB_introduction-generated-uid-0","corresponding":true},{"nameParsed":{"literal":"Héctor Nieto","given":"Héctor","family":"Nieto"},"name":"Héctor Nieto","orcid":"0000-0003-4250-6424","email":"hector.nieto@ica.csic.es","affiliations":["Instituto de Ciencias Agrarias, ICA","CSIC"],"id":"contributors-104-3SEB_introduction-generated-uid-1"},{"nameParsed":{"literal":"Benjamin Mary","given":"Benjamin","family":"Mary"},"name":"Benjamin Mary","orcid":"0000-0001-7199-2885","affiliations":["Insituto de Ciencias Agrarias","CSIC"],"id":"contributors-104-3SEB_introduction-generated-uid-2"}],"affiliations":[{"id":"Insituto de Ciencias Agrarias","name":"Insituto de Ciencias Agrarias"},{"id":"CSIC","name":"CSIC"},{"id":"Instituto de Ciencias Agrarias, ICA","name":"Instituto de Ciencias Agrarias, ICA"}],"license":{"content":{"id":"CC-BY-SA-4.0","url":"https://creativecommons.org/licenses/by-sa/4.0/","name":"Creative Commons Attribution Share Alike 4.0 International","free":true,"CC":true}},"subject":"Tutorial","kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"open_access":false,"github":"https://github.com/VicenteBurchard/py3SEB-workshop","numbering":{"title":{"offset":1}},"edit_url":"https://github.com/VicenteBurchard/py3SEB-workshop/blob/master/104-3SEB_introduction.ipynb","thumbnail":"/ThreeSource_scheme_v-ad605e6541a7d294f0576867bfc1327a.png","thumbnailOptimized":"/ThreeSource_scheme_v-ad605e6541a7d294f0576867bfc1327a.webp","exports":[{"format":"ipynb","filename":"104-3SEB_introduction.ipynb","url":"/104-3SEB_introductio-84e94484f1af679470fd2339cf7d56c7.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Summary","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gu51q3BLEX"}],"identifier":"summary","label":"Summary","html_id":"summary","implicit":true,"key":"uyAbB12ELa"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"This interactive Jupyter Notebook has the objective of showing the implemenation of 3SEB-PT model in the ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"TuQPx79a2M"},{"type":"link","url":"https://github.com/VicenteBurchard/py3SEB","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"strong","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"py3SEB package","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"d1oiMQBfkY"}],"key":"ivklMOFia4"}],"urlSource":"https://github.com/VicenteBurchard/py3SEB","error":true,"key":"MbPZvuh2mZ"},{"type":"text","value":".","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"qwgisiDFYl"}],"key":"xtXTT4Fgww"}],"key":"YfyHlmVcJz"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Instructions","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SdSKkHnDPk"}],"identifier":"instructions","label":"Instructions","html_id":"instructions","implicit":true,"key":"TCZtbH9ACe"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Read carefully all the text and follow the instructions.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"rDg20x3KeN"}],"key":"N66RR2xP1i"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Once each section is read, run the jupyter code cell underneath (marked as ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"Yvq7dsR1Oo"},{"type":"inlineCode","value":"In []","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"BOrmjaWCwV"},{"type":"text","value":") by clicking the icon ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"tck9aJCJLT"},{"type":"inlineCode","value":"Run","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"YzPF47Crdi"},{"type":"text","value":", or pressing the keys SHIFT+ENTER of your keyboard. A graphical interface will then display, which allows you to interact with and perform the assigned tasks.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"flJ8UkkWvq"}],"key":"IrcLpQukpv"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"To start, please run the following cell to import all the packages required for this notebook. Once you run the cell below, an acknowledgement message, stating all libraries were correctly imported, should be printed on screen.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"rJZARgEqjn"}],"key":"OfejLbcHuw"}],"key":"cpiYNzmCrL"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from pathlib import Path\nfrom ipywidgets import interact, interactive, fixed, widgets\nfrom IPython.display import display\nimport numpy as np\nfrom pyTSEB import TSEB\nfrom py3seb import py3seb\n\nprint('libraries imported correctly')","key":"WRYd3vbVid"},{"type":"output","id":"TnX59YOJZ3E4OamFMzRX_","data":[],"key":"aMCB7BmO18"}],"key":"iBl18bhHxB"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The 3SEB model","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DNuxa8jcwP"}],"identifier":"the-3seb-model","label":"The 3SEB model","html_id":"the-3seb-model","implicit":true,"key":"YHjFgJne8Y"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The 3SEB model (","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"wXSxyqvKmf"},{"type":"cite","url":"https://doi.org/10.1111/gcb.16002","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Burchard-Levine et al. 2022","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"xmgOfEYMuK"}],"key":"dCCgVMatt5"}],"kind":"narrative","label":"Burchard_Levine_2021","identifier":"https://doi.org/10.1111/gcb.16002","enumerator":"1","key":"V2X9Q1wBsS"},{"type":"text","value":") is an adapted version of the TSEB model ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"aNWtua91Xo"},{"type":"cite","url":"https://doi.org/10.1016/0168-1923(95)02265-Y","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Norman et al. (1995)","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"hPuhpOelRE"}],"key":"NtxKUn4Xpu"}],"kind":"narrative","label":"Norman_1995","identifier":"https://doi.org/10.1016/0168-1923(95)02265-Y","enumerator":"2","key":"sKsHHfl4cc"},{"type":"text","value":", where an additional vegetation source is incorporated into TSEB to better characterize agro-ecosystems with multiple vegetation layers that have distinct structural and physiological features. This adaptation was initially envisioned for savanna-like ecosystems which are characterized by the co-existence of trees and herbaceous species with very different structural and phenological dynamics.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"UABuGVpbyD"}],"key":"COnlM0xFXR"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"However, the 3SEB model structure is also well adapted for perennial tree crops that have cover crops in the interrow, such as vineyards, olive orchards, almonds etc. In principle, the 3SEB model is more suited to represent the complex interactions between a clumped vegetation source planted in rows with an additional herbaceous vegetation source located in the interrows.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"eZA1Gzy70N"}],"key":"fUr3m8sq7N"},{"type":"container","kind":"figure","children":[{"type":"image","url":"/ThreeSource_scheme_v-ad605e6541a7d294f0576867bfc1327a.png","alt":"3SEB resistances scheme","key":"EpHuiESkXl","urlSource":"./input/figures/ThreeSource_scheme_v3_highres.png","urlOptimized":"/ThreeSource_scheme_v-ad605e6541a7d294f0576867bfc1327a.webp"},{"type":"caption","children":[{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"captionNumber","kind":"figure","label":"3seb-scheme","identifier":"3seb-scheme","html_id":"id-3seb-scheme","enumerator":"1","children":[{"type":"text","value":"Figure ","key":"tg90o8nEEQ"},{"type":"text","value":"1","key":"XAoyiFaOhd"},{"type":"text","value":":","key":"C6OW81fyXE"}],"template":"Figure %s:","key":"khMWzNrsmt"},{"type":"text","value":"Three-Source energy balance scheme for transport sensible heat (H). From ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"hZskYMn6FB"},{"type":"cite","url":"https://doi.org/10.1111/gcb.16002","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"strong","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Burchard-Levine et al. 2022","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"tUQ2qy6oLu"}],"key":"vocFQ7hW20"}],"kind":"narrative","label":"Burchard_Levine_2021","identifier":"https://doi.org/10.1111/gcb.16002","enumerator":"1","key":"Xm6joJe4I2"}],"key":"BY5HwkEZuM"}],"key":"IuFBMvl23J"}],"label":"3seb-scheme","identifier":"3seb-scheme","enumerator":"1","html_id":"id-3seb-scheme","key":"vKElqhZjFZ"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"In 3SEB, the energy balance is therefore separated between the vegetation overstory (ov), vegetation understory (un) and soil (s) sources as:","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"FTZu5Tw7s8"}],"key":"E5nMF5pTuF"},{"type":"math","value":"R_{n} & \\approx H + \\lambda E + G\\\\\n  R_{n,ov} & \\approx H_{ov} + \\lambda E_{ov}\\\\\n  R_{n,un} & \\approx H_{un} + \\lambda E_{un}\\\\\n  R_{n,s} & \\approx H_{s} + \\lambda E_{s} + G","label":"eq-eb","identifier":"eq-eb","html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mtable rowspacing=\"0.25em\" columnalign=\"right left\" columnspacing=\"0em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><msub><mi>R</mi><mi>n</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>≈</mo><mi>H</mi><mo>+</mo><mi>λ</mi><mi>E</mi><mo>+</mo><mi>G</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><msub><mi>R</mi><mrow><mi>n</mi><mo separator=\"true\">,</mo><mi>o</mi><mi>v</mi></mrow></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>≈</mo><msub><mi>H</mi><mrow><mi>o</mi><mi>v</mi></mrow></msub><mo>+</mo><mi>λ</mi><msub><mi>E</mi><mrow><mi>o</mi><mi>v</mi></mrow></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><msub><mi>R</mi><mrow><mi>n</mi><mo separator=\"true\">,</mo><mi>u</mi><mi>n</mi></mrow></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>≈</mo><msub><mi>H</mi><mrow><mi>u</mi><mi>n</mi></mrow></msub><mo>+</mo><mi>λ</mi><msub><mi>E</mi><mrow><mi>u</mi><mi>n</mi></mrow></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><msub><mi>R</mi><mrow><mi>n</mi><mo separator=\"true\">,</mo><mi>s</mi></mrow></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>≈</mo><msub><mi>H</mi><mi>s</mi></msub><mo>+</mo><mi>λ</mi><msub><mi>E</mi><mi>s</mi></msub><mo>+</mo><mi>G</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\begin{align*}\nR_{n} &amp; \\approx H + \\lambda E + G\\\\\n  R_{n,ov} &amp; \\approx H_{ov} + \\lambda E_{ov}\\\\\n  R_{n,un} &amp; \\approx H_{un} + \\lambda E_{un}\\\\\n  R_{n,s} &amp; \\approx H_{s} + \\lambda E_{s} + G\n\\end{align*}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:6em;vertical-align:-2.75em;\"></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-r\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.25em;\"><span style=\"top:-5.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-3.91em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\">o</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\">u</span><span class=\"mord mathnormal mtight\">n</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-0.91em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\">s</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.75em;\"><span></span></span></span></span></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:3.25em;\"><span style=\"top:-5.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≈</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\">λ</span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\">G</span></span></span><span style=\"top:-3.91em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≈</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">o</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\">λ</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">o</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≈</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">u</span><span class=\"mord mathnormal mtight\">n</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\">λ</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">u</span><span class=\"mord mathnormal mtight\">n</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-0.91em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≈</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">s</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\">λ</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">s</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\">G</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.75em;\"><span></span></span></span></span></span></span></span></span></span></span></span>","enumerator":"1","html_id":"eq-eb","key":"eb9UA0sl2q"},{"type":"paragraph","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"The energy balance equations are simplified as they neglect additional components of the energy balance that are usually neglected, such as heat advection, storage of energy in the canopy layer or energy for the fixation of CO2, which are not computed by the model.","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"WmWhMg42bQ"}],"key":"rTuTi0Gmgs"},{"type":"paragraph","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"As such, Remote sensing-based Energy Balance Models rely on the ability of the radiometric information to estimate, net radiation, soil heat flux and sensible heat flux to estiamte LE or ET as the residual of the energy balance.","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"AIoHZZv6rj"}],"key":"ryp166tLgm"},{"type":"paragraph","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"To see how py3SEB works we will run several pieces of code to estimate each of the components of the energy balance.","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"kFUBnuhqgW"}],"key":"veQ2CYyy6o"}],"key":"mGoEkYqtR4"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Summary","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bMYoDVOLUO"}],"identifier":"summary","label":"Summary","html_id":"summary-1","implicit":true,"key":"Bd6zdIhrCg"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This notebook will introduce users on how to run the three-source energy balance (3SEB) model in a vineyard site with the presence of cover crops in the interrow. The 3SEB model is more suited to represent the complex interactions between a clumped vegetation source planted in rows with an additional herbaceous vegetation source located in the interrows.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"K6JSIFN8Mk"}],"key":"iwfZojnYeo"},{"type":"container","kind":"figure","children":[{"type":"image","url":"/vineyard-6780d681b5c58b6324900c4ee03f4d77.png","alt":"vineyard","key":"TregbTo76D","urlSource":"./input/figures/vineyard.png","urlOptimized":"/vineyard-6780d681b5c58b6324900c4ee03f4d77.webp"},{"type":"caption","children":[{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"captionNumber","kind":"figure","label":"vineyard","identifier":"vineyard","html_id":"vineyard","enumerator":"2","children":[{"type":"text","value":"Figure ","key":"w8TIFVc45s"},{"type":"text","value":"2","key":"HDxS2JVypU"},{"type":"text","value":":","key":"gC0g4dGRZW"}],"template":"Figure %s:","key":"R2xfEXTM6Y"},{"type":"text","value":"Source elements in a vineyard with cover crop. Similar structure can be found in other perennial crops such as olive orchards, almonods, pistachio, as well as agroforestry systems and savannas.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"z9X2vbZmtH"}],"key":"cJwMRRwuaE"}],"key":"j3L23rGUTH"}],"label":"vineyard","identifier":"vineyard","enumerator":"2","html_id":"vineyard","key":"SYcb8DzFtn"},{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"This exercise will use the 3SEB Python implementation (","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"D8SOCd11cj"},{"type":"link","url":"https://github.com/VicenteBurchard/py3SEB","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"strong","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"py3SEB","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"zd8ZAUPQof"}],"key":"TJX2qyWodc"}],"urlSource":"https://github.com/VicenteBurchard/py3SEB","error":true,"key":"FZliwoBJ9N"},{"type":"text","value":"), which essentially adds an aditional vegetation source to the well-known TSEB model. The code is largely based on ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"jlGYVDn2PK"},{"type":"link","url":"https://github.com/hectornieto/pyTSEB","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"strong","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"pyTSEB","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"IawnJHoHmA"}],"key":"Gh6kDpQmto"}],"urlSource":"https://github.com/hectornieto/pyTSEB","error":true,"key":"Ls2Uh5FuC9"},{"type":"text","value":".","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"qeQMvdV6rO"}],"key":"xEj2dcXopv"},{"type":"paragraph","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"This exercise will make use of data acquired in the context of the GRAPEX project and will replicate some of the results of the analysis performed in ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"GxxNnDZln3"},{"type":"cite","url":"https://doi.org/10.1007/s00271-022-00787-x","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"strong","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Burchard-Levine et al. 2022","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"KmvaMvxEYu"}],"key":"cGBMeEhxUy"}],"kind":"narrative","label":"Burchard_Levine_2022","identifier":"https://doi.org/10.1007/s00271-022-00787-x","enumerator":"3","key":"SuG7mCCGae"},{"type":"text","value":" published in Irrigation Science.","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"icSjUPCFWC"}],"key":"fIqWVehIm0"},{"type":"paragraph","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"For additional information on the 3SEB model, please refer to ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"LaKFMV5lkB"},{"type":"cite","url":"https://doi.org/10.1111/gcb.16002","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"strong","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"Burchard-Levine et al. 2022","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"gPhCPM9CkR"}],"key":"qku72pcFpg"}],"kind":"narrative","label":"Burchard_Levine_2021","identifier":"https://doi.org/10.1111/gcb.16002","enumerator":"1","key":"sZDVWIJbIh"},{"type":"text","value":", published in Global Change Biology, which introduced this model.","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"ycv7zIVWrc"}],"key":"JrAHcfElie"}],"key":"iVNoPd9HzI"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Running ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NDWFyE3dBu"},{"type":"link","url":"https://github.com/hectornieto/3SEB","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"py3SEB","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AUzjOEqXMN"}],"urlSource":"https://github.com/hectornieto/3SEB","error":true,"key":"jbe8dZYvRJ"}],"identifier":"running-py3seb","label":"Running py3SEB","html_id":"running-py3seb","implicit":true,"key":"BNfCxmpJgH"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The first step is to open all relevant files with the necesary data and information to run 3SEB. Basically 3SEB requires the same input forcing as TSEB, and can found in ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"MhheofxWYg"},{"type":"link","url":"./input/meteo/","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"./input/meteo/","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"gUvbM7v4Yv"}],"urlSource":"./input/meteo/","key":"GBD56Pyly0"},{"type":"text","value":" folder. In addition we will also use the same time series of the daily LAI product, stored in  ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NE6GBJoaQx"},{"type":"link","url":"./input/canopy/","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"./input/canopy/","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"fZodbtSh1H"}],"urlSource":"./input/canopy/","key":"hTDtI0uY2R"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"idcPedd1W4"}],"key":"LCwIxxrhXI"},{"type":"admonition","kind":"important","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Important","key":"QIE0Iry0st"}],"key":"AgkYum2Uqc"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"In the article ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"lGp80McFR5"},{"type":"cite","url":"https://doi.org/10.1007/s00271-022-00787-x","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Burchard-Levine et al. 2022","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"cC2hj92JyI"}],"key":"LlI8bgxSFi"}],"kind":"narrative","label":"Burchard_Levine_2022","identifier":"https://doi.org/10.1007/s00271-022-00787-x","enumerator":"3","key":"G2EJ6BKk5v"},{"type":"text","value":", the study concentrated on the Ripperdan 720 sites. It should be noted that only ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"ZuXk0PguXj"},{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Ripperdan 720-3","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"hVFnsEjhIB"}],"key":"bmeFv3MbLH"},{"type":"text","value":" and ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"tBI0d0U8vU"},{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"720-4","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"Xr2f9F606w"}],"key":"yBGKpSsaWU"},{"type":"text","value":" had the presence of cover crops during years 2019 and 2020","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"bnrmqWy9Se"}],"key":"MZQ2MEdg8e"}],"key":"qmjgWMhdAd"},{"type":"container","kind":"table","children":[{"type":"caption","children":[{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"captionNumber","kind":"table","label":"tab-site-description","identifier":"tab-site-description","html_id":"tab-site-description","enumerator":"1","children":[{"type":"text","value":"Table ","key":"RN36FxbC5B"},{"type":"text","value":"1","key":"A5OG7hCn0I"},{"type":"text","value":":","key":"JP0BeX3XsX"}],"template":"Table %s:","key":"rRczGkTUfS"},{"type":"text","value":"Description of GRAPEX sites","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"R1lOM0rMXK"}],"key":"LgNAg4hyrF"}],"key":"bPPKrHAO1i"},{"type":"table","position":{"start":{"line":13,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"tableRow","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"tableCell","header":true,"align":"left","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Site","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"BoZJvNWLR9"}],"key":"SumTQIwWFh"},{"type":"tableCell","header":true,"align":"right","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Latitude","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"LW6C7QPNV5"}],"key":"feQflzRHR0"},{"type":"tableCell","header":true,"align":"right","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Longitude","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"QHKqcoDPGY"}],"key":"wV0TzvW2U6"},{"type":"tableCell","header":true,"align":"right","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Elevation (m)","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"aGSPItqQjv"}],"key":"SQX0BOPLnU"},{"type":"tableCell","header":true,"align":"right","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Row direction (deg.)","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"VH7MIMy0k6"}],"key":"MaQeTKmT9f"},{"type":"tableCell","header":true,"align":"right","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Row spacing (m)","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"kdGNe5ozhe"}],"key":"vRAfw9ek7q"},{"type":"tableCell","header":true,"align":"right","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Min. height (m)","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"cMx59RG1kK"}],"key":"kTdYKc0Zdr"},{"type":"tableCell","header":true,"align":"right","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Max. height (m)","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"vKaxztaRwM"}],"key":"F7tSjNf0v4"},{"type":"tableCell","header":true,"align":"right","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Min. width (m)","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"X87d7AYZDz"}],"key":"fIelzx7t5l"},{"type":"tableCell","header":true,"align":"right","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Max. width (m)","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"o0iUHIBh8X"}],"key":"NKegQHQbGs"},{"type":"tableCell","header":true,"align":"right","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"TA height (m)","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"dSEZ3qHrGg"}],"key":"cay3dDK9iw"},{"type":"tableCell","header":true,"align":"right","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"WS height (m)","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"djIiDmx7t7"}],"key":"z78PemyYSE"}],"key":"CXBasFXkse"},{"type":"tableRow","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"tableCell","align":"left","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Ripperdan 720-1","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"btKsDcxtIt"}],"key":"OhEMioFDG3"},{"type":"tableCell","align":"right","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"36.849","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"wSPoCWJZLa"}],"key":"GpLXU1xDBt"},{"type":"tableCell","align":"right","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"-120.176","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"NhKLInL6hD"}],"key":"WHR6zukAZO"},{"type":"tableCell","align":"right","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"61","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"DKkdssogOn"}],"key":"iCfmmOtkQP"},{"type":"tableCell","align":"right","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"90","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"SireaGlL2k"}],"key":"fcaKYYL3qK"},{"type":"tableCell","align":"right","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"3.35","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"lZzQo8Z06H"}],"key":"LXEy3Vb0RW"},{"type":"tableCell","align":"right","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"1.2","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"e2uWIw37Vq"}],"key":"OzwtbowUMZ"},{"type":"tableCell","align":"right","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"2.2","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"M0ekaJgHjH"}],"key":"WqSWkCYZcg"},{"type":"tableCell","align":"right","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"0.5","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"ABUkANU6Pm"}],"key":"o1Ha8lVOvp"},{"type":"tableCell","align":"right","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"2.25","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"vvuuR89rIX"}],"key":"cdfPhQSDGH"},{"type":"tableCell","align":"right","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"4","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"jTDiaoZO2r"}],"key":"XfV4fdftZh"},{"type":"tableCell","align":"right","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"4","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"vGrhprZYPa"}],"key":"MA5hYOOhuS"}],"key":"DKCSLZYNbX"},{"type":"tableRow","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"tableCell","align":"left","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"Ripperdan 720-2","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"zkGB6HcCTD"}],"key":"i0EMFTnNjY"},{"type":"tableCell","align":"right","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"36.849","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"qA3M5mFT8I"}],"key":"M4PNgD3XpY"},{"type":"tableCell","align":"right","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"-120.174","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"EoMEYEVrAy"}],"key":"LWZwkSkD8X"},{"type":"tableCell","align":"right","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"61","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"YpbN723UM4"}],"key":"axfHgNwPcC"},{"type":"tableCell","align":"right","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"90","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"nPADnj9dhV"}],"key":"HUEN0tmp7o"},{"type":"tableCell","align":"right","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"3.35","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"u0lgrRuiUZ"}],"key":"PqB3bhgH7v"},{"type":"tableCell","align":"right","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"1.2","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"hk2URmd7Af"}],"key":"OvPhOIc9kB"},{"type":"tableCell","align":"right","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"2.2","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"oBgOYOHAyl"}],"key":"rM8cWCTRWH"},{"type":"tableCell","align":"right","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"0.5","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"YTRH4oxGsN"}],"key":"VycKSCh1rE"},{"type":"tableCell","align":"right","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"2.25","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"SFtMVggqsF"}],"key":"sS3keF6dUc"},{"type":"tableCell","align":"right","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"4","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"h0PPu41RTy"}],"key":"W7ThK3vlKt"},{"type":"tableCell","align":"right","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"4","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"iVLpwZ7v0M"}],"key":"ZVMAqVUMrK"}],"key":"ZOyDPQ4BiS"},{"type":"tableRow","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"tableCell","align":"left","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Ripperdan 720-3","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"zEJhiTnWIf"}],"key":"H5s4zTNKnG"},{"type":"tableCell","align":"right","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"36.848","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"t2XWgmuHAs"}],"key":"Jf8a2umPYi"},{"type":"tableCell","align":"right","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"-120.176","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"ZefwAIGnqE"}],"key":"LAuvefSnD2"},{"type":"tableCell","align":"right","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"61","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"exOPZHAaph"}],"key":"gC7Sk2FAS3"},{"type":"tableCell","align":"right","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"90","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"MkPD3lCOqR"}],"key":"EmrfPEBjfz"},{"type":"tableCell","align":"right","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"3.35","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"pjJtyK412X"}],"key":"elJBcWVVle"},{"type":"tableCell","align":"right","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"1.2","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"TN267nrbK0"}],"key":"w1XQ988UJS"},{"type":"tableCell","align":"right","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"2.2","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"xxg5kW1lit"}],"key":"C64kvtRwc5"},{"type":"tableCell","align":"right","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"0.5","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"Fk8r9XbaFj"}],"key":"CSEZwZkbNR"},{"type":"tableCell","align":"right","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"2.25","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"eNFLhMVjXD"}],"key":"X7Ox6MUewL"},{"type":"tableCell","align":"right","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"4","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"etl7m8mGxH"}],"key":"EpQ7XTI11W"},{"type":"tableCell","align":"right","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"4","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"ebkZBorkNH"}],"key":"yholRu4XtR"}],"key":"Cx7Q8Y78JM"},{"type":"tableRow","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"tableCell","align":"left","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"Ripperdan 720-4","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"qAo8uYbYuG"}],"key":"xtOrtb9zGE"},{"type":"tableCell","align":"right","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"36.848","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"ttZUE0JxtB"}],"key":"XadRGldzhL"},{"type":"tableCell","align":"right","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"-120.174","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"AGAzFuRjMv"}],"key":"vlpgN4M9Ym"},{"type":"tableCell","align":"right","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"61","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"MngVJic4dM"}],"key":"sSuZvVvQNV"},{"type":"tableCell","align":"right","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"90","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"Noz3zQ8w8D"}],"key":"SnMh6JNsR2"},{"type":"tableCell","align":"right","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"3.35","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"EKYRZzT7ZW"}],"key":"pEFbUVFHFH"},{"type":"tableCell","align":"right","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"1.2","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"XJsEp1Mhze"}],"key":"hPMfq8HTqu"},{"type":"tableCell","align":"right","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"2.2","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"oNuewlpec9"}],"key":"ub9NitOXbU"},{"type":"tableCell","align":"right","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"0.5","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"juuxlYyL3G"}],"key":"qooE10Zc7j"},{"type":"tableCell","align":"right","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"2.25","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"FmdjOEdxMt"}],"key":"AOpoyyGyzP"},{"type":"tableCell","align":"right","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"4","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"alRxUiByxh"}],"key":"YyVuzQiUXj"},{"type":"tableCell","align":"right","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"4","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"WVYjZDpZco"}],"key":"YhvrGCriYZ"}],"key":"GCT4OxuDxn"},{"type":"tableRow","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"tableCell","align":"left","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"Barrelli_007","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"yvLTVRFWuj"}],"key":"vVnu2zMrXS"},{"type":"tableCell","align":"right","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"38.753","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"LBxvTOtHTj"}],"key":"vglhWpTk42"},{"type":"tableCell","align":"right","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"-122.98","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"pBEa0gbydh"}],"key":"YBWMri6zpm"},{"type":"tableCell","align":"right","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"113","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"wfnlJE3r9Z"}],"key":"JrExIZL8Iu"},{"type":"tableCell","align":"right","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"135","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"kJoEASezJH"}],"key":"j6c3LHe1Kg"},{"type":"tableCell","align":"right","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"3.35","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"vge95Z0uSw"}],"key":"AzUEi2jxzC"},{"type":"tableCell","align":"right","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"1.25","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"ndlTNe7uRv"}],"key":"r6Dov3rsPY"},{"type":"tableCell","align":"right","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"2.3","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"bm5eW0SGjr"}],"key":"PC2kA6hg65"},{"type":"tableCell","align":"right","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"0.5","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"E1JEuWcEOy"}],"key":"xCoTPVOGmN"},{"type":"tableCell","align":"right","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"1.8","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"PvvCpHQ2sY"}],"key":"e0UeTo6LM5"},{"type":"tableCell","align":"right","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"4","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"RpqzjMOpMD"}],"key":"rNwVEQEMFw"},{"type":"tableCell","align":"right","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"4","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"DN62TbIw4g"}],"key":"hnfNDFeMJm"}],"key":"LzKI8QCFBw"},{"type":"tableRow","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"tableCell","align":"left","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"Barrelli_012","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"pztVLzcBuk"}],"key":"l1Ae5I53nu"},{"type":"tableCell","align":"right","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"38.751369","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"cd4OU0Bvtt"}],"key":"bhFViMsmiY"},{"type":"tableCell","align":"right","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"-122.974658","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"HwZqGYe26P"}],"key":"qSydvHG3wf"},{"type":"tableCell","align":"right","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"112","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"nU69slZiSj"}],"key":"UCD283ARyo"},{"type":"tableCell","align":"right","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"45","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"BgSHLzPy6d"}],"key":"doN9qTZ0Ji"},{"type":"tableCell","align":"right","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"3.35","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"aS7Tys5kiX"}],"key":"sIAvZKTyVg"},{"type":"tableCell","align":"right","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"1.25","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"PolHA6RHsR"}],"key":"TpSfYGX66l"},{"type":"tableCell","align":"right","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"2.3","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"gCNE4vOP85"}],"key":"uSLJfDq3wd"},{"type":"tableCell","align":"right","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"0.5","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"wE3GnHC79D"}],"key":"aagmsLmXAr"},{"type":"tableCell","align":"right","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"1.8","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"kiclwMa3DS"}],"key":"aiKheONbcC"},{"type":"tableCell","align":"right","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"4.4","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"yn5O1UvBkD"}],"key":"vD6SZdGnRL"},{"type":"tableCell","align":"right","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"4.4","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"HWs81qU8zu"}],"key":"Vug23KHIp2"}],"key":"v8islY2fIh"},{"type":"tableRow","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"tableCell","align":"left","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"Sierra Loma-north","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"IVGK7dVFDI"}],"key":"Kku3ZSZuME"},{"type":"tableCell","align":"right","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"38.289338","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"vqywJMHhbF"}],"key":"INUlS0Q8KU"},{"type":"tableCell","align":"right","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"-121.117764","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"zFrnkhBLbb"}],"key":"mSm3qlEeSx"},{"type":"tableCell","align":"right","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"38","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"vv0uj8FK2c"}],"key":"mEViXJJr7l"},{"type":"tableCell","align":"right","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"90","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"d1Zhe8rneH"}],"key":"HjyiM5CHH2"},{"type":"tableCell","align":"right","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"3.35","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"piMGtTaJ9N"}],"key":"wR5pVVGTJl"},{"type":"tableCell","align":"right","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"1.42","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"AAQWshhzpb"}],"key":"qONaMsvGRk"},{"type":"tableCell","align":"right","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"2.25","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"C7IXXN6ZAo"}],"key":"CNrR134BSW"},{"type":"tableCell","align":"right","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"0.5","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"Xm1JL3oabR"}],"key":"FTyU1C3GpN"},{"type":"tableCell","align":"right","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"2.6","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"bZOfhuasOV"}],"key":"PDwp2j02nr"},{"type":"tableCell","align":"right","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"5","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"TlCLrvi5Pi"}],"key":"oAuIumTlx3"},{"type":"tableCell","align":"right","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"5","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"GFSRBi4yoY"}],"key":"WrVkEE2ulc"}],"key":"w1WDdTeBRW"},{"type":"tableRow","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"tableCell","align":"left","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"Sierra Loma-south","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"zmrRoaEK34"}],"key":"GTGGllGHGK"},{"type":"tableCell","align":"right","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"38.280488","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"aPZ2RyhG0N"}],"key":"jSMm20klCI"},{"type":"tableCell","align":"right","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"-121.117597","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"C1BRhU49rY"}],"key":"qxSY0RvLpk"},{"type":"tableCell","align":"right","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"37","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"ihRWf5i8HJ"}],"key":"fCia4wfpE5"},{"type":"tableCell","align":"right","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"90","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"rcxQLON5Mq"}],"key":"B7QVhGSpJl"},{"type":"tableCell","align":"right","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"3.35","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"VMKZfozu4I"}],"key":"ALmvqRubVQ"},{"type":"tableCell","align":"right","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"1-42","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"hu7b8WtFHl"}],"key":"Ll9jxyELdJ"},{"type":"tableCell","align":"right","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"2.25","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"QBO2rRDR58"}],"key":"kNhiS9Ycqp"},{"type":"tableCell","align":"right","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"0.5","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"wk6nUKPmYV"}],"key":"fdH8Z5R0rc"},{"type":"tableCell","align":"right","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"2","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"XJ4lpg8NCQ"}],"key":"um4oUOclFX"},{"type":"tableCell","align":"right","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"5","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"qc3PvTwxj8"}],"key":"a0NXbYMDsM"},{"type":"tableCell","align":"right","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"5","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"RUIOsLFnCn"}],"key":"bK2X2RPjud"}],"key":"eE5VgQ02kl"},{"type":"tableRow","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"tableCell","align":"left","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"Ripperdan 760","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"NfzjSCqU3n"}],"key":"iS3NqUw5Qn"},{"type":"tableCell","align":"right","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"36.839025","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"sll3qsbK0u"}],"key":"IoZF6ubNhF"},{"type":"tableCell","align":"right","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"-120.21014","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"yG9u3DIMTP"}],"key":"GQ1QZbi21H"},{"type":"tableCell","align":"right","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"58","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"rZf0ryvkTu"}],"key":"oSZzW4pUyK"},{"type":"tableCell","align":"right","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"90","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"a05nkB4REM"}],"key":"ZvMsjcELOi"},{"type":"tableCell","align":"right","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"2.74","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"jloME2OBk0"}],"key":"B9WDouzaDp"},{"type":"tableCell","align":"right","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"1.2","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"ag0CfhxQXm"}],"key":"qF91O58qxI"},{"type":"tableCell","align":"right","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"2.5","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"S7T1WNWZdR"}],"key":"ci6xxOT2dL"},{"type":"tableCell","align":"right","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"0.5","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"yAtB4fdOu7"}],"key":"vMQiB3ayPu"},{"type":"tableCell","align":"right","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"1.8","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"KJzgxpTy3b"}],"key":"CMcatMTivX"},{"type":"tableCell","align":"right","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"5.5","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"qMrLKTpg2P"}],"key":"tnUZSFRtBt"},{"type":"tableCell","align":"right","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"5","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"aLWPmSVDc4"}],"key":"mLX3rxp4KL"}],"key":"Nsc76GKDbl"},{"type":"tableRow","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"tableCell","align":"left","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"Barrelli_016","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"wEmkg0NHhW"}],"key":"tFs7hqJrr3"},{"type":"tableCell","align":"right","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"38.747","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"TRbOJlVMCm"}],"key":"bmVFOGM85N"},{"type":"tableCell","align":"right","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"-122.963","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"N3SKgd5ceL"}],"key":"LRl8G5bBFh"},{"type":"tableCell","align":"right","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"112","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"x4rnuhEUSm"}],"key":"et0AQaTmFb"},{"type":"tableCell","align":"right","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"135","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"vHgLHTcOdG"}],"key":"cmLzj2SfYu"},{"type":"tableCell","align":"right","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"3.35","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"EsmfgLitcT"}],"key":"QZyP9Xc589"},{"type":"tableCell","align":"right","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"1.25","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"dMYaSKJNd5"}],"key":"oiW5QrapVm"},{"type":"tableCell","align":"right","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"2.3","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"HaXNmnxh3Y"}],"key":"lt3vDxVwgS"},{"type":"tableCell","align":"right","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"0.5","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"EdETl2yekO"}],"key":"ZOe6rtfO97"},{"type":"tableCell","align":"right","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"1.8","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"Ptp9Lcc4N5"}],"key":"qgs0PwDJfq"},{"type":"tableCell","align":"right","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"4","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"hM7gNphqjx"}],"key":"whzaQ1Tlmg"},{"type":"tableCell","align":"right","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"4","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"ZqLabijtq3"}],"key":"hBsFwrA4wT"}],"key":"H4A2j9RNCE"}],"key":"XBk1cwLSp6"}],"label":"tab-site-description","identifier":"tab-site-description","enumerator":"1","html_id":"tab-site-description","key":"x9rgyO0nTk"},{"type":"heading","depth":3,"position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"Select a site","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"lYCcqQKgoh"}],"identifier":"select-a-site","label":"Select a site","html_id":"select-a-site","implicit":true,"key":"RPlQ99hfQO"},{"type":"paragraph","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"As an example, we suggest to work with data collected over ","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"hgzKfCQzBk"},{"type":"strong","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"Block 3","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"SaC2bUkjYg"}],"key":"xB9Xyvo5q1"},{"type":"text","value":" of the ","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"UXUYVX1F7u"},{"type":"strong","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"Ripperdam","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"dAN1oGkeWb"}],"key":"pt1nQzDMI4"},{"type":"text","value":" site from ","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"SKlMUZ7XEU"},{"type":"strong","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"2019","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"fgrA7YY9ZR"}],"key":"WRXeDFVJQU"},{"type":"text","value":", as this site had a cover crop present during this year. But you can select any other site for comparison.","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"SX995n8kgC"}],"key":"r9UDb0ISC7"}],"key":"Ufnj1HE6b2"},{"type":"block","kind":"notebook-code","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"w_site = widgets.Dropdown(\n    options=[('Sierra Loma N', \"slmN\"), ('Sierra Loma S', \"slmS\"), \n             ('Barrelli 007', \"bar007\"), ('Barrelli 012', \"bar012\"),\n             ('Ripperdan 760', \"rip760\"), \n             ('Ripperdan 720-1', \"rip720_1\"),  ('Ripperdan 720-2', \"rip720_2\"),  ('Ripperdan 720-3', \"rip720_3\"),  ('Ripperdan 720-4', \"rip720_4\")],\n    value=\"rip720_3\",\n    description='Site:',\n)\ndisplay(w_site)","visibility":"show","key":"Gb3lqH1JVy"},{"type":"output","id":"JQVxi4hCl4Ob8nbrLQTIW","data":[],"visibility":"show","key":"o9s7K2Fcis"}],"visibility":"show","key":"Uxqm9JVO3x"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We read and merge the micrometeorology and LAI tables","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pPD0mlq94A"}],"identifier":"we-read-and-merge-the-micrometeorology-and-lai-tables","label":"We read and merge the micrometeorology and LAI tables","html_id":"we-read-and-merge-the-micrometeorology-and-lai-tables","implicit":true,"key":"j1nZhTa8Kf"}],"key":"Yi3UeKCvm0"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Import Python libraries\nfrom pathlib import Path\nimport pandas as pd\n\n# Set the LAI and readiation folders\ninput_dir = Path().absolute() / \"input\"\nlai_dir = input_dir / \"canopy\"\nec_dir = input_dir / \"meteo\"\n# Set the input files based on the chosen site\nlai_filename = lai_dir / f\"FLX_US-{w_site.value}_FLUXNET2015_AUXCANOPY_DD.csv\"\nec_filename = ec_dir / f\"FLX_US-{w_site.value}_FLUXNET2015_SUBSET_HR.csv\"\nprint(f\"LAI file path is {lai_filename}\")\nprint(f\"EC file path is {ec_filename}\")\n\n# Read the LAI and radiation tables\nlai = pd.read_csv(lai_filename, sep=\";\", na_values=-9999)\nec = pd.read_csv(ec_filename, sep=\";\", na_values=-9999)\n\n# Merge both tables by date\nec[\"TIMESTAMP\"] = pd.to_datetime(ec[\"TIMESTAMP\"], format=\"%Y%m%d%H%M\")\nlai[\"DATE\"] = pd.to_datetime(lai[\"TIMESTAMP\"], format=\"%Y%m%d\").dt.date\nlai = lai.drop(labels=[\"TIMESTAMP\"], axis=1)\nec[\"DATE\"] = ec[\"TIMESTAMP\"].dt.date\nec = ec.merge(lai, on=\"DATE\")\n\n# We discard all cases at night (SW_IN <=0)\nec = ec[ec[\"SW_IN\"] > 0]\n\n# Convert Celsius to Kelvin\nec[\"TA\"] = ec[\"TA\"] + 273.15\n# Convert kPa to hPa\nec[\"PA\"] = 10 * ec[\"PA\"]\n\n# Evaluate different energy balance closure corrections\nec[\"H_RES\"] = ec[\"NETRAD\"] - ec[\"G\"] - ec[\"LE\"]\nec['LE_RES'] = ec['NETRAD'] - ec['G'] - ec['H']\nec[\"LE_BR\"], ec[\"H_BR\"] = TSEB.met.bowen_ratio_closure(ec[\"NETRAD\"], ec[\"G\"],\n                                                       ec[\"H\"], ec[\"LE\"])\n# Mean of uncorrected, ressidual and Bowen Ratio\nec[\"H_ENS\"] = np.nanmean([ec[\"H_RES\"], ec[\"H_BR\"], ec['H']], axis=0)\nec[\"LE_ENS\"] = np.nanmean([ec[\"LE_RES\"], ec[\"LE_BR\"], ec['LE']], axis=0)","key":"cdurIAWsZm"},{"type":"output","id":"rt-6rnKzkD09mwiP3RPVW","data":[],"key":"nQr3uzeLDM"}],"key":"uOLs4vg1m0"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Site Description","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Olk07xB6nQ"}],"identifier":"site-description","label":"Site Description","html_id":"site-description","implicit":true,"key":"KEMVBGWVGu"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Here we initialize relevant information related to the site characteristics including geographical position (lat/lon) and vineyard row direction/dimensions","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"aYDgwUkpCZ"}],"key":"kmYYl2B9w2"}],"key":"n53C2afoQS"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import yaml\nyaml_file = input_dir / \"site_description.yaml\"\nsite_dict = yaml.safe_load(yaml_file.read_text())\nlat = float(site_dict[\"lat\"][w_site.value])\nlon = float(site_dict[\"lon\"][w_site.value])\nelev = float(site_dict[\"elev\"][w_site.value])\nrow_direction = float(site_dict[\"row_direction\"][w_site.value])\ninterrow = float(site_dict[\"interrow\"][w_site.value])\nhc_min = float(site_dict[\"hc_min\"][w_site.value])\nhc_max = float(site_dict[\"hc_max\"][w_site.value])\nwc_min = float(site_dict[\"wc_min\"][w_site.value])\nwc_max = float(site_dict[\"wc_max\"][w_site.value])\nzh = float(site_dict[\"zh\"][w_site.value])\nzm = float(site_dict[\"zm\"][w_site.value])\n\nprint(f\"{w_site.label} has the following site characteristics:\\n\"\n      f\"\\t Latitude: {lat} deg. \\n\"\n      f\"\\t Longitude: {lon} deg. \\n\"\n      f\"\\t Elevation: {elev} m \\n\"\n      f\"\\t Row direction: {row_direction} deg. \\n\"\n      f\"\\t Row spacing: {interrow} m \\n\"\n      f\"\\t Min. canopy height: {hc_min} m \\n\"\n      f\"\\t Max. canopy height: {hc_max} m \\n\"\n      f\"\\t Min. canopy width: {wc_min} m \\n\"\n      f\"\\t Max. canopy width: {wc_max} m \\n\"\n      f\"\\t Air temperature measurement height: {zh} m \\n\"\n      f\"\\t Wind speed temperature measurement height: {zh} m\")","key":"TLFSNBON6K"},{"type":"output","id":"Zk3M4F3N3puoiKGrYa7JT","data":[],"key":"G1h19KV1ea"}],"key":"pikGepmFQh"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Estimate vegetation traits","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"v4vCb7W1Ep"}],"identifier":"estimate-vegetation-traits","label":"Estimate vegetation traits","html_id":"estimate-vegetation-traits","implicit":true,"key":"XyEQSFBwnK"},{"type":"heading","depth":4,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Separation of grapevine and cover crop LAI","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"g9bBHDUls2"}],"identifier":"separation-of-grapevine-and-cover-crop-lai","label":"Separation of grapevine and cover crop LAI","html_id":"separation-of-grapevine-and-cover-crop-lai","implicit":true,"key":"dYMXWFNhdn"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"3SEB has very similar data requirements to TSEB but a key distinction is the need to separate biophsyical properties for the two vegetation sources, in this case the grapevine and cover crop. There is no general formula to separate or unmix LAI from the different vegetation sources, there are potentially many differnt methods that can be used.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"hbyypbnSrg"}],"key":"cqYD87L3Pk"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"In this exercise, we will exploit the fact the grapevines and cover crops have different phenological dynamics and we will use this to separate the total LAI values into each component as described in ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"AsSSpgl3u6"},{"type":"cite","url":"https://doi.org/10.1007/s00271-022-00787-x","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Burchard-Levine et al. 2022","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"I4gkbii81S"}],"key":"fJgvrc4OZ8"}],"kind":"narrative","label":"Burchard_Levine_2022","identifier":"https://doi.org/10.1007/s00271-022-00787-x","enumerator":"3","key":"s0xOGiCE8s"}],"key":"JCf518sbav"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"The daily ecosystem LAI were acquired over each tower footprint at 30 m resolution by merging satellite data from the Harmonized Landsat and Sentinel-2 (HLS) surface reflectance and MODIS LAI data product together with in situ LAI measurements ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"Fe329QaZlC"},{"type":"cite","url":"https://doi.org/10.1007/s00271-022-00798-8","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"strong","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Kang et al. 2022","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"oApgLS9sm8"}],"key":"zTwqGYrbmm"}],"kind":"narrative","label":"Kang_2022","identifier":"https://doi.org/10.1007/s00271-022-00798-8","enumerator":"4","key":"hqxkGzeadh"},{"type":"text","value":". The LAI over each tower footprint was extracted from 3 × 3 30 m pixels, thus including vine and cover crop (CC) contributions.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"ghFD7M4zTH"}],"key":"gRToJUd2Gd"},{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"The CC normally has a growing phase during early spring and then is mowed in early summer becoming senescent stubble during the main grapevine growing period between May and August. Therefore, the CC LAI (","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"n0hqFKgfKn"},{"type":"inlineMath","value":"LAI_{cc}","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>L</mi><mi>A</mi><msub><mi>I</mi><mrow><mi>c</mi><mi>c</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">LAI_{cc}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\">L</span><span class=\"mord mathnormal\">A</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">cc</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"aotkVQLB8c"},{"type":"text","value":") was assumed to contribute completely to the total ecosystem LAI (","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"oEaTtOWQGb"},{"type":"inlineMath","value":"LAI_{eco}","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>L</mi><mi>A</mi><msub><mi>I</mi><mrow><mi>e</mi><mi>c</mi><mi>o</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">LAI_{eco}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\">L</span><span class=\"mord mathnormal\">A</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">eco</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"bypChYGEeN"},{"type":"text","value":") before the vine bud-break (~spring) and after vine leaf-off during the fall. The ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"GDVc2OGY2J"},{"type":"inlineMath","value":"LAI_{cc}","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>L</mi><mi>A</mi><msub><mi>I</mi><mrow><mi>c</mi><mi>c</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">LAI_{cc}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\">L</span><span class=\"mord mathnormal\">A</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">cc</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"HySrxZJl6n"},{"type":"text","value":" was simulated to exponentially decay from spring until the peak summer period and then exponentially re-grow during the fall period after the vine leaf-off from ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"kjsmv8k5fa"},{"type":"crossReference","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Figure ","key":"jMhkCueQz5"},{"type":"text","value":"3","key":"hJWfCRKOlB"}],"identifier":"lai-timeseries","label":"lai-timeseries","kind":"figure","template":"Figure %s","enumerator":"3","resolved":true,"html_id":"lai-timeseries","key":"JudhoejfGs"},{"type":"text","value":".","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"OQuxqbRB0e"}],"key":"ub1bDEoRHC"},{"type":"container","kind":"figure","children":[{"type":"image","url":"/lai_partitioning-60f2370fc130fcecce09b949c926e965.png","alt":"LAI time series","key":"ECdQ4iLECD","urlSource":"./input/figures/lai_partitioning.png","urlOptimized":"/lai_partitioning-60f2370fc130fcecce09b949c926e965.webp"},{"type":"caption","children":[{"type":"paragraph","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"captionNumber","kind":"figure","label":"lai-timeseries","identifier":"lai-timeseries","html_id":"lai-timeseries","enumerator":"3","children":[{"type":"text","value":"Figure ","key":"sRQkboEExZ"},{"type":"text","value":"3","key":"cMQh2vF0sH"},{"type":"text","value":":","key":"qM3kQDW8bw"}],"template":"Figure %s:","key":"pgKfX1jFU5"},{"type":"text","value":"Time series of ecosystem LAI (LAIeco) from satellite imagery (Kang et al., 2022) from block 3 of 2019 decomposed into vine (LAIvine) and cover crop (LAIcc) LAI based on seasonal dynamics. Source: ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"uDP22nghn0"},{"type":"cite","url":"https://doi.org/10.1007/s00271-022-00787-x","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"Burchard-Levine ","key":"EJhaCMB506"},{"type":"emphasis","children":[{"type":"text","value":"et al.","key":"p0acyJbadu"}],"key":"BBMFfaflR9"},{"type":"text","value":" (2022)","key":"UqwpJCfGy5"}],"kind":"narrative","label":"Burchard_Levine_2022","identifier":"https://doi.org/10.1007/s00271-022-00787-x","enumerator":"3","key":"jcP72bLFkt"}],"key":"IBrIc8pZYf"}],"key":"SzK0SadvVB"}],"label":"lai-timeseries","identifier":"lai-timeseries","enumerator":"3","html_id":"lai-timeseries","key":"MlVUEr7Zb0"},{"type":"paragraph","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"Seasonal transitions dates were corroborated with in situ phenocam data. Subsequently, LAIcc was subtracted from the ecosystem LAI to obtain vine LAI (LAIvine)","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"nWdYb0wubt"}],"key":"SuoMQPSW5U"},{"type":"math","value":"LAI_{vine} = LAI_{eco} - LAI_{cc}","html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>L</mi><mi>A</mi><msub><mi>I</mi><mrow><mi>v</mi><mi>i</mi><mi>n</mi><mi>e</mi></mrow></msub><mo>=</mo><mi>L</mi><mi>A</mi><msub><mi>I</mi><mrow><mi>e</mi><mi>c</mi><mi>o</mi></mrow></msub><mo>−</mo><mi>L</mi><mi>A</mi><msub><mi>I</mi><mrow><mi>c</mi><mi>c</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">LAI_{vine} = LAI_{eco} - LAI_{cc}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\">L</span><span class=\"mord mathnormal\">A</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal mtight\">in</span><span class=\"mord mathnormal mtight\">e</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\">L</span><span class=\"mord mathnormal\">A</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">eco</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\">L</span><span class=\"mord mathnormal\">A</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">cc</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></span>","enumerator":"2","key":"ptDYBNfBQv"},{"type":"paragraph","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"For simplicity, we use DOY = 117 (end of April) for the bud break date each site and years  but the phenological dates will likely differ for each year and site.","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"ztG0y5H72x"}],"key":"dkK4KbK03p"},{"type":"heading","depth":4,"position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"Set key seasonal transition dates","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"D2MroSL7JT"}],"identifier":"set-key-seasonal-transition-dates","label":"Set key seasonal transition dates","html_id":"set-key-seasonal-transition-dates","implicit":true,"key":"FlfrY6hJf3"}],"key":"hsuVWGAWo1"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Set key seasonal transitions (DOY) obtained from phenocam\nbud_break = 117\nspring_start = 121\nsummer_end = 330\n# set a minimum of cover crop LAI \nlai_cc_min = 0.2  # do not set to 0 or very low values. This will make model unstable due to equations that use LAI in denominator i.e. Rx\n\n# get day of year array\ndoy = ec['TIMESTAMP'].dt.dayofyear\n\nmid_summer = int((spring_start + summer_end) / 2)\ncc_senescence = int((spring_start + mid_summer) / 2)\ncc_regrowth = int((mid_summer + summer_end) / 2)\n","key":"jWRf8xgXer"},{"type":"output","id":"CrxypDccqnwB_V_yWGTX3","data":[],"key":"hMFLiRxDUw"}],"key":"QV4LeA54He"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Simulate growth and decay of cover crop during seasonal transitions periods","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SL47sH6xu8"}],"identifier":"simulate-growth-and-decay-of-cover-crop-during-seasonal-transitions-periods","label":"Simulate growth and decay of cover crop during seasonal transitions periods","html_id":"simulate-growth-and-decay-of-cover-crop-during-seasonal-transitions-periods","implicit":true,"key":"SlCavRQIix"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Using the aproximate DOYs of the seasonal transition periods, we will simulate the senescence of the cover crop as the summer begins (i.e. between start of summer and end of summer)using a logarithmic decay function for both LAI and green fraction. The same will be done for the autumn regrowth period for each year.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"GlkldNcSIb"}],"key":"tOGLgcNM9g"}],"key":"xOmeJoOvxF"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# =======================================\n# Simulate growth/decay of cover crop\n# =======================================\n\n#initialize LAI/fg vine and LAI/fg CC\nlai_cc = np.full_like(ec['LAI'].values, lai_cc_min)\nfg_cc = np.ones_like(ec['LAI'].values)\n\n# --- before vine bud-break\n# before bud-break all LAI is atributed to cover crop (CC)\nlai_cc[doy <= bud_break] = ec['LAI'].values[doy <= bud_break]\n\n# --- cover crop decay\n# When vine bud breaks, exponential decay until mid summer period\n# mid summer period cover crop is as minimum\n\n# do it for each year \nfor year in np.unique(ec['TIMESTAMP'].dt.year):\n    bud_break = bud_break_dict[year]\n    year_mask = ec['TIMESTAMP'].dt.year == year\n    doy_year = doy[year_mask]\n    lai_cc_year = lai_cc[year_mask]\n    fg_cc_year = fg_cc[year_mask]\n    lai_year = ec['LAI'].values[year_mask]\n\n    ### get doy array associated with cover crop decay\n    decay_mask = np.logical_and(doy_year > bud_break, doy_year < mid_summer)\n    doy_decay = doy_year[decay_mask]\n    ## simulate exponetnial decay during senescence\n    if year == 2018:\n        lai_cc_decay = np.logspace(np.log(lai_year[doy_year == doy_year.values[0]][0]), np.log(lai_cc_min),doy_decay.size, base=np.exp(1))\n    else:\n        lai_cc_decay = np.logspace(np.log(lai_cc_year[doy_year == bud_break][0]), np.log(lai_cc_min),doy_decay.size, base=np.exp(1))\n        \n    lai_cc_year[decay_mask] = lai_cc_decay\n    \n    # do same for green fraction \n    fg_cc_decay = np.logspace(np.log(1), np.log(0.01), doy_decay.size, base=np.exp(1))\n    fg_cc_year[decay_mask] = fg_cc_decay\n    \n    # --- autumn regrowth\n    \n    #autumn regrowth (and vine leaf off)\n    regrow_mask = np.logical_and(doy_year > cc_regrowth, doy_year <= summer_end)\n    doy_regrow = doy_year[regrow_mask]\n    # simulate exponential growth during autumn regrowth\n    lai_cc_regrow = np.logspace(np.log(lai_cc_year[doy_year == cc_regrowth][0]), np.log(lai_year[doy_year==summer_end][0]),doy_regrow.size, base=np.exp(1))\n    lai_cc_year[regrow_mask] = lai_cc_regrow\n    \n    # same for green fraction \n    \n    fg_cc_regrow = np.logspace(np.log(0.01), np.log(1), doy_regrow.size, base=np.exp(1))\n    fg_cc_year[regrow_mask] = fg_cc_regrow\n    fg_cc_year[np.logical_and(doy_year >= mid_summer, doy_year <= cc_regrowth)] = 0.01\n    \n    # ---post-autumn/winter\n    \n    # all LAI is CC after summer\n    lai_cc_year[doy_year>summer_end] = lai_year[doy_year>summer_end]\n\n    # now save yearly time series to full time series\n    lai_cc[year_mask] = lai_cc_year\n    fg_cc[year_mask] = fg_cc_year\n    \nprint('Done!')","key":"ysEms2xhq7"},{"type":"output","id":"B5ANCyKxbzXyQeRmmLL2_","data":[],"key":"f2nbwUzX5J"}],"key":"NcVt5kqDwx"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Grapevine LAI","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MBPPZTkPCZ"}],"identifier":"grapevine-lai","label":"Grapevine LAI","html_id":"grapevine-lai","implicit":true,"key":"xfB33Adqve"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We then obtain grapvine LAI as the difference between ecosystem-level LAI (i.e. Satellite data from the Harmonized Landsat and Sentinel-2 (HLS) surface reflectance and MODIS LAI data product) and the cover crop LAI simulated above. Here we assume the grapevine green fraction maintains at 1 throughout the seasonal period.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"TCLKzcebrM"}],"key":"TGuPyR11Gh"}],"key":"EAv3ASYOHI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# =======================================\n# Get grapevine LAI/fg\n# =======================================\n\n#get LAI vine but suctracting LAIcc from LAI\nlai_vine = ec['LAI'].values - lai_cc\n# set minimum of LAI to 0.4 (taking into account branches/trunk effect)\nlai_vine[lai_vine<0.4] = 0.4\nfg_vine = np.full_like(lai_vine, 1)\nprint('Done!')","key":"nf6ktZbiiD"},{"type":"output","id":"zeiN3OdApCX9y4dAerHlE","data":[],"key":"L0ylj4AOH0"}],"key":"J54f7A174Z"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":5,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Visualize LAI partitioning","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"To9iFcEYuD"}],"identifier":"visualize-lai-partitioning","label":"Visualize LAI partitioning","html_id":"visualize-lai-partitioning","implicit":true,"key":"RkT5hKRfyc"}],"key":"hIp1g8Llt4"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from plotly.subplots import make_subplots\nimport plotly.graph_objects as go\nfig = make_subplots(specs=[[{\"secondary_y\": True}]])\nfig.add_trace(go.Scatter(x=ec[\"TIMESTAMP\"].values, y=ec['LAI'].values, \n                         name=\"Total LAI\", mode=\"lines\", line={\"color\": \"black\"}))\n\nfig.add_trace(go.Scatter(x=ec[\"TIMESTAMP\"].values, y=lai_cc, \n                         name=\"Cover crop LAI\", mode=\"lines\", line={\"color\": \"green\"}))\nfig.add_trace(go.Scatter(x=ec[\"TIMESTAMP\"].values, y=lai_vine, \n                         name=\"Grapevine LAI\", mode=\"lines\", line={\"color\": \"red\"}))\nfig.add_trace(go.Scatter(x=ec[\"TIMESTAMP\"].values, y=fg_cc, \n                         name=\"Cover crop green fraction\", mode=\"lines\", line={\"color\": \"green\", \"dash\": \"dot\"}),\n              secondary_y=True)\nfig.update_layout(title_text=f\"LAI partition at {w_site.label}\",\n                  xaxis_title=\"Date\", yaxis_title=\"LAI\")","key":"UlGjkM0X8R"},{"type":"output","id":"migEpL7IAiL1glToY3KSr","data":[],"key":"TFEoIV8RGI"}],"key":"EGy1Fp4AJw"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Estimate the structural variables based on Earth Observation LAI timeseries","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SELDVsEuZJ"}],"identifier":"estimate-the-structural-variables-based-on-earth-observation-lai-timeseries","label":"Estimate the structural variables based on Earth Observation LAI timeseries","html_id":"estimate-the-structural-variables-based-on-earth-observation-lai-timeseries","implicit":true,"key":"nUdanEX4Ws"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The structural traits for the vineyard, such as canopy height (hc) and fractional cover (fc), are estimated from empirical equations developed for this site as described in ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"HEtBDJUvrC"},{"type":"cite","url":"https://doi.org/10.1007/s00271-018-0611-y","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Nieto ","key":"NpFOq9ARKZ"},{"type":"emphasis","children":[{"type":"text","value":"et al.","key":"TY5QOL4iaS"}],"key":"A4WhJTaAhQ"},{"type":"text","value":" (2018)","key":"GKrXAM01yW"}],"kind":"narrative","label":"Nieto_2018","identifier":"https://doi.org/10.1007/s00271-018-0611-y","enumerator":"5","key":"AfnhmLHyT8"},{"type":"text","value":". For canopy height and fractional cover, we used the same empirical equations as in previous exercises.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"i5OqjbSfM9"}],"key":"tSCLB1dpFB"},{"type":"container","kind":"figure","children":[{"type":"image","url":"/vineyard_structural_-59f51fdb831e95cbac9c5249ce0cd27d.png","alt":"Empirical structural functions","key":"XWfH4HpcoE","urlSource":"./input/figures/vineyard_structural_functions.png","urlOptimized":"/vineyard_structural_-59f51fdb831e95cbac9c5249ce0cd27d.webp"},{"type":"caption","children":[{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"captionNumber","kind":"figure","label":"structural-functions","identifier":"structural-functions","html_id":"structural-functions","enumerator":"2","children":[{"type":"text","value":"Figure ","key":"YafOGZpip6"},{"type":"text","value":"2","key":"JncJHAIqfr"},{"type":"text","value":":","key":"epYDBKSlZB"}],"template":"Figure %s:","key":"YajfqTSf3D"},{"type":"text","value":"Empirical models relating canopy height , canopy width and the bottom of the canopy with the fused STARFM LAI. Solid dots represent in situ measured values","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"LzatTEbH8t"}],"key":"OG0oByHSAO"}],"key":"p2Qj6ooG06"}],"label":"structural-functions","identifier":"structural-functions","enumerator":"4","html_id":"structural-functions","key":"zS7GNY5d6K"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"ew1SCEU3hC"}],"key":"Xf2ak034Fe"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Structural traits could also be prescribed based on a land cover map or, even better with LiDAR/PhoDAR information","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"zBUoBpkkrr"}],"key":"Yt0geG7Heq"}],"class":"dropdown","key":"wBkczkuTp7"}],"key":"NDGDWmU9ks"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"################################################################################\n# Empirical equations to generate canopy structural parameters from LAI\n################################################################################\ndef lai_2_hc(lai, hc_min):\n    slope = 0.42\n    hc = hc_min + slope * lai\n    return hc\n\n\ndef lai_2_hbratio(lai, hc_min):\n    hb_ratio_mean = 0.4848388065\n    hb_ratio = np.zeros(lai.shape)\n\n    hb_ratio[lai < hc_min] = 1. + ((hb_ratio_mean - 1.) / hc_min) * lai[\n        lai < hc_min]\n    hb_ratio[lai >= hc_min] = hb_ratio_mean\n\n    return hb_ratio\n\n\ndef lai_2_width(lai, wc_min, wc_max):\n    beta = 6.96560056\n    offset = 1.70825736\n\n    width = wc_min + (wc_max - wc_min) / (1.0 + np.exp(-beta * (lai - offset)))\n\n    return width\n\n\ndef lai_2_fcover(lai, fc_min, fc_max):\n    beta = 7.0\n    offset = 1.70\n\n    fcover = fc_min + (fc_max - fc_min) / (1.0 + np.exp(-beta * (lai - offset)))\n\n    return fcover\n\n\ndef lai_2_canopy(lai, hc_min, fc_min, fc_max):\n    hc = lai_2_hc(lai, hc_min)\n    hb_ratio = lai_2_hbratio(lai, hc_min)\n    fcover = lai_2_fcover(lai, fc_min, fc_max)\n\n    return hc, hb_ratio, fcover\n\n\n# Grapevine height\nh_c_vine, hb_ratio_vine, f_c_vine = lai_2_canopy(lai_vine, hc_min, wc_min / interrow, wc_max / interrow)\n# clip to maximum and minimum possible\nh_c_vine = np.clip(h_c_vine, hc_min, hc_max)\nf_c_vine = np.clip(f_c_vine, 0, 1)","key":"PbanjIs83B"},{"type":"output","id":"rcatZ5txlPWahod91UcWp","data":[],"key":"XbYG3xIbkB"}],"key":"LgwH24XRxn"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"and for the herbaceous cover crop we assume a constant canopy height and full coverage","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MzIQXnJ7fP"}],"key":"aBfSWsBt1b"}],"key":"SsUJpf7Erz"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Crop height\nh_c_cc = 0.35\nh_c_cc = np.full_like(h_c_vine, h_c_cc)\n# Crop coverage\nf_c_cc = np.ones_like(h_c_vine)\n# Crop width to height ratio\nw_c_cc = np.ones_like(h_c_vine)\nw_c_ratio_cc = np.ones_like(h_c_vine)","key":"BDs76mBSol"},{"type":"output","id":"iOUBllyv9P_sfRhajJsLS","data":[],"key":"dye84JsRJ0"}],"key":"nlLmRkKtvK"},{"type":"block","kind":"notebook-content","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Estimate vegetation clumping index","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"aE3hjGccLg"}],"identifier":"estimate-vegetation-clumping-index","label":"Estimate vegetation clumping index","html_id":"estimate-vegetation-clumping-index","implicit":true,"key":"JUskTnNDYI"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Since grapevine canopies are highly clumped and have unique row structures, we will take into account row structure and orientation to calculate the clumping index, which is important when modelling the radiation transmission through the canopy.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"hLSvlZV5bM"}],"key":"Z2OO8YcEDl"}],"visibility":"show","key":"HcArjCcF2P"},{"type":"block","kind":"notebook-code","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# =======================================\n# Grapevine width\nw_c_vine = f_c_vine * interrow\n# Grapevine width to height ratio\nw_c_ratio_vine = w_c_vine / (h_c_vine - hb_ratio_vine * h_c_vine)\n# Grapevine Local LAI\nF_vine = lai_vine / f_c_vine\n\n# The time zone is PST, which corresponds to -120 deg, time longitude\nstdlon = -120\n# Call calc_sun_angles based on site coordinates and timestamp\nsza, saa = TSEB.met.calc_sun_angles(\n    np.full_like(ec['LAI'].values, lat),\n    np.full_like(ec[\"LAI\"].values, lon),\n    np.full_like(ec[\"LAI\"].values, stdlon),\n    ec['TIMESTAMP'].dt.dayofyear.values,\n    ec['TIMESTAMP'].dt.hour.values + ec['TIMESTAMP'].dt.minute.values / 60.)\n\n# Compute the relative sun-row azimuth angle\npsi = row_direction - saa\n# Compute the clumping index for row crops\nomega_vine = TSEB.CI.calc_omega_rows(lai_vine, f_c_vine, theta=sza, psi=psi, w_c=w_c_ratio_vine, x_lad=1)\n# effective lai\nlai_eff_vine = F_vine * omega_vine","visibility":"show","key":"fuxzfSA5Mg"},{"type":"output","id":"jgp_jQEwWX4ja2t2gaK9x","data":[],"visibility":"show","key":"haE4feq7pO"}],"visibility":"show","key":"D4Mrvu30W0"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"On the other hand, for the cover crop we can assume that it is horizontally homogeneous and non-clumped","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"utrYdiULAd"}],"key":"sCeLQxyvkq"}],"key":"gbYxk3liNT"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Estimate net radiation transfer through the three sources","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uzl7UvZstB"}],"identifier":"estimate-net-radiation-transfer-through-the-three-sources","label":"Estimate net radiation transfer through the three sources","html_id":"estimate-net-radiation-transfer-through-the-three-sources","implicit":true,"key":"yx2PJ0zZi4"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We use a beer-lambert (-type) modeling scheme to simulate the radiation transmission through the multiple vegetation canopies adapted from the model described in ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"q51L2NEDS5"},{"type":"cite","url":"https://doi.org/10.1007/978-1-4612-1626-1_15","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Chapter 15 of Campbell and Norman (1998)","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"R2GvRpj2L7"}],"key":"k1GrBEiok4"}],"kind":"narrative","label":"Campbell_1998","identifier":"https://doi.org/10.1007/978-1-4612-1626-1_15","enumerator":"6","key":"QTEZO8OoZ6"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"fDQBt8saV5"}],"key":"zxcmQErj0e"},{"type":"admonition","kind":"seealso","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"See Also","key":"dxKYbOjkuG"}],"key":"ZYWRF0YVCv"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"The full description of the radiation model can be found in ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"hUbpZKf6t2"},{"type":"cite","url":"https://doi.org/10.1007/978-1-4612-1626-1_15","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Campbell and Norman, 1998, Chapter 15","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"QwWjEq3jCK"}],"key":"yLN7sZNpSi"}],"kind":"narrative","label":"Campbell_1998","identifier":"https://doi.org/10.1007/978-1-4612-1626-1_15","enumerator":"6","key":"IYKC6SVp70"},{"type":"text","value":" and the deatils regarding the adaption to three sources is found in the supplementary information in ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"wAn486l5tU"},{"type":"cite","url":"https://doi.org/10.1111/gcb.16002","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Burchard-Levine et al. 2022","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"hOw1rGs9M1"}],"key":"P2ay3YLMga"}],"kind":"narrative","label":"Burchard_Levine_2021","identifier":"https://doi.org/10.1111/gcb.16002","enumerator":"1","key":"ark2470ZHj"}],"key":"OtmtCO6TLy"}],"key":"FZi0sm2G0J"}],"key":"K4ZE3IZVsA"},{"type":"block","kind":"notebook-code","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"from py3seb import py3seb\n\n# We need to define the leaf spectral properties for grapevine and cover crop. For simplicity we can just replicate the same values for both\nrho_leaf_vis_vine = 0.054\nrho_leaf_vis_cc = 0.054\nrho_leaf_nir_vine = 0.262\nrho_leaf_nir_cc = 0.262\ntau_leaf_vis_vine = 0.038\ntau_leaf_vis_cc = 0.038\ntau_leaf_nir_vine = 0.333\ntau_leaf_nir_cc = 0.333\nrho_soil_vis = 0.07\nrho_soil_nir = 0.32\n\n# Thermal spectra\ne_vine = 0.99  # Leaf emissivity\ne_cc = 0.99  # Leaf emissivity\ne_s = 0.94  # Soil emissivity\n\n# Estimates the direct and diffuse solar radiation\ndifvis, difnir, fvis, fnir = TSEB.rad.calc_difuse_ratio(ec[\"SW_IN\"].values,\n                                                        sza,\n                                                        press=np.full_like(sza, 1013.15))\npar_dir = fvis * (1. - difvis) * ec[\"SW_IN\"].values\nnir_dir = fnir * (1. - difnir) * ec[\"SW_IN\"].values\npar_dif = fvis * difvis * ec[\"SW_IN\"].values\nnir_dif = fnir * difnir * ec[\"SW_IN\"].values\n\n# net radiation transmission through the three sources\nsn_vine_3seb, sn_s_3seb, sn_cc_3seb = py3seb.calc_Sn_Campbell(lai_vine, \n                                                              lai_cc, \n                                                              sza, \n                                                              par_dir + nir_dir, \n                                                              par_dif + nir_dif, \n                                                              fvis, \n                                                              fnir,\n                                                              np.full_like(lai_vine, rho_leaf_vis_vine),\n                                                              np.full_like(lai_cc, rho_leaf_vis_cc),\n                                                              np.full_like(lai_vine, tau_leaf_vis_vine),\n                                                              np.full_like(lai_cc, tau_leaf_vis_cc),\n                                                              np.full_like(lai_vine, rho_leaf_nir_vine),\n                                                              np.full_like(lai_cc, rho_leaf_nir_cc),\n                                                              np.full_like(lai_vine, tau_leaf_nir_vine),\n                                                              np.full_like(lai_vine, tau_leaf_nir_cc),\n                                                              np.full_like(lai_vine, rho_soil_vis),\n                                                              np.full_like(lai_vine, rho_soil_nir), \n                                                              h_c_vine, \n                                                              h_c_vine * hb_ratio_vine, \n                                                              w_c_vine, \n                                                              f_c_vine,\n                                                              x_LAD=1, \n                                                              x_LAD_sub=1, \n                                                              LAI_eff=lai_eff_vine,\n                                                              LAI_eff_sub=lai_cc)\n\nsn_vine_3seb[~np.isfinite(sn_vine_3seb)] = 0\nsn_s_3seb[~np.isfinite(sn_s_3seb)] = 0\nsn_cc_3seb[~np.isfinite(sn_cc_3seb)] = 0\nprint('Done!')","visibility":"show","key":"AHegX2iOw1"},{"type":"output","id":"j2DZknZ5LgBbiFlsj-cru","data":[],"visibility":"show","key":"N4p9yelhnC"}],"visibility":"show","key":"p3FWBrg6QV"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Evaluate net shortwave radiation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XIaAHC3nOe"}],"identifier":"evaluate-net-shortwave-radiation","label":"Evaluate net shortwave radiation","html_id":"evaluate-net-shortwave-radiation","implicit":true,"key":"rg54kWaB4R"}],"key":"ZlEXdVQEJc"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from model_evaluation import double_collocation as dc\ndaytime = ec[\"SW_IN\"] > 100\n\nsn_3seb = sn_vine_3seb + sn_s_3seb + sn_cc_3seb\nsn_obs = ec[\"SW_IN\"].values - ec[\"SW_OUT\"].values\n\nfig = go.Figure()\nfig.add_trace(go.Scattergl(x=sn_3seb[daytime], y=sn_obs[daytime], \n                         name=\"Sn for row crops\", mode=\"markers\"))\nfig.add_trace(go.Scatter(x=[0, 1000], y=[0, 1000], mode=\"lines\", name=\"1:1 line\", line={\"color\": \"black\", \"dash\": \"dash\"}))\nfig.update_layout(title_text=f\"Observed vs. Estimated below net radiation at {w_site.label}\",\n                  yaxis_range=[0, 1000], xaxis_range=[0, 1000],\n                  xaxis_title=\"Estimated (W m-2)\", yaxis_title=\"Observed (W m-2)\")","key":"CkcLhpvMQx"},{"type":"output","id":"doaPH5VDGdPz9rlX2Pcff","data":[],"key":"QGIu4XqbfS"}],"key":"I7YFncvBH7"},{"type":"block","kind":"notebook-content","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Estimate surface roughness","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zGqOMFU7Ll"}],"identifier":"estimate-surface-roughness","label":"Estimate surface roughness","html_id":"estimate-surface-roughness","implicit":true,"key":"bzL7XG1IPd"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We estimate surface roughness using the same frameworks as implemented in TSEB (see ./103-TSEB_introduction.ipynb).","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"bb1g5hJcxd"}],"key":"eKjpo5qrij"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"For tall and woody canopies, in which leaf density and coverage can play a more importan role, pyTSEB can adopt the formulation of Schaudt and Dickinson (2000), which at the same time it relies on the model by [Raupach (1994))(","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"UVE8kwfXrI"},{"type":"cite","url":"https://doi.org/10.1007/BF00709229","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Raupach (1994)","key":"uq6qvzNP7D"}],"kind":"narrative","label":"Raupach_1994","identifier":"https://doi.org/10.1007/BF00709229","enumerator":"7","key":"Umyh4mA5O0"},{"type":"text","value":")","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"LB3fYXCFqs"}],"key":"xIHX5KfjCn"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Since vineyards can be considered as open shrublands or short decidous broadleaved canopies, we will compute roughness based on Schaudt and Dickinson (2000). As inputs we need not only the canopy height, but also the LAI, the fractional cover and the width-to-height canopy ratio","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"qoWsyGvCMB"}],"key":"IAcj1ih9bx"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"In the case of 3SEB, we need to estimate the roughness for the overstory vegetation (i.e. grapevine) and the understory vegetation (i.e. cover crop). For the cover crop, we assume herbecaous conditions so we simple use canophy height ratio approach.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"QSRhVVZbJM"}],"key":"HnvqwDoDT6"}],"visibility":"show","key":"lFhzIlPjfs"},{"type":"block","kind":"notebook-code","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Roughness for bare soil\nz0_soil = 0.15\n\n# grapevine\n# =========\nz_0m_vine, d_0_vine = TSEB.res.calc_roughness(lai_vine, h_c_vine, w_c_ratio_vine,\n                                              np.ones(lai_vine.shape) * TSEB.res.BROADLEAVED_D,\n                                              f_c=f_c_vine)\n# Ensure realistic values\nd_0_vine[d_0_vine < 0] = 0\nz_0m_vine[np.isnan(z_0m_vine)] = z0_soil\nz_0m_vine[z_0m_vine < z0_soil] = z0_soil\n\n# cover crop\n# ==========\nz_0m_cc, d_0_cc = TSEB.res.calc_roughness(lai_cc, h_c_cc, w_c_ratio_cc,\n                                          np.ones(lai_cc.shape) * TSEB.res.GRASS,\n                                          f_c=f_c_cc)\n\n# Ensure realistic values\nd_0_cc[d_0_cc < 0] = 0\nz_0m_cc[np.isnan(z_0m_cc)] = z0_soil\nz_0m_cc[z_0m_cc < z0_soil] = z0_soil\nprint('Done!')","visibility":"show","key":"ujRAa68eKs"},{"type":"output","id":"S7rnxDqS1JYS5QnZnkn1O","data":[],"visibility":"show","key":"eA1Tcozh9t"}],"visibility":"show","key":"EWZzdTmeVo"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"TSEB/3SEB processing options and model parameters","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"moKuAhoBZT"}],"identifier":"tseb-3seb-processing-options-and-model-parameters","label":"TSEB/3SEB processing options and model parameters","html_id":"tseb-3seb-processing-options-and-model-parameters","implicit":true,"key":"UQe6gDgxcU"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"In this section, we set-up some processing options related to how we want to run 3SEB, including assigning some values to constant ancillary parameters. These are the same as those set-up to run pyTSEB but again we need to specify the parameters for each vegetaion layer.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"E1HCgHJUEo"}],"key":"KMy9vgaK3L"}],"key":"iFWbuPCsTY"},{"type":"block","kind":"notebook-code","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"alpha_PT_0 = 1.26\n\n# Grapevine and cover crop leaf width (m)\nleaf_width_vine = 0.10\nleaf_width_cc = 0.01\n\n# Kustas and Norman boundary layer resistance parameters\nroil_resistance_c_param = 0.0038\nroil_resistance_b_param = 0.012\nroil_resistance_cprime_param = 90.\n\n# Thermal spectra\ne_v = 0.99  # Leaf vine emissivity\ne_cc = 0.99   # Leaf crop emissivity\ne_s = 0.94  # Soil emissivity","visibility":"show","key":"akYAKnL0LX"},{"type":"output","id":"lrxjp53UmbDguJSy_lin1","data":[],"visibility":"show","key":"G7pIxBvPc5"}],"visibility":"show","key":"AnILknyohc"},{"type":"block","kind":"notebook-content","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We derive the half-hourly LST based on pyrgeomters on the EC tower","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mtefAfdVBa"}],"identifier":"we-derive-the-half-hourly-lst-based-on-pyrgeomters-on-the-ec-tower","label":"We derive the half-hourly LST based on pyrgeomters on the EC tower","html_id":"we-derive-the-half-hourly-lst-based-on-pyrgeomters-on-the-ec-tower","implicit":true,"key":"eEy5kc5Vdi"}],"visibility":"show","key":"on7YNM1YnX"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Surface emissivity\ne_surf = f_c_vine * e_v + (1. - f_c_vine) * e_s\n\n# LST from longwave radiometers\nlst = ((ec['LW_OUT'].values - (1. - e_surf) * ec['LW_IN'].values) / (\n        TSEB.rad.SB * e_surf)) ** 0.25\n\n# And it is assuming that the radiometer is looking at nadir\nvza = np.zeros_like(lst)","key":"W7p1YYnpNQ"},{"type":"output","id":"FZ3R9b3srd6QwlAREHCcn","data":[],"key":"NNJzjzlRVP"}],"key":"YKfKQpx2Qk"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Computing Sensible heat flux with 3SEB","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DlYlcp8lpr"}],"identifier":"computing-sensible-heat-flux-with-3seb","label":"Computing Sensible heat flux with 3SEB","html_id":"computing-sensible-heat-flux-with-3seb","implicit":true,"key":"FEmPoukEs6"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The key distinction of 3SEB is that we need to separate sensible heat fluxes between vegetation overstory, understory and soil layers. All this, using the the radiometric land surface temperature (LST) derived from remote sensing as the key boundary condition. It is assumed that the singular LST observation is the combination of signals stemming from all three sources such as :","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"DuHBkVwuqk"}],"key":"ZYnI80aYRZ"},{"type":"math","value":"LST =(f_{ov}\\left(\\theta\\right)T_{ov}^4+\\left[1-f_{ov}\\left(\\theta\\right)\\right]T_{sub}^4)^{1/4}\\\\\n\n\\\\T_{sub} =(f_{un}\\left(\\theta\\right)T_{un}^4+\\left[1-f_{un}\\left(\\theta\\right)\\right]T_{s}^4)^{1/4}\\\\","label":"eq-3SEB_Trad","identifier":"eq-3seb_trad","tight":"after","html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>L</mi><mi>S</mi><mi>T</mi><mo>=</mo><mo stretchy=\"false\">(</mo><msub><mi>f</mi><mrow><mi>o</mi><mi>v</mi></mrow></msub><mrow><mo fence=\"true\">(</mo><mi>θ</mi><mo fence=\"true\">)</mo></mrow><msubsup><mi>T</mi><mrow><mi>o</mi><mi>v</mi></mrow><mn>4</mn></msubsup><mo>+</mo><mrow><mo fence=\"true\">[</mo><mn>1</mn><mo>−</mo><msub><mi>f</mi><mrow><mi>o</mi><mi>v</mi></mrow></msub><mrow><mo fence=\"true\">(</mo><mi>θ</mi><mo fence=\"true\">)</mo></mrow><mo fence=\"true\">]</mo></mrow><msubsup><mi>T</mi><mrow><mi>s</mi><mi>u</mi><mi>b</mi></mrow><mn>4</mn></msubsup><msup><mo stretchy=\"false\">)</mo><mrow><mn>1</mn><mi mathvariant=\"normal\">/</mi><mn>4</mn></mrow></msup><mspace linebreak=\"newline\"></mspace><mspace linebreak=\"newline\"></mspace><msub><mi>T</mi><mrow><mi>s</mi><mi>u</mi><mi>b</mi></mrow></msub><mo>=</mo><mo stretchy=\"false\">(</mo><msub><mi>f</mi><mrow><mi>u</mi><mi>n</mi></mrow></msub><mrow><mo fence=\"true\">(</mo><mi>θ</mi><mo fence=\"true\">)</mo></mrow><msubsup><mi>T</mi><mrow><mi>u</mi><mi>n</mi></mrow><mn>4</mn></msubsup><mo>+</mo><mrow><mo fence=\"true\">[</mo><mn>1</mn><mo>−</mo><msub><mi>f</mi><mrow><mi>u</mi><mi>n</mi></mrow></msub><mrow><mo fence=\"true\">(</mo><mi>θ</mi><mo fence=\"true\">)</mo></mrow><mo fence=\"true\">]</mo></mrow><msubsup><mi>T</mi><mi>s</mi><mn>4</mn></msubsup><msup><mo stretchy=\"false\">)</mo><mrow><mn>1</mn><mi mathvariant=\"normal\">/</mi><mn>4</mn></mrow></msup><mspace linebreak=\"newline\"></mspace></mrow><annotation encoding=\"application/x-tex\">LST =(f_{ov}\\left(\\theta\\right)T_{ov}^4+\\left[1-f_{ov}\\left(\\theta\\right)\\right]T_{sub}^4)^{1/4}\\\\\n\n\\\\T_{sub} =(f_{un}\\left(\\theta\\right)T_{un}^4+\\left[1-f_{un}\\left(\\theta\\right)\\right]T_{s}^4)^{1/4}\\\\</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\">L</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">ST</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1141em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">o</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mclose delimcenter\" style=\"top:0em;\">)</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641em;\"><span style=\"top:-2.453em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">o</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">4</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.188em;vertical-align:-0.25em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\">[</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">o</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mclose delimcenter\" style=\"top:0em;\">)</span></span><span class=\"mclose delimcenter\" style=\"top:0em;\">]</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641em;\"><span style=\"top:-2.453em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">s</span><span class=\"mord mathnormal mtight\">u</span><span class=\"mord mathnormal mtight\">b</span></span></span></span><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">4</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.938em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1/4</span></span></span></span></span></span></span></span></span></span><span class=\"mspace newline\"></span><span class=\"mspace newline\"></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">s</span><span class=\"mord mathnormal mtight\">u</span><span class=\"mord mathnormal mtight\">b</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1141em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">u</span><span class=\"mord mathnormal mtight\">n</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mclose delimcenter\" style=\"top:0em;\">)</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641em;\"><span style=\"top:-2.453em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">u</span><span class=\"mord mathnormal mtight\">n</span></span></span></span><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">4</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.188em;vertical-align:-0.25em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\">[</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">u</span><span class=\"mord mathnormal mtight\">n</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mclose delimcenter\" style=\"top:0em;\">)</span></span><span class=\"mclose delimcenter\" style=\"top:0em;\">]</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641em;\"><span style=\"top:-2.453em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">s</span></span></span></span><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">4</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.938em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1/4</span></span></span></span></span></span></span></span></span></span><span class=\"mspace newline\"></span></span></span></span>","enumerator":"3","html_id":"eq-3seb-trad","key":"NToTSpcl5J"},{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"where ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"OfgCVP8Ylz"},{"type":"inlineMath","value":"f_c\\left(\\theta\\right)","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mi>c</mi></msub><mrow><mo fence=\"true\">(</mo><mi>θ</mi><mo fence=\"true\">)</mo></mrow></mrow><annotation encoding=\"application/x-tex\">f_c\\left(\\theta\\right)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mclose delimcenter\" style=\"top:0em;\">)</span></span></span></span></span>","key":"OgRt6JYBuG"},{"type":"text","value":" is the fraction of vegetation observed by the sensor (either for understory (un) and overstory (ov)). Since the above equations consists of three unknowns and only two equations, an iterative process is conducted using to initial guesses of potential canopy transpiration for both vegetation sources, and under the assumption that during daytime hours condensation for the soil/substrate should not occur. The initial canopy latent and sensible heat fluxes are estimated based on the ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"bLRL0DLx8V"},{"type":"cite","url":"https://doi.org/10.1175/1520-0493(1972)100%3C0081:OTAOSH%3E2.3.CO;2","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Priestley and Taylor (1972)","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"zFpz20wRkp"}],"kind":"narrative","label":"PRIESTLEY_1972","identifier":"https://doi.org/10.1175/1520-0493(1972)100%3C0081:OTAOSH%3E2.3.CO;2","enumerator":"8","key":"aJJG4Gh6Di"},{"type":"text","value":" formulation for potential transpiration (Eq. ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"oqX7ABT7GA"},{"type":"crossReference","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"(","key":"Y5riyft4cH"},{"type":"text","value":"10","key":"pfb8ZMIY0G"},{"type":"text","value":")","key":"C6xoNwqFad"}],"identifier":"eq-tseb_pt","label":"eq-TSEB_PT","kind":"equation","template":"(%s)","enumerator":"10","resolved":true,"html_id":"eq-tseb-pt","remote":true,"url":"/tseb-introduction","dataUrl":"/tseb-introduction.json","key":"TAaQYplQdf"},{"type":"text","value":") and Eq. ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"ijw0GHrzA1"},{"type":"crossReference","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"(","key":"mPevZjbNVt"},{"type":"text","value":"1","key":"uDsoMQMasv"},{"type":"text","value":")","key":"KHtAJ5Po53"}],"identifier":"eq-eb","label":"eq-eb","kind":"equation","template":"(%s)","enumerator":"1","resolved":true,"html_id":"eq-eb","remote":true,"url":"/tseb-introduction","dataUrl":"/tseb-introduction.json","key":"SMtuNuw59n"},{"type":"text","value":".","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"tR0tm1wDbQ"}],"key":"hwEzubGqM2"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"In 3SEB, resistance framework is first treated as a parallel (i.e., uncoupled) tree-substrate system to obtain tree canopy sensible heat flux (","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"bEgMqZpzgJ"},{"type":"inlineMath","value":"H_C","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>H</mi><mi>C</mi></msub></mrow><annotation encoding=\"application/x-tex\">H_C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07153em;\">C</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"u2MPkFNNX9"},{"type":"text","value":") and substrate (understory vegetation+soil) (","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"Da3rxML88T"},{"type":"inlineMath","value":"H_{sub}","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>H</mi><mrow><mi>s</mi><mi>u</mi><mi>b</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">H_{sub}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">s</span><span class=\"mord mathnormal mtight\">u</span><span class=\"mord mathnormal mtight\">b</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"FAP6RkDMW3"},{"type":"text","value":") using the heat transport equations:","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"KSDt27Rk7n"}],"key":"K4gShJ3nJf"},{"type":"math","value":"H_C &= \\rho C_p \\frac{T_C - T_{a}} {R_A}\\\\\nH_{sub} &= \\rho C_p \\frac{T_{sub} - T_{a}} {R_A+R_{sub}}","label":"ec-hc-hsub","identifier":"ec-hc-hsub","html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mtable rowspacing=\"0.25em\" columnalign=\"right left\" columnspacing=\"0em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><msub><mi>H</mi><mi>C</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mi>ρ</mi><msub><mi>C</mi><mi>p</mi></msub><mfrac><mrow><msub><mi>T</mi><mi>C</mi></msub><mo>−</mo><msub><mi>T</mi><mi>a</mi></msub></mrow><msub><mi>R</mi><mi>A</mi></msub></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><msub><mi>H</mi><mrow><mi>s</mi><mi>u</mi><mi>b</mi></mrow></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mi>ρ</mi><msub><mi>C</mi><mi>p</mi></msub><mfrac><mrow><msub><mi>T</mi><mrow><mi>s</mi><mi>u</mi><mi>b</mi></mrow></msub><mo>−</mo><msub><mi>T</mi><mi>a</mi></msub></mrow><mrow><msub><mi>R</mi><mi>A</mi></msub><mo>+</mo><msub><mi>R</mi><mrow><mi>s</mi><mi>u</mi><mi>b</mi></mrow></msub></mrow></mfrac></mrow></mstyle></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\begin{align*}\nH_C &amp;= \\rho C_p \\frac{T_C - T_{a}} {R_A}\\\\\nH_{sub} &amp;= \\rho C_p \\frac{T_{sub} - T_{a}} {R_A+R_{sub}}\n\\end{align*}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:4.9927em;vertical-align:-2.2463em;\"></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-r\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.7463em;\"><span style=\"top:-4.7463em;\"><span class=\"pstrut\" style=\"height:3.3603em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07153em;\">C</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-2.25em;\"><span class=\"pstrut\" style=\"height:3.3603em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">s</span><span class=\"mord mathnormal mtight\">u</span><span class=\"mord mathnormal mtight\">b</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.2463em;\"><span></span></span></span></span></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.7463em;\"><span style=\"top:-4.7463em;\"><span class=\"pstrut\" style=\"height:3.3603em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord mathnormal\">ρ</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">p</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3603em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">A</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07153em;\">C</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.836em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span><span style=\"top:-2.25em;\"><span class=\"pstrut\" style=\"height:3.3603em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord mathnormal\">ρ</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">p</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3603em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">A</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">s</span><span class=\"mord mathnormal mtight\">u</span><span class=\"mord mathnormal mtight\">b</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">s</span><span class=\"mord mathnormal mtight\">u</span><span class=\"mord mathnormal mtight\">b</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.836em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.2463em;\"><span></span></span></span></span></span></span></span></span></span></span></span>","enumerator":"4","html_id":"ec-hc-hsub","key":"dmtZXfk65u"},{"type":"paragraph","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"Subsequently, the substrate fluxes and temperatures are further separated incorporating a series (i.e. coupled) approach:","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"HkTvJHOod7"}],"key":"L6EabkNrZH"},{"type":"math","value":"H_{C,sub} &= \\rho C_p \\frac{T_{C,sub} - T_{ac}} {R_X}\\\\\nH_s &= \\rho C_p \\frac{T_S - T_{ac}} {R_S}","label":"ec-hcsub-hs","identifier":"ec-hcsub-hs","html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mtable rowspacing=\"0.25em\" columnalign=\"right left\" columnspacing=\"0em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><msub><mi>H</mi><mrow><mi>C</mi><mo separator=\"true\">,</mo><mi>s</mi><mi>u</mi><mi>b</mi></mrow></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mi>ρ</mi><msub><mi>C</mi><mi>p</mi></msub><mfrac><mrow><msub><mi>T</mi><mrow><mi>C</mi><mo separator=\"true\">,</mo><mi>s</mi><mi>u</mi><mi>b</mi></mrow></msub><mo>−</mo><msub><mi>T</mi><mrow><mi>a</mi><mi>c</mi></mrow></msub></mrow><msub><mi>R</mi><mi>X</mi></msub></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><msub><mi>H</mi><mi>s</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mi>ρ</mi><msub><mi>C</mi><mi>p</mi></msub><mfrac><mrow><msub><mi>T</mi><mi>S</mi></msub><mo>−</mo><msub><mi>T</mi><mrow><mi>a</mi><mi>c</mi></mrow></msub></mrow><msub><mi>R</mi><mi>S</mi></msub></mfrac></mrow></mstyle></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\begin{align*}\nH_{C,sub} &amp;= \\rho C_p \\frac{T_{C,sub} - T_{ac}} {R_X}\\\\\nH_s &amp;= \\rho C_p \\frac{T_S - T_{ac}} {R_S}\n\\end{align*}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:4.9927em;vertical-align:-2.2463em;\"></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-r\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.7463em;\"><span style=\"top:-4.7463em;\"><span class=\"pstrut\" style=\"height:3.3603em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07153em;\">C</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\">s</span><span class=\"mord mathnormal mtight\">u</span><span class=\"mord mathnormal mtight\">b</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-2.25em;\"><span class=\"pstrut\" style=\"height:3.3603em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">s</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.2463em;\"><span></span></span></span></span></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.7463em;\"><span style=\"top:-4.7463em;\"><span class=\"pstrut\" style=\"height:3.3603em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord mathnormal\">ρ</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">p</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3603em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07847em;\">X</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07153em;\">C</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\">s</span><span class=\"mord mathnormal mtight\">u</span><span class=\"mord mathnormal mtight\">b</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">c</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.836em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span><span style=\"top:-2.25em;\"><span class=\"pstrut\" style=\"height:3.3603em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord mathnormal\">ρ</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">p</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3603em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05764em;\">S</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05764em;\">S</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">c</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.836em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.2463em;\"><span></span></span></span></span></span></span></span></span></span></span></span>","enumerator":"5","html_id":"ec-hcsub-hs","key":"Kj8NzAFmUT"},{"type":"paragraph","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"text","value":"Since ","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"B8LYtweq01"},{"type":"inlineMath","value":"T_C","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>T</mi><mi>C</mi></msub></mrow><annotation encoding=\"application/x-tex\">T_C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07153em;\">C</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"TXM3DqLaps"},{"type":"text","value":", ","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"mwJb9QyG7p"},{"type":"inlineMath","value":"T_{C,sub}","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>T</mi><mrow><mi>C</mi><mo separator=\"true\">,</mo><mi>s</mi><mi>u</mi><mi>b</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">T_{C,sub}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9694em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07153em;\">C</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\">s</span><span class=\"mord mathnormal mtight\">u</span><span class=\"mord mathnormal mtight\">b</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span></span>","key":"JwgWElCws1"},{"type":"text","value":" and ","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"taAKj3j32W"},{"type":"inlineMath","value":"T_S","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>T</mi><mi>S</mi></msub></mrow><annotation encoding=\"application/x-tex\">T_S</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05764em;\">S</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"BHKk66SDTR"},{"type":"text","value":" are unknown apriori, the original 3SEB formulation (3SEB-PT) implements a Priestley-Taylor (PT) formulation, as in ","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"UENC9IxUSz"},{"type":"cite","url":"https://doi.org/10.1016/0168-1923(95)02265-Y","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"text","value":"Norman et al. (1995)","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"ztEzJIWuCA"}],"kind":"narrative","label":"Norman_1995","identifier":"https://doi.org/10.1016/0168-1923(95)02265-Y","enumerator":"2","key":"SKFlpuW5nW"},{"type":"text","value":", to compute a first estimate of the canopy LE and H for both overstory and understory.","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"ZAF0k4hdqu"}],"key":"NSHqUnWK47"}],"key":"vsr5c6rWZZ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Run 3SEB","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yg0r78cwsI"}],"identifier":"run-3seb","label":"Run 3SEB","html_id":"run-3seb","implicit":true,"key":"fZ8UsBmP4E"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We are now finally ready to run 3SEB","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"GQB76GVEtk"}],"key":"MEVHN58pQ6"},{"type":"admonition","kind":"seealso","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"See Also","key":"IuJi8w50v0"}],"key":"e7DEJZ2zXm"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"The full code for 3SEB model at the ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"OzwNNWk0kY"},{"type":"link","url":"https://github.com/VicenteBurchard/py3SEB/blob/c89b70e0f95d21338b65efc9cbbf90aac70ba3a0/py3seb/py3seb.py#L58","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"3SEB GitHub repository","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"SPJRzujNh2"}],"key":"ng8Ovzqy8S"}],"urlSource":"https://github.com/VicenteBurchard/py3SEB/blob/c89b70e0f95d21338b65efc9cbbf90aac70ba3a0/py3seb/py3seb.py#L58","data":{"kind":"file","org":"VicenteBurchard","repo":"py3SEB","reference":"c89b70e0f95d21338b65efc9cbbf90aac70ba3a0","file":"py3seb/py3seb.py","from":58,"raw":"https://raw.githubusercontent.com/VicenteBurchard/py3SEB/c89b70e0f95d21338b65efc9cbbf90aac70ba3a0/py3seb/py3seb.py"},"internal":false,"protocol":"github","key":"n2RgQVYZPh"}],"key":"xOsUnyKvkJ"}],"class":"dropdown","key":"lwOFTofUDi"}],"key":"IScRv2ZDgr"},{"type":"block","kind":"notebook-code","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"resistance_flag = [0, {\"KN_c\": np.full_like(lst, roil_resistance_c_param),\n                       \"KN_b\": np.full_like(lst, roil_resistance_b_param),\n                       \"KN_C_dash\": np.full_like(lst, roil_resistance_cprime_param)}]\n\n# Run 3SEB\n[flag_3seb, t_s_3seb, t_vine_3seb, t_cc_3seb, t_ac_3seb, ln_sub_3seb, ln_vine_3seb, \n ln_cc_3seb, ln_s_3seb, le_vine_3seb, h_vine_3seb, le_cc_3seb, h_cc_3seb,\n le_s_3seb, h_s_3seb, g_3seb, r_s_3seb, r_sub_3seb, r_x_3seb, r_a_3seb, u_friction_3seb, \n l_mo_3seb, n_iterations_3seb] = py3seb.ThreeSEB_PT(lst,\n                                                    vza,\n                                                    ec[\"TA\"].values,\n                                                    ec[\"WS\"].values,\n                                                    ec[\"EA\"].values,\n                                                    ec[\"PA\"].values,\n                                                    sn_vine_3seb,\n                                                    sn_s_3seb,\n                                                    sn_cc_3seb,\n                                                    ec[\"LW_IN\"].values,\n                                                    lai_vine,\n                                                    lai_cc,\n                                                    h_c_vine,\n                                                    h_c_cc,\n                                                    e_vine,\n                                                    e_cc,\n                                                    e_s,\n                                                    z_0m_vine,\n                                                    z_0m_cc,\n                                                    d_0_vine,\n                                                    d_0_cc,\n                                                    zm,\n                                                    zh,\n                                                    leaf_width=leaf_width_vine,\n                                                    leaf_width_sub=leaf_width_cc,\n                                                    f_c=f_c_vine,\n                                                    f_c_sub=f_c_cc,\n                                                    f_g=fg_vine,\n                                                    f_g_sub=fg_cc,\n                                                    calcG_params=[[1], 0.35],\n                                                    resistance_form=resistance_flag)\n\n# ... and finally we compute the bulk fluxes\nle_3seb = le_vine_3seb + le_cc_3seb + le_s_3seb\nh_3seb = h_vine_3seb + h_cc_3seb + h_s_3seb\nnetrad_3seb = sn_vine_3seb + sn_cc_3seb + sn_s_3seb + ln_vine_3seb + ln_cc_3seb + ln_s_3seb","visibility":"show","key":"HCtZ09cRsT"},{"type":"output","id":"_dAbo_rkBMym5S3rB1Jfq","data":[],"visibility":"show","key":"YLi4PkVcmK"}],"visibility":"show","key":"UhAd2ne22b"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Run TSEB-PT for comparison","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"w1hwy24J7V"}],"identifier":"run-tseb-pt-for-comparison","label":"Run TSEB-PT for comparison","html_id":"run-tseb-pt-for-comparison","implicit":true,"key":"u4zXOaJhpA"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Let us also run TSEB-PT for comparison purposes.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"bUGAmHTdqn"}],"key":"F2p6VzMk6m"}],"key":"MBggH8hFab"},{"type":"block","kind":"notebook-code","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Compute the canopy and soil net radiation using Cambpell RTM\nsn_c, sn_s = TSEB.rad.calc_Sn_Campbell(ec[\"LAI\"].values,\n                                       sza,\n                                       par_dir + nir_dir,\n                                       par_dif + nir_dif,\n                                       fvis,\n                                       fnir,\n                                       np.full_like(sza, rho_leaf_vis_vine),\n                                       np.full_like(sza, tau_leaf_vis_vine),\n                                       np.full_like(sza, rho_leaf_nir_vine),\n                                       np.full_like(sza, tau_leaf_nir_vine),\n                                       np.full_like(sza, rho_soil_vis),\n                                       np.full_like(sza, rho_soil_nir),\n                                       x_LAD=1,\n                                       LAI_eff=lai_eff_vine)\n\nsn_c[~np.isfinite(sn_c)] = 0\nsn_s[~np.isfinite(sn_s)] = 0\n\n# TSEB-PT\n[flag_pt, ts_pt, tc_pt, t_ac_pt, ln_s_pt, ln_c_pt, le_c_pt, h_c_pt, le_s_pt, h_s_pt, g_pt,\n r_s_pt, r_x_pt, r_a_pt, u_friction_pt, lmo_pt, n_iterations_pt] = TSEB.TSEB_PT(                                                     \n     lst,\n     vza,\n     ec[\"TA\"].values,\n     ec[\"WS\"].values,\n     ec[\"EA\"].values,\n     ec[\"PA\"].values,\n     sn_c,\n     sn_s,\n     ec[\"LW_IN\"].values,\n     ec[\"LAI\"].values,\n     h_c_vine,\n     e_vine,\n     e_s,\n     z_0m_vine,\n     d_0_vine,\n     zm,\n     zh,\n     x_LAD=np.ones_like(lst),\n     f_c=f_c_vine,\n     f_g=fg_vine,\n     w_C=w_c_ratio_vine,\n     leaf_width=leaf_width_vine,\n     z0_soil=z0_soil,\n     alpha_PT=alpha_PT_0,\n     resistance_form=resistance_flag,\n     calcG_params=[[1], 0.35])\n\n# ... and we compute the bulk fluxes\nle_pt = le_c_pt + le_s_pt\nh_pt = h_c_pt + h_s_pt\nnetrad_pt = sn_c + sn_s + ln_c_pt + ln_s_pt","visibility":"show","key":"YErZbf5fhO"},{"type":"output","id":"jSaQmfmlNWleFpjgS0xi6","data":[],"visibility":"show","key":"FL659YSxq0"}],"visibility":"show","key":"EavuiofpoW"},{"type":"block","kind":"notebook-content","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Model evaluation and visualization","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rFcfVMHEn0"}],"identifier":"model-evaluation-and-visualization","label":"Model evaluation and visualization","html_id":"model-evaluation-and-visualization","implicit":true,"key":"hEaKYbYt8b"},{"type":"heading","depth":3,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Evaluate model fluxes at half-hourly scale","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"CPpbogGaC3"}],"identifier":"evaluate-model-fluxes-at-half-hourly-scale","label":"Evaluate model fluxes at half-hourly scale","html_id":"evaluate-model-fluxes-at-half-hourly-scale","implicit":true,"key":"RKYhax0GcY"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Here, we will first create a scatter plot to evaluate how the modelled fluxes (LE, H, Rn, and G) compare to those measured by the EC tower. We will assess daytime fluxes (i.e. shortwave irradiance > 100 W/m2).","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"EYWaBxzUoe"}],"key":"GAAEGhTN1F"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Select which method of EB correction you want to apply during the validation and which year you want to evaluate (considering that cover crop might not be present in all years):","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"ClXgqMrY8J"}],"key":"pmFkPt3RSG"}],"visibility":"show","key":"yQ9Cug3Ut2"},{"type":"block","kind":"notebook-code","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"w_ebc = widgets.Dropdown(\n    options=[('No EB correction', (\"LE\", \"H\")), \n             ('Residual to LE', (\"LE_RES\", \"H\")), \n             ('Residual to H', (\"LE_RES\", \"H\")), \n             ('Bowen Ratio', (\"LE_BR\", \"H_BR\")),\n             ('Ensemble correction', (\"LE_ENS\", \"H_ENS\"))],\n    value=(\"LE_ENS\", \"H_ENS\"),\n    description='EBC method:',\n)\n\nyears = np.unique(ec[\"TIMESTAMP\"].dt.year)\nw_year = widgets.Dropdown(\n    options=years,\n    value=2019,\n    description='Select year:',\n)\n\ndisplay(w_ebc, w_year)","visibility":"show","key":"K5341tq2SG"},{"type":"output","id":"31qE9uC5TfkwBsrv_X8EJ","data":[],"visibility":"show","key":"zJPcujpS75"}],"visibility":"show","key":"m2M5swwvfd"},{"type":"block","kind":"notebook-code","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"from tabulate import tabulate\n\nLE_OBS, H_OBS = w_ebc.value\nprint(f\"Using {LE_OBS} and {H_OBS} fields for validating respectively  LE and H\")\n\ndaytime = ec[\"SW_IN\"] > 100\nvalid_3seb = np.logical_and(flag_3seb < 5, daytime, ec[\"TIMESTAMP\"].dt.year == w_year.value)\nvalid_pt = np.logical_and(flag_pt < 5, daytime)\n\nle_marker = {\"color\": \"blue\", \"size\": 3}\nh_marker = {\"color\": \"red\", \"size\": 3}\ng_marker = {\"color\": \"green\", \"size\": 3}\nrn_marker = {\"color\": \"black\", \"size\": 3}\n\nfig = make_subplots(rows=1, cols=2,\n                    shared_yaxes=True,\n                    horizontal_spacing=0.01,\n                    subplot_titles=[\"3SEB\", \"TSEB-PT\"])\n\nfig.add_trace(go.Scattergl(x=netrad_3seb[valid_3seb], y=ec.loc[valid_3seb, \"NETRAD\"], \n                         name=\"Rn 3SEB\", mode=\"markers\", marker=rn_marker),\n             row=1, col=1)\n\nfig.add_trace(go.Scattergl(x=netrad_pt[valid_pt], y=ec.loc[valid_pt, \"NETRAD\"], \n                         name=\"Rn TSEB-PT\", mode=\"markers\", marker=rn_marker),\n             row=1, col=2)\n\nfig.add_trace(go.Scattergl(x=g_3seb[valid_3seb], y=ec.loc[valid_3seb, \"G\"], \n                         name=\"G 3SEB\", mode=\"markers\", marker=g_marker),\n             row=1, col=1)\n\nfig.add_trace(go.Scattergl(x=g_pt[valid_pt], y=ec.loc[valid_pt, \"G\"], \n                         name=\"G TSEB-PT\", mode=\"markers\", marker=g_marker),\n             row=1, col=2)\n\nfig.add_trace(go.Scattergl(x=le_3seb[valid_3seb], y=ec.loc[valid_3seb, LE_OBS], \n                         name=\"LE 3SEB\", mode=\"markers\", marker=le_marker),\n             row=1, col=1)\n\nfig.add_trace(go.Scattergl(x=le_pt[valid_pt], y=ec.loc[valid_pt, LE_OBS], \n                         name=\"LE TSEB-PT\", mode=\"markers\", marker=le_marker),\n             row=1, col=2)\n\nfig.add_trace(go.Scattergl(x=h_3seb[valid_3seb], y=ec.loc[valid_3seb, H_OBS], \n                         name=\"H 3SEB\", mode=\"markers\", marker=h_marker),\n             row=1, col=1)\n\nfig.add_trace(go.Scattergl(x=h_pt[valid_pt], y=ec.loc[valid_pt, H_OBS], \n                         name=\"H TSEB-PT\", mode=\"markers\", marker=h_marker),\n             row=1, col=2)\n\nfig.add_trace(go.Scatter(x=[-200, 800], y=[-200, 800], mode=\"lines\", name=\"1:1 line\", line={\"color\": \"black\", \"dash\": \"dash\"}),\n             row=1, col=1)\nfig.add_trace(go.Scatter(x=[-200, 800], y=[-200, 800], mode=\"lines\", name=\"1:1 line\", line={\"color\": \"black\", \"dash\": \"dash\"}),\n             row=1, col=2)\n\n\nfig.update_layout(title_text=f\"Observed vs. Estimated hourly turbulent fluxes at {w_site.label}\",\n                  yaxis_range=[-200, 800], xaxis_range=[-200, 800], \n                  xaxis_title=\"Estimated (W m-2)\", yaxis_title=\"Observed (W m-2)\")\nfig.update_xaxes(title_text=\"Estimated (W m-2)\", row=1, col=2)","visibility":"show","key":"r6ulaCwv2r"},{"type":"output","id":"NKwsVvFSYKgcSXoMbWgw0","data":[],"visibility":"show","key":"wdj1QGepfO"}],"visibility":"show","key":"yZTKWauAS2"},{"type":"block","kind":"notebook-content","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"LE partitioning evaluation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kzZBKfbMF1"}],"identifier":"le-partitioning-evaluation","label":"LE partitioning evaluation","html_id":"le-partitioning-evaluation","implicit":true,"key":"UWUBS5dzw7"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"We will now compare the partitioning of LE from vegetation sources (i.e. transpiration) derived from 3SEB (i.e. LEvine + LEcc) compared to the those measured from the EC flux towers using the ensemble of CEC, REA and FVS approaches ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"nrGkQCDfg7"},{"type":"cite","url":"https://doi.org/10.1016/j.agrformet.2021.108790","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"strong","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Zahn et al. 2022","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"kxOicfW8HM"}],"key":"MknTn7XC0n"}],"kind":"narrative","label":"Zahn_2022","identifier":"https://doi.org/10.1016/j.agrformet.2021.108790","enumerator":"9","key":"TgwDpDFzPu"},{"type":"text","value":".","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"p4tVqrmM9K"}],"key":"rAX5C1sSoV"}],"visibility":"show","key":"fwv53hzkdU"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ec[\"LE_C\"] = np.nanmean(ec[[\"LE_C_ECC\", \"LE_C_REA\", \"LE_C_FVS\"]], axis=1)\n\nle_c_3seb = le_vine_3seb + le_cc_3seb\n\nfig = make_subplots(rows=1, cols=2,\n                    shared_yaxes=True,\n                    horizontal_spacing=0.01,\n                   subplot_titles=(\"3SEB\", \"TSEB-PT\"))\n\nfig.add_trace(go.Scattergl(x=le_c_3seb[valid_3seb], y=ec.loc[valid_3seb, \"LE_C\"], \n                         name=\"LE_C 3SEB\", mode=\"markers\", marker=le_marker),\n             row=1, col=1)\n\nfig.add_trace(go.Scattergl(x=le_c_pt[valid_pt], y=ec.loc[valid_pt, \"LE_C\"], \n                         name=\"LE TSEB-PT\", mode=\"markers\", marker=le_marker),\n             row=1, col=2)\n\nfig.add_trace(go.Scatter(x=[-200, 800], y=[-200, 800], mode=\"lines\", name=\"1:1 line\", line={\"color\": \"black\", \"dash\": \"dash\"}),\n             row=1, col=1)\nfig.add_trace(go.Scatter(x=[-200, 800], y=[-200, 800], mode=\"lines\", name=\"1:1 line\", line={\"color\": \"black\", \"dash\": \"dash\"}),\n             row=1, col=2)\n\n\nfig.update_layout(title_text=f\"Observed vs. Estimated hourly canopy latent heat flux {w_site.label}\",\n                  yaxis_range=[-200, 800], xaxis_range=[-200, 800], \n                  xaxis_title=\"Estimated (W m-2)\", yaxis_title=\"Observed (W m-2)\")\n\nfig.update_xaxes(title_text=\"Estimated (W m-2)\", row=1, col=2)","key":"hsvx7xBueW"},{"type":"output","id":"d6bzadk0vjO45CBG0R_Vl","data":[],"key":"h77XmpdKf5"}],"key":"exmG2AoUdD"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Save outputs to an ASCII table","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ITHqKqZUtZ"}],"identifier":"save-outputs-to-an-ascii-table","label":"Save outputs to an ASCII table","html_id":"save-outputs-to-an-ascii-table","implicit":true,"key":"BWooJgVQBd"}],"key":"pqAQVpBYnu"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Define the output filename\nout_dir = Path().absolute() / \"output\"\noutfile = out_dir / f\"FLX_US-{w_site.value}_FLUXNET2015_3SEB-ROWS_HR.csv\"\n\n# Create the output folder in case it does not exist\nif not out_dir.exists():\n    out_dir.mkdir(parents=True)\n\nle_3seb = le_vine_3seb + le_cc_3seb + le_s_3seb\nh_3seb = h_vine_3seb + h_cc_3seb + h_s_3seb\nnetrad_3seb = sn_vine_3seb + sn_cc_3seb + sn_s_3seb + ln_vine_3seb + ln_cc_3seb + ln_s_3seb\n# Convert the outputs to a Python dictionary\noutdict = {\"TIMESTAMP\": ec[\"TIMESTAMP\"].dt.strftime(\"%Y%m%d%H%M\"),\n           \"FLAG_3SEB\": flag_3seb, \"LE_3SEB\": le_3seb, \"H_3SEB\": h_3seb, \"NETRAD_3SEB\": netrad_3seb, \"G_3SEB\": g_3seb, \n           \"T_S_3SEB\": t_s_3seb, \"T_CC_3SEB\": t_cc_3seb, \"T_VINE_3SEB\": t_vine_3seb, \"T_AC_3SEB\": t_ac_3seb, \n           \"LN_S_3SEB\": ln_s_3seb, \"LN_CC_3SEB\": ln_cc_3seb, \"LN_VINE_3SEB\": ln_vine_3seb, \"LE_CC_3SEB\": le_cc_3seb, \"H_CC_3SEB\": h_cc_3seb, \n           \"LE_S_3SEB\": le_s_3seb, \"H_S_3SEB\": h_s_3seb, \"LE_VINE_3SEB\": le_vine_3seb, \"H_VINE_3SEB\": h_vine_3seb, \n           \"R_S_3SEB\": r_s_3seb, \"R_SUB_3SEB\": r_sub_3seb, \"R_X_3SEB\": r_x_3seb, \"R_A_3SEB\": r_a_3seb, \"USTAR_3SEB\": u_friction_3seb, \n           \"L_MO_3SEB\":l_mo_3seb, \"ITERATIONS_3SEB\": n_iterations_3seb}\n\n# Crete the output dataframe and save it to csv\npd.DataFrame(outdict).to_csv(outfile, sep=\";\", na_rep=-9999, index=False)\nprint(f\"Saved to {outfile}\")\n\noutfile = out_dir / f\"FLX_US-{w_site.value}_FLUXNET2015_TSEB-PT-ROWS_HR.csv\"\n\n# Convert the outputs to a Python dictionary\noutdict = {\"TIMESTAMP\": ec[\"TIMESTAMP\"].dt.strftime(\"%Y%m%d%H%M\"),\n           \"FLAG_TSEBPT\": flag_pt, \"LE_TSEBPT\": le_pt, \"H_TSEBPT\": h_pt, \"NETRAD_TSEBPT\": netrad_pt, \"G_TSEBPT\": g_pt, \n           \"T_S_TSEBPT\": ts_pt, \"T_C_TSEBPT\": tc_pt, \"T_AC_TSEBPT\": t_ac_pt, \"LN_S_TSEBPT\": ln_s_pt, \"LN_C_TSEBPT\": ln_c_pt, \n           \"LE_C_TSEBPT\": le_c_pt, \"H_C_TSEBPT\": h_c_pt, \"LE_S_TSEBPT\": le_s_pt, \"H_S_TSEBPT\": h_s_pt, \"R_S_TSEBPT\": r_s_pt, \n           \"R_X_TSEBPT\": r_x_pt, \"R_A_TSEBPT\": r_a_pt, \"USTAR_TSEBPT\": u_friction_pt, \"L_MO_TSEBPT\":lmo_pt, \n           \"ITERATIONS_TSEBPT\": n_iterations_pt}\n\n# Crete the output dataframe and save it to csv\npd.DataFrame(outdict).to_csv(outfile, sep=\";\", na_rep=-9999, index=False)\nprint(f\"Saved to {outfile}\")\n","key":"FUUF2FfDaV"},{"type":"output","id":"bbtTAHAMrd7hziMpyKoy1","data":[],"key":"KXmTNssOwd"}],"key":"WE00qTYLby"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Annual ET accounting","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cSBEb7YMid"}],"identifier":"annual-et-accounting","label":"Annual ET accounting","html_id":"annual-et-accounting","implicit":true,"key":"ITLwWTjvxE"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"One of the advantages of the 3SEB model is the ability to separate the flux contributions of the different vegetation (+soil) sources. In this section, we will check how much each source (vine, cover crop and soil) contribute to the total ET and account for their annual water use.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"wJHvC4KIgT"}],"key":"rl6PFe3Z4Z"}],"key":"hfcX4xASiM"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Instantaneous to daily","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zUuTz9XdEP"}],"identifier":"instantaneous-to-daily","label":"Instantaneous to daily","html_id":"instantaneous-to-daily","implicit":true,"key":"vBKwK4fna7"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"We will first convert the instantaneous fluxes to daily, instead of aggregating all hourly 3SEB estimates we will upscale a single estimate (assuming it was obtained by a satellite overpass to daily).","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"BEBRo4pYM0"}],"key":"aQwbJxposF"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"We will use the solar irradiance upscaling method, that assumes that the ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"BHF89jFTtO"},{"type":"inlineMath","value":"\\lambda E/ S^\\downarrow","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>λ</mi><mi>E</mi><mi mathvariant=\"normal\">/</mi><msup><mi>S</mi><mo>↓</mo></msup></mrow><annotation encoding=\"application/x-tex\">\\lambda E/ S^\\downarrow</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0991em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">λ</span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"mord\">/</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8491em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mrel mtight\">↓</span></span></span></span></span></span></span></span></span></span></span>","key":"fZz1AHa0DP"},{"type":"text","value":" ratio is preserved. Therefore, the daily latent heat fluxes are obtained as:","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"uTe2rmwgcP"}],"key":"cqxSc7bcGZ"},{"type":"math","value":"\\lambda E_{daily} = S^\\downarrow_{daily} \\frac{\\lambda E_{inst.}}{S^\\downarrow_{inst.}}","label":"daily_et","identifier":"daily_et","html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>λ</mi><msub><mi>E</mi><mrow><mi>d</mi><mi>a</mi><mi>i</mi><mi>l</mi><mi>y</mi></mrow></msub><mo>=</mo><msubsup><mi>S</mi><mrow><mi>d</mi><mi>a</mi><mi>i</mi><mi>l</mi><mi>y</mi></mrow><mo>↓</mo></msubsup><mfrac><mrow><mi>λ</mi><msub><mi>E</mi><mrow><mi>i</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi mathvariant=\"normal\">.</mi></mrow></msub></mrow><msubsup><mi>S</mi><mrow><mi>i</mi><mi>n</mi><mi>s</mi><mi>t</mi><mi mathvariant=\"normal\">.</mi></mrow><mo>↓</mo></msubsup></mfrac></mrow><annotation encoding=\"application/x-tex\">\\lambda E_{daily} = S^\\downarrow_{daily} \\frac{\\lambda E_{inst.}}{S^\\downarrow_{inst.}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9805em;vertical-align:-0.2861em;\"></span><span class=\"mord mathnormal\">λ</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">d</span><span class=\"mord mathnormal mtight\">ai</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.5053em;vertical-align:-1.1339em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.967em;\"><span style=\"top:-2.3987em;margin-left:-0.0576em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">d</span><span class=\"mord mathnormal mtight\">ai</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span></span></span></span><span style=\"top:-3.1809em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mrel mtight\">↓</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.4374em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3714em;\"><span style=\"top:-2.143em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.967em;\"><span style=\"top:-2.4231em;margin-left:-0.0576em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">in</span><span class=\"mord mathnormal mtight\">s</span><span class=\"mord mathnormal mtight\">t</span><span class=\"mord mtight\">.</span></span></span></span><span style=\"top:-3.1809em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mrel mtight\">↓</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2769em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">λ</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">in</span><span class=\"mord mathnormal mtight\">s</span><span class=\"mord mathnormal mtight\">t</span><span class=\"mord mtight\">.</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.1339em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span>","enumerator":"6","html_id":"daily-et","key":"Od36ovdPrX"}],"key":"M4IrTpzg2b"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Set the local time of satellie overpass in decimal hours\noverpass = 10.5\n\n\n# Aggregate hourly irradiance and temporature to daily means\nec_daily = ec.groupby(ec[\"TIMESTAMP\"].dt.date)\nec_daily = ec_daily[[\"SW_IN\", \"TA\"]].mean().reset_index()\n# Select only the year of interest\nec_daily[\"TIMESTAMP\"] = pd.to_datetime(ec_daily[\"TIMESTAMP\"])\nec_daily = ec_daily.loc[ec_daily[\"TIMESTAMP\"].dt.year == w_year.value]\n\n# Select only the year of interest and overpass time for instantaneous estimates\nvalid = np.logical_and(ec[\"TIMESTAMP\"].dt.hour + ec[\"TIMESTAMP\"].dt.minute / 60 == overpass,\n                       ec[\"TIMESTAMP\"].dt.year == w_year.value)\n\nle_ratio = le_3seb[valid] / ec.loc[valid, \"SW_IN\"].values\nle_daily = le_ratio * ec_daily[\"SW_IN\"].values\n\nle_vine_ratio = le_vine_3seb[valid] / ec.loc[valid, \"SW_IN\"].values\nle_vine_daily = le_vine_ratio * ec_daily[\"SW_IN\"].values\n\nle_cc_ratio = le_cc_3seb[valid] / ec.loc[valid, \"SW_IN\"].values\nle_cc_daily = le_cc_ratio * ec_daily[\"SW_IN\"].values\n\nle_s_ratio = le_s_3seb[valid] / ec.loc[valid, \"SW_IN\"].values\nle_s_daily = le_s_ratio * ec_daily[\"SW_IN\"].values\n\n# convert to mm/day\net_daily = TSEB.met.flux_2_evaporation(le_daily, time_domain=24, t_k=ec_daily[\"TA\"].values)\net_vine_daily = TSEB.met.flux_2_evaporation(le_vine_daily, time_domain=24, t_k=ec_daily[\"TA\"].values)\net_cc_daily = TSEB.met.flux_2_evaporation(le_cc_daily, time_domain=24, t_k=ec_daily[\"TA\"].values)\net_s_daily = TSEB.met.flux_2_evaporation(le_s_daily, time_domain=24, t_k=ec_daily[\"TA\"].values)\n\n# get annual sums \net_annual = np.nansum(et_daily)\net_vine_annual = np.nansum(et_vine_daily)\net_cc_annual = np.nansum(et_cc_daily)\net_soil_annual = np.nansum(et_s_daily)\n\n%matplotlib inline\nfrom matplotlib import pyplot as plt\n# plot annual bar and pie chart for water accounting of each ET source \nfig, (ax1, ax2) = plt.subplots(nrows=1, ncols=2, figsize=(14, 6), dpi=300)\n# labels\net_sources = ['$ET_{total}$', '$T_{vine}$', '$T_{cc}$', '$E_{soil}$']\n# values\net_values = [et_annual, et_vine_annual, et_cc_annual, et_soil_annual]\n# relative contribution for pie chart\nratios = [et_vine_annual/et_annual, et_cc_annual/et_annual, et_soil_annual/et_annual]\n# colors for each source\ncolors = ['black', 'seagreen', 'steelblue', 'peru']\n# bar chart\nax1.bar(et_sources, et_values, color=colors)\nax1.set_ylabel('ET (mm/day)', fontsize=20)\nax1.set_title('Annual water use (mm/year)', fontsize=22)\n# pie chart\nax2.pie(ratios, labels=et_sources[1:], colors = colors[1:], autopct='%1.1f%%')\nax2.set_title('Relative water use (%)', fontsize=22)\n\nplt.show()","key":"tbb5t5ksgU"},{"type":"output","id":"d0KX9Jt0NDbv28BGm29Dp","data":[],"key":"KVLovpmA2h"}],"key":"HkTBVy7yqQ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Conclusions","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GtJGC38AZA"}],"identifier":"conclusions","label":"Conclusions","html_id":"conclusions","implicit":true,"key":"UBhtrp5pKB"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"3SEB presents the advantage of partitioning fluxes from two distict coexisting canopies, one sparse overstory and another rather horizontally homogenous understory.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"iHiqsUeJDb"}],"key":"DMCnPPZKKU"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"As compared to TSEB, it requires basically the same inputs plus an estimate of LAI separation between the overstory and the understory. With some knowledge of phenology of both layers, it is doable to make such separation","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"XMA8tCGy0P"}],"key":"GAYMHAD5Q1"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"The improvement of 3SEB over TSEB is only evident when both layers are coexisting and actively transpiring. Otherwise TSEB could be used instead due to its greater simplicity.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"opfBo30tAh"}],"key":"hJ1kjcTQN6"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"[...]","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"lVNlpSMErQ"}],"key":"gDw7iUb0ny"}],"key":"M7kFrrcwn1"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"ZIeZO4JiCE"}],"key":"WxqIr0aWDK"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Please feel free comment any thoughts. This is work in progress!!!","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"ybcK0h2Ikm"}],"key":"VPCKssIH2e"}],"key":"x3xKiZdIk0"}],"key":"xVvhg5Smpp"}],"key":"rf8jiXc73e"},"references":{"cite":{"order":["Burchard_Levine_2021","Norman_1995","Burchard_Levine_2022","Kang_2022","Nieto_2018","Campbell_1998","Raupach_1994","PRIESTLEY_1972","Zahn_2022"],"data":{"Burchard_Levine_2021":{"label":"Burchard_Levine_2021","enumerator":"1","doi":"10.1111/gcb.16002","html":"Burchard‐Levine, V., Nieto, H., Riaño, D., Kustas, W. P., Migliavacca, M., El‐Madany, T. S., Nelson, J. A., Andreu, A., Carrara, A., Beringer, J., Baldocchi, D., & Martín, M. P. (2021). A remote sensing‐based three‐source energy balance model to improve global estimations of evapotranspiration in semi‐arid tree‐grass ecosystems. <i>Global Change Biology</i>, <i>28</i>(4), 1493–1515. <a target=\"_blank\" rel=\"noreferrer\" href=\"https://doi.org/10.1111/gcb.16002\">10.1111/gcb.16002</a>","url":"https://doi.org/10.1111/gcb.16002"},"Norman_1995":{"label":"Norman_1995","enumerator":"2","doi":"10.1016/0168-1923(95)02265-y","html":"Norman, J. M., Kustas, W. P., & Humes, K. S. (1995). Source approach for estimating soil and vegetation energy fluxes in observations of directional radiometric surface temperature. <i>Agricultural and Forest Meteorology</i>, <i>77</i>(3–4), 263–293. <a target=\"_blank\" rel=\"noreferrer\" href=\"https://doi.org/10.1016/0168-1923(95)02265-y\">10.1016/0168-1923(95)02265-y</a>","url":"https://doi.org/10.1016/0168-1923(95)02265-y"},"Burchard_Levine_2022":{"label":"Burchard_Levine_2022","enumerator":"3","doi":"10.1007/s00271-022-00787-x","html":"Burchard-Levine, V., Nieto, H., Kustas, W. P., Gao, F., Alfieri, J. G., Prueger, J. H., Hipps, L. E., Bambach-Ortiz, N., McElrone, A. J., Castro, S. J., Alsina, M. M., McKee, L. G., Zahn, E., Bou-Zeid, E., & Dokoozlian, N. (2022). Application of a remote-sensing three-source energy balance model to improve evapotranspiration partitioning in vineyards. <i>Irrigation Science</i>, <i>40</i>(4–5), 593–608. <a target=\"_blank\" rel=\"noreferrer\" href=\"https://doi.org/10.1007/s00271-022-00787-x\">10.1007/s00271-022-00787-x</a>","url":"https://doi.org/10.1007/s00271-022-00787-x"},"Kang_2022":{"label":"Kang_2022","enumerator":"4","doi":"10.1007/s00271-022-00798-8","html":"Kang, Y., Gao, F., Anderson, M., Kustas, W., Nieto, H., Knipper, K., Yang, Y., White, W., Alfieri, J., Torres-Rua, A., Alsina, M. M., & Karnieli, A. (2022). Evaluation of satellite Leaf Area Index in California vineyards for improving water use estimation. <i>Irrigation Science</i>, <i>40</i>(4–5), 531–551. <a target=\"_blank\" rel=\"noreferrer\" href=\"https://doi.org/10.1007/s00271-022-00798-8\">10.1007/s00271-022-00798-8</a>","url":"https://doi.org/10.1007/s00271-022-00798-8"},"Nieto_2018":{"label":"Nieto_2018","enumerator":"5","doi":"10.1007/s00271-018-0611-y","html":"Nieto, H., Kustas, W. P., Alfieri, J. G., Gao, F., Hipps, L. E., Los, S., Prueger, J. H., McKee, L. G., & Anderson, M. C. (2018). Impact of different within-canopy wind attenuation formulations on modelling sensible heat flux using TSEB. <i>Irrigation Science</i>, <i>37</i>(3), 315–331. <a target=\"_blank\" rel=\"noreferrer\" href=\"https://doi.org/10.1007/s00271-018-0611-y\">10.1007/s00271-018-0611-y</a>","url":"https://doi.org/10.1007/s00271-018-0611-y"},"Campbell_1998":{"label":"Campbell_1998","enumerator":"6","doi":"10.1007/978-1-4612-1626-1_15","html":"Campbell, G. S., & Norman, J. M. (1998). The Light Environment of Plant Canopies. In <i>An Introduction to Environmental Biophysics</i> (pp. 247–278). Springer New York. <a target=\"_blank\" rel=\"noreferrer\" href=\"https://doi.org/10.1007/978-1-4612-1626-1_15\">10.1007/978-1-4612-1626-1_15</a>","url":"https://doi.org/10.1007/978-1-4612-1626-1_15"},"Raupach_1994":{"label":"Raupach_1994","enumerator":"7","doi":"10.1007/bf00709229","html":"Raupach, M. R. (1994). Simplified expressions for vegetation roughness length and zero-plane displacement as functions of canopy height and area index. <i>Boundary-Layer Meteorology</i>, <i>71</i>(1–2), 211–216. <a target=\"_blank\" rel=\"noreferrer\" href=\"https://doi.org/10.1007/bf00709229\">10.1007/bf00709229</a>","url":"https://doi.org/10.1007/bf00709229"},"PRIESTLEY_1972":{"label":"PRIESTLEY_1972","enumerator":"8","doi":"10.1175/1520-0493(1972)100<0081:otaosh>2.3.co;2","html":"PRIESTLEY, C. H. B., & TAYLOR, R. J. (1972). On the Assessment of Surface Heat Flux and Evaporation Using Large-Scale Parameters. <i>Monthly Weather Review</i>, <i>100</i>(2), 81–92. <a target=\"_blank\" rel=\"noreferrer\" href=\"https://doi.org/10.1175/1520-0493(1972)100&lt\">https://doi.org/10.1175/1520-0493(1972)100&lt</a>;0081:otaosh&gt;2.3.co;2","url":"https://doi.org/10.1175/1520-0493(1972)100&lt"},"Zahn_2022":{"label":"Zahn_2022","enumerator":"9","doi":"10.1016/j.agrformet.2021.108790","html":"Zahn, E., Bou-Zeid, E., Good, S. P., Katul, G. G., Thomas, C. K., Ghannam, K., Smith, J. A., Chamecki, M., Dias, N. L., Fuentes, J. D., Alfieri, J. G., Kwon, H., Caylor, K. K., Gao, Z., Soderberg, K., Bambach, N. E., Hipps, L. E., Prueger, J. H., & Kustas, W. P. (2022). Direct partitioning of eddy-covariance water and carbon dioxide fluxes into ground and plant components. <i>Agricultural and Forest Meteorology</i>, <i>315</i>, 108790. <a target=\"_blank\" rel=\"noreferrer\" href=\"https://doi.org/10.1016/j.agrformet.2021.108790\">10.1016/j.agrformet.2021.108790</a>","url":"https://doi.org/10.1016/j.agrformet.2021.108790"}}}}}