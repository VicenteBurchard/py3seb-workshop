{"version":2,"kind":"Notebook","sha256":"916cc8e2ccb20207364b0fcf4e7018e80db42187c0174c3e625fb585491879ba","slug":"b01-row-crops","location":"/B01-Row_crops.ipynb","dependencies":[],"frontmatter":{"title":"TSEB in row crops","short_title":"Row crops","subtitle":"Notebook to evaluate the interception and absorption of irradiance in row crops","keywords":["TSEB","radiation","Beer-Lambert law","albedo"],"authors":[{"nameParsed":{"literal":"Héctor Nieto","given":"Héctor","family":"Nieto"},"name":"Héctor Nieto","orcid":"0000-0003-4250-6424","email":"hector.nieto@ica.csic.es","affiliations":["Instituto de Ciencias Agrarias, ICA","CSIC"],"id":"contributors-Users\\06325897T\\Nextcloud\\1_Projects\\ILINK24\\Workshop_3SEB_UCDavis\\py3SEB-workshop\\B01-Row_crops-generated-uid-0","corresponding":true},{"nameParsed":{"literal":"Benjamin Mary","given":"Benjamin","family":"Mary"},"name":"Benjamin Mary","orcid":"0000-0001-7199-2885","affiliations":["Insituto de Ciencias Agrarias","CSIC"],"id":"contributors-Users\\06325897T\\Nextcloud\\1_Projects\\ILINK24\\Workshop_3SEB_UCDavis\\py3SEB-workshop\\B01-Row_crops-generated-uid-1"}],"affiliations":[{"id":"Instituto de Ciencias Agrarias, ICA","name":"Instituto de Ciencias Agrarias, ICA"},{"id":"CSIC","name":"CSIC"},{"id":"Insituto de Ciencias Agrarias","name":"Insituto de Ciencias Agrarias"}],"license":{"content":{"id":"CC-BY-SA-4.0","url":"https://creativecommons.org/licenses/by-sa/4.0/","name":"Creative Commons Attribution Share Alike 4.0 International","free":true,"CC":true}},"subject":"Tutorial","kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"open_access":false,"github":"https://github.com/VicenteBurchard/py3SEB-workshop","numbering":{"title":{"offset":1}},"thumbnail":"/row_crop_shadowing-ae43da1c3695df7330d20a67dafbedce.webp","exports":[{"format":"ipynb","filename":"B01-Row_crops.ipynb","url":"/B01-Row_crops-b2cfdcd6f2470e8e13644f6f7e83121c.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Summary","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MnbgUIzsQ8"}],"identifier":"summary","label":"Summary","html_id":"summary","implicit":true,"key":"yQlMvsEa3m"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"This interactive Jupyter Notebook has the objective of showing the implemenation of radiation transmission in row crops. It is based on ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"vIUeA6X66D"},{"type":"cite","url":"https://doi.org/10.1007/s00271-019-00621-x","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Parry ","key":"RMJr00qAHQ"},{"type":"emphasis","children":[{"type":"text","value":"et al.","key":"BxLwA9nHBD"}],"key":"DcNqKhXy0q"},{"type":"text","value":" (2019)","key":"tkeRPbBMkf"}],"kind":"narrative","label":"Parry_2019","identifier":"https://doi.org/10.1007/s00271-019-00621-x","enumerator":"1","key":"f09paNQ43z"}],"key":"KwZsEQ1cF0"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"We will make use of simulation models, particularly radiative transfer models at both leaf and canopy levels.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"C0iCsTg7B6"}],"key":"djERd13xiO"}],"key":"a8fDZDbQIV"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Instructions","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"N4IKgSWBl1"}],"identifier":"instructions","label":"Instructions","html_id":"instructions","implicit":true,"key":"HntPF7ZbVS"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Read carefully all the text and follow the instructions.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"hp3Wj4jdd8"}],"key":"ofUYvDM6dl"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Once each section is read, run the jupyter code cell underneath (marked as ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"MC9Pexbuop"},{"type":"inlineCode","value":"In []","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"eyaGwiHc8F"},{"type":"text","value":") by clicking the icon ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"HdUbu4KRya"},{"type":"inlineCode","value":"Run","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"q8qHr8tZrf"},{"type":"text","value":", or pressing the keys SHIFT+ENTER of your keyboard. A graphical interface will then display, which allows you to interact with and perform the assigned tasks.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"Z62qMKgrcu"}],"key":"dk3nulLXsO"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"To start, please run the following cell to import all the packages required for this notebook. Once you run the cell below, an acknowledgement message, stating all libraries were correctly imported, should be printed on screen.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"adtNK70IdB"}],"key":"N4QdvlnDrc"}],"key":"vsE6M7p6RX"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%matplotlib inline\nfrom pathlib import Path\nfrom ipywidgets import interact, interactive, fixed, widgets\nfrom IPython.display import display\nfrom functions import radiation_and_available_energy as fn\nimport numpy as np","key":"qrbqtUUySe"},{"type":"output","id":"0AdpVJhZ_VYZ8jXYnhHTz","data":[],"key":"NtQv1sdllF"}],"key":"AR5eF8mr04"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Shortwave radiation in row crops","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QAWvsr0o82"}],"identifier":"shortwave-radiation-in-row-crops","label":"Shortwave radiation in row crops","html_id":"shortwave-radiation-in-row-crops","implicit":true,"key":"ZLDOgN6OSq"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"So far, all simulations and processes have assumed a horizontally homogeneous canopy or crop, or at least dense enough to approximate a homogeneous crop. However, what happens when one is working with row crops or isolated canopies, such as in vineyards or orchards?","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"lU7rYxhsWW"}],"key":"q4oQhXIDgZ"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"The hard fact is that everything is much more complex as on the one hand the canopy is usually clumped around a stem and branches, leaving some parts of the ground fully exposed. On the other hand, in row crops, the dimension of the canopy/trellis system and the orientation of the rows also affect how light is intercepted and transmitted between the crop and the ground.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"tUTnrt3zlZ"}],"key":"NX3G0po1Ig"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"In order to evaluate this situation, we need to consider additional parameters of crop structure:","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"BVUo3vrGBA"}],"key":"RMT33QTUwf"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":8,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"The canopy height (","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"BMuya5AC9s"},{"type":"inlineMath","value":"h_c","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>h</mi><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">h_c</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">h</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"ZYbliOUdeD"},{"type":"text","value":"), since higher canopies will cast longer shadows in the interrow.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"pewH5qiiFV"}],"key":"lxcUuI1el1"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"The fraction of canopy occupied by the ground (","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"FUEuc74eIo"},{"type":"inlineMath","value":"f_c","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">f_c</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"LIFzZwnghA"},{"type":"text","value":"), or the ratio between the canopy/trellis width (","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"kTcGRbqZjl"},{"type":"inlineMath","value":"w_c","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>w</mi><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">w_c</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"Vzp9112RRX"},{"type":"text","value":") and the row spacing (L).","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"t3l84P8MBV"}],"key":"XRuevLaqY5"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"The azimuth row orientation, with respect to the north. 0º will indicate that the rows are oriented S-N, negative values indicate that the rows go from NW to SE, and positive values from NE to SW, with -90º and/or 90º showing rows oriented E-W.","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"i6JRMwbICd"}],"key":"JrEv82FBbH"}],"key":"AOPQPt3PVo"},{"type":"container","kind":"figure","children":[{"type":"image","url":"/row_crop_shadowing-ae43da1c3695df7330d20a67dafbedce.webp","alt":"Row crop shadowing model","key":"uRDjX4sI7I","urlSource":"./input/figures/row_crop_shadowing.webp"},{"type":"caption","children":[{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"captionNumber","kind":"figure","label":"row-crop-model","identifier":"row-crop-model","html_id":"row-crop-model","enumerator":"1","children":[{"type":"text","value":"Figure ","key":"lOIk74kVKu"},{"type":"text","value":"1","key":"uULhuQws8P"},{"type":"text","value":":","key":"itXH5QHjVv"}],"template":"Figure %s:","key":"MbjDpQ8AkL"},{"type":"text","value":"Canopy model for estimating the clumping index in row crops, F is the leaf area index, L is the distance between rows, hc is the canopy height, hb is the height of the canopy above ground, and wc is the canopy width","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"HXatvt21Bl"}],"key":"MsNg4ZvxUB"}],"key":"UzGJp2mzQP"}],"label":"row-crop-model","identifier":"row-crop-model","enumerator":"1","html_id":"row-crop-model","key":"iKv2TezE47"},{"type":"paragraph","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"The approach builds upon the concept of the clumping index, defined as a conversion factor that modifies the leaf area index of a real canopy (F) in a fictitious homogeneous canopy with ","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"TlnxDRQmqI"},{"type":"inlineMath","value":"LAI_{eff} = \\Omega\\left(\\theta, \\psi\\right) F","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>L</mi><mi>A</mi><msub><mi>I</mi><mrow><mi>e</mi><mi>f</mi><mi>f</mi></mrow></msub><mo>=</mo><mi mathvariant=\"normal\">Ω</mi><mrow><mo fence=\"true\">(</mo><mi>θ</mi><mo separator=\"true\">,</mo><mi>ψ</mi><mo fence=\"true\">)</mo></mrow><mi>F</mi></mrow><annotation encoding=\"application/x-tex\">LAI_{eff} = \\Omega\\left(\\theta, \\psi\\right) F</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9694em;vertical-align:-0.2861em;\"></span><span class=\"mord mathnormal\">L</span><span class=\"mord mathnormal\">A</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">e</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10764em;\">ff</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">Ω</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">ψ</span><span class=\"mclose delimcenter\" style=\"top:0em;\">)</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span></span></span></span>","key":"uKZqQZr4Et"},{"type":"text","value":", such as its gap fraction (","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"FftVxuFIiN"},{"type":"inlineMath","value":"G\\left(\\theta, \\psi\\right)","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>G</mi><mrow><mo fence=\"true\">(</mo><mi>θ</mi><mo separator=\"true\">,</mo><mi>ψ</mi><mo fence=\"true\">)</mo></mrow></mrow><annotation encoding=\"application/x-tex\">G\\left(\\theta, \\psi\\right)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">G</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">ψ</span><span class=\"mclose delimcenter\" style=\"top:0em;\">)</span></span></span></span></span>","key":"XdmNNi7rta"},{"type":"text","value":") is the same as the gap fraction of the real-world canopy:","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"DineBknnFb"}],"key":"L4frQv2IHL"},{"type":"math","value":"\\Omega\\left(\\theta,\\psi\\right) F \\kappa_b\\left(\\theta\\right)= -\\log\\left[G\\left(\\theta,\\psi\\right)\\right]","label":"eq-gapfraction","identifier":"eq-gapfraction","tight":"after","html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi mathvariant=\"normal\">Ω</mi><mrow><mo fence=\"true\">(</mo><mi>θ</mi><mo separator=\"true\">,</mo><mi>ψ</mi><mo fence=\"true\">)</mo></mrow><mi>F</mi><msub><mi>κ</mi><mi>b</mi></msub><mrow><mo fence=\"true\">(</mo><mi>θ</mi><mo fence=\"true\">)</mo></mrow><mo>=</mo><mo>−</mo><mi>log</mi><mo>⁡</mo><mrow><mo fence=\"true\">[</mo><mi>G</mi><mrow><mo fence=\"true\">(</mo><mi>θ</mi><mo separator=\"true\">,</mo><mi>ψ</mi><mo fence=\"true\">)</mo></mrow><mo fence=\"true\">]</mo></mrow></mrow><annotation encoding=\"application/x-tex\">\\Omega\\left(\\theta,\\psi\\right) F \\kappa_b\\left(\\theta\\right)= -\\log\\left[G\\left(\\theta,\\psi\\right)\\right]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">Ω</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">ψ</span><span class=\"mclose delimcenter\" style=\"top:0em;\">)</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mord\"><span class=\"mord mathnormal\">κ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">b</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mclose delimcenter\" style=\"top:0em;\">)</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">−</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\">[</span><span class=\"mord mathnormal\">G</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">ψ</span><span class=\"mclose delimcenter\" style=\"top:0em;\">)</span></span><span class=\"mclose delimcenter\" style=\"top:0em;\">]</span></span></span></span></span></span>","enumerator":"1","html_id":"eq-gapfraction","key":"RXy65FM5d7"},{"type":"paragraph","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"with ","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"mqRt9MTuIr"},{"type":"inlineMath","value":"\\kappa_b\\left(\\theta\\right)","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>κ</mi><mi>b</mi></msub><mrow><mo fence=\"true\">(</mo><mi>θ</mi><mo fence=\"true\">)</mo></mrow></mrow><annotation encoding=\"application/x-tex\">\\kappa_b\\left(\\theta\\right)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">κ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">b</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mclose delimcenter\" style=\"top:0em;\">)</span></span></span></span></span>","key":"PIjCrZNLf9"},{"type":"text","value":" is the beam extinction cofficient computed for a homogenous canopy (e.g. using ","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"RvHHVRVKsb"},{"type":"cite","url":"https://doi.org/10.1007/978-1-4612-1626-1","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"Campbell & Norman (1998)","key":"bhcBUCuRxh"}],"kind":"narrative","label":"Campbell_1998","identifier":"https://doi.org/10.1007/978-1-4612-1626-1","enumerator":"2","key":"v0Dl0jHQ8A"},{"type":"text","value":".","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"yFXHx8nHJy"}],"key":"KtTf0EOQVz"},{"type":"paragraph","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"The real canopy gap fraction is estimated on this simplied model as the sunlit part of the bare soil that is not shaded by the canopy (","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"Gp8geQZrUi"},{"type":"inlineMath","value":"1 - f_{sc}","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>−</mo><msub><mi>f</mi><mrow><mi>s</mi><mi>c</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">1 - f_{sc}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">sc</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"DcB3mOIVvH"},{"type":"text","value":") plus the gaps caused by the solar beam passing through the crop canopy (ignoring mutual shadowing between rows:","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"StJYXEC36s"}],"key":"andOfSdYo8"},{"type":"math","value":"G(\\theta ,\\psi)={f_{sc}}(\\theta ,\\psi )\\exp [ - {\\kappa _{{\\text{b}}}}(\\theta )F]+[1 - {f_{{\\text{sc}}}}(\\theta ,\\phi )].","html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>G</mi><mo stretchy=\"false\">(</mo><mi>θ</mi><mo separator=\"true\">,</mo><mi>ψ</mi><mo stretchy=\"false\">)</mo><mo>=</mo><msub><mi>f</mi><mrow><mi>s</mi><mi>c</mi></mrow></msub><mo stretchy=\"false\">(</mo><mi>θ</mi><mo separator=\"true\">,</mo><mi>ψ</mi><mo stretchy=\"false\">)</mo><mi>exp</mi><mo>⁡</mo><mo stretchy=\"false\">[</mo><mo>−</mo><msub><mi>κ</mi><mtext>b</mtext></msub><mo stretchy=\"false\">(</mo><mi>θ</mi><mo stretchy=\"false\">)</mo><mi>F</mi><mo stretchy=\"false\">]</mo><mo>+</mo><mo stretchy=\"false\">[</mo><mn>1</mn><mo>−</mo><msub><mi>f</mi><mtext>sc</mtext></msub><mo stretchy=\"false\">(</mo><mi>θ</mi><mo separator=\"true\">,</mo><mi>ϕ</mi><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">.</mi></mrow><annotation encoding=\"application/x-tex\">G(\\theta ,\\psi)={f_{sc}}(\\theta ,\\psi )\\exp [ - {\\kappa _{{\\text{b}}}}(\\theta )F]+[1 - {f_{{\\text{sc}}}}(\\theta ,\\phi )].</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">G</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">ψ</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">sc</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">ψ</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">exp</span><span class=\"mopen\">[</span><span class=\"mord\">−</span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">κ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord text mtight\"><span class=\"mord mtight\">b</span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mclose\">)</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mclose\">]</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord text mtight\"><span class=\"mord mtight\">sc</span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">ϕ</span><span class=\"mclose\">)]</span><span class=\"mord\">.</span></span></span></span></span>","enumerator":"2","key":"vRWWZsoFxn"},{"type":"paragraph","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"text","value":"and ","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"BLf03kUgAZ"},{"type":"inlineMath","value":"f_{sc}","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mrow><mi>s</mi><mi>c</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">f_{sc}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">sc</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"o48AWaoHv7"},{"type":"text","value":" is computed from (#row-crop-model) using trigonometry:","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"OiO1TcRZig"}],"key":"OCNPkvaOng"},{"type":"math","value":"{f_{{\\text{sc}}}}(\\theta ,\\phi )=\\frac{{{w_{\\text{c}}}+({h_{\\text{c}}} - {h_{\\text{b}}})\\tan \\theta |\\sin \\phi |}}{L}","html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>f</mi><mtext>sc</mtext></msub><mo stretchy=\"false\">(</mo><mi>θ</mi><mo separator=\"true\">,</mo><mi>ϕ</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mrow><msub><mi>w</mi><mtext>c</mtext></msub><mo>+</mo><mo stretchy=\"false\">(</mo><msub><mi>h</mi><mtext>c</mtext></msub><mo>−</mo><msub><mi>h</mi><mtext>b</mtext></msub><mo stretchy=\"false\">)</mo><mi>tan</mi><mo>⁡</mo><mi>θ</mi><mi mathvariant=\"normal\">∣</mi><mi>sin</mi><mo>⁡</mo><mi>ϕ</mi><mi mathvariant=\"normal\">∣</mi></mrow><mi>L</mi></mfrac></mrow><annotation encoding=\"application/x-tex\">{f_{{\\text{sc}}}}(\\theta ,\\phi )=\\frac{{{w_{\\text{c}}}+({h_{\\text{c}}} - {h_{\\text{b}}})\\tan \\theta |\\sin \\phi |}}{L}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord text mtight\"><span class=\"mord mtight\">sc</span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">ϕ</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.113em;vertical-align:-0.686em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.427em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">L</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord text mtight\"><span class=\"mord mtight\">c</span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">h</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord text mtight\"><span class=\"mord mtight\">c</span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">h</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord text mtight\"><span class=\"mord mtight\">b</span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">tan</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mord\">∣</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop\">sin</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">ϕ</span><span class=\"mord\">∣</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span>","enumerator":"3","key":"gQnoTFchRc"},{"type":"paragraph","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"text","value":"In the following interactive plot, we have added these parameters to see their effect on net radiation. In addition, to ease the comparison with previous plot, we have included a second graph that shows the fraction of absorbed radiation for both a horizontally homogeneous crop and a row crop.","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"zSEUsNRjbi"}],"key":"wtcUhOqGoS"}],"key":"BcnyIxkdCS"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"w_sn = interactive(fn.plot_net_solar_radiation,\n                   lai=fn.w_lai, leaf_angle=fn.w_leaf_angle, h_c=fn.w_hc, f_c=fn.w_fc,\n                   row_distance=fn.w_interrow, row_direction=fn.w_psi, sdn_day=fn.w_sdn, skyl=fn.w_skyl, \n                   fvis=fixed(0.55), lat=fn.w_lat, cab=fn.w_cab, cw=fn.w_cw, soil_type=fn.w_soil)\ndisplay(w_sn)","key":"AsBNi4mnPh"},{"type":"output","id":"dHOXAXm6umKq7TY8hKW63","data":[],"key":"uz2V118PFO"}],"key":"ukJZx0kcmI"},{"type":"block","kind":"notebook-content","children":[{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The sun rises from the eastern side, at noon reaches its zenith towards the north (or south depending on whether we are north or south of the equator), and sunset is from the western side. Taking into account these facts, observe the effect of changing the row orientation from E-W to S-N. There should be a drop in canopy net radiation when the sun is parallel to the rows, as in this case there should be lower radiation interception by the canopy.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NsuJ77mcov"}],"key":"CDLwy18sq8"}],"key":"T663czWEm1"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Observe that with larger canopy fractions (","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"HdqJY5u9N0"},{"type":"inlineMath","value":"f_c","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">f_c</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"xgobAkGTvF"},{"type":"text","value":", or wider canopies relative to the row spacing), the crop behaves similarly to the homogeneous crops from the previous simulation.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"oHeDOJlDUl"}],"key":"haI9FbRzrr"}],"key":"T1naOGOGC9"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"There is an interaction effect between canopy height and row separation (","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"YcPOaq8sUX"},{"type":"inlineCode","value":"L","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"lFsn2xhgn0"},{"type":"text","value":"). Narrower rows in lower crops display a similar effect as that of taller crops in wider rows.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"B1Otmj7xVA"}],"key":"fpP5qSi41O"}],"key":"C8rS3FdBtK"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Finally, as we have seen in previous interactive plots, these effects are minimized at larger proportion of diffuse radiation.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"k2bzSqjVde"}],"key":"hUukJUiEW2"}],"key":"S3OlzhSwLq"}],"key":"Nrn1MBe8xK"},{"type":"admonition","kind":"seealso","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"See Also","key":"ZkitEaaYBG"}],"key":"JB9r8Wvhy9"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Check the code in the ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"T5BEEwxYAh"},{"type":"link","url":"https://github.com/hectornieto/pyTSEB/blob/9d1f02ec2968bb323c07528ba44144c3733f3737/pyTSEB/clumping_index.py#L124","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"pyTSEB GitHub repository","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"w0bTfXWHcp"}],"urlSource":"https://github.com/hectornieto/pyTSEB/blob/9d1f02ec2968bb323c07528ba44144c3733f3737/pyTSEB/clumping_index.py#L124","data":{"kind":"file","org":"hectornieto","repo":"pyTSEB","reference":"9d1f02ec2968bb323c07528ba44144c3733f3737","file":"pyTSEB/clumping_index.py","from":124,"raw":"https://raw.githubusercontent.com/hectornieto/pyTSEB/9d1f02ec2968bb323c07528ba44144c3733f3737/pyTSEB/clumping_index.py"},"internal":false,"protocol":"github","key":"uZJI6Vruff"},{"type":"text","value":".","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"V8c1ZEOq10"}],"key":"c9PKEOudaj"}],"class":"dropdown","key":"LoLTZG9wV3"}],"key":"RQR1h8DHRX"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Implementation with actual data in ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"okSWYmmHF3"},{"type":"link","url":"https://github.com/hectornieto/pyTSEB","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"pyTSEB","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PMW8DftaAV"}],"urlSource":"https://github.com/hectornieto/pyTSEB","error":true,"key":"WFiPLnMn2h"}],"identifier":"implementation-with-actual-data-in-pytseb","label":"Implementation with actual data in pyTSEB","html_id":"implementation-with-actual-data-in-pytseb","implicit":true,"key":"P94iTq4fAQ"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"We will work some of the sites of GRAPEX. There are a few sites with measurements of below canopy radiation that could be used to evaluate the model. In this case we can work with the sites in Sierra Loma and Barrelli, with different row orientations and canopy sctructure.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"PE98frrihn"}],"key":"D3oqe11d2L"},{"type":"container","kind":"table","children":[{"type":"caption","children":[{"type":"paragraph","children":[{"type":"text","value":"Site characteristics","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"l4gXD0TTUu"}],"key":"k3Ktd7IkSv"}],"key":"MeAa9jgFm5"},{"type":"table","position":{"start":{"line":6,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"tableRow","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"tableCell","header":true,"align":"left","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Site","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"I00OCdPzfh"}],"key":"UsACPYTBPa"},{"type":"tableCell","header":true,"align":"right","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Latitude","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"UOeTuvryeG"}],"key":"VGksB4RXmS"},{"type":"tableCell","header":true,"align":"right","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Longitude","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"BllnUGdATL"}],"key":"fpdQIydf00"},{"type":"tableCell","header":true,"align":"right","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Elevation (m)","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"vk2dygXRPs"}],"key":"rsWsYDrxpD"},{"type":"tableCell","header":true,"align":"right","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Row direction (deg.)","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"TH5X5oCimY"}],"key":"HmmLI1jMlw"},{"type":"tableCell","header":true,"align":"right","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Row spacing (m)","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"P8FLaeTtDo"}],"key":"ZhCqj4M2GH"},{"type":"tableCell","header":true,"align":"right","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Min. height (m)","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"bQJ6sdqrdT"}],"key":"J7k5QKzB5Q"},{"type":"tableCell","header":true,"align":"right","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Max. height (m)","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"g45WJNareU"}],"key":"xR0cmFTbvX"},{"type":"tableCell","header":true,"align":"right","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Min. width (m)","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"tzFUar40cU"}],"key":"S3q0BcCthj"},{"type":"tableCell","header":true,"align":"right","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Max. width (m)","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"ZuIDQHgkLg"}],"key":"exvs2Fi4y7"},{"type":"tableCell","header":true,"align":"right","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"TA height (m)","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"S5jXfFxP6w"}],"key":"g0wzCoYqFM"},{"type":"tableCell","header":true,"align":"right","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"WS height (m)","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"ogCN34o3p4"}],"key":"fPDV4vI3wn"}],"key":"DVKAIjYCfU"},{"type":"tableRow","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"tableCell","align":"left","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Barrelli_007","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"i7qMuswUWK"}],"key":"NwuI8VEqFM"},{"type":"tableCell","align":"right","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"38.753","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"BCJbjZr0tL"}],"key":"U18OIbRja7"},{"type":"tableCell","align":"right","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"-122.98","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"xrWQpVHAAe"}],"key":"LIgURbkviF"},{"type":"tableCell","align":"right","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"113","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"RVxan4Ansg"}],"key":"wEqO990N1P"},{"type":"tableCell","align":"right","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"135","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"eRpdcWbJQf"}],"key":"EHrrUMnOCv"},{"type":"tableCell","align":"right","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"3.35","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"exbxd4psr2"}],"key":"U90Jtuo2f1"},{"type":"tableCell","align":"right","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"1.25","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"g5W4gy2aev"}],"key":"TuzL3JS1kP"},{"type":"tableCell","align":"right","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"2.3","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"NQlEjZilLx"}],"key":"TZMZu4q3wB"},{"type":"tableCell","align":"right","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"0.5","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"avCO30LZf5"}],"key":"ZxKHmCYtPL"},{"type":"tableCell","align":"right","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"1.8","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"O3OOMrpWbB"}],"key":"dg2aANKxv6"},{"type":"tableCell","align":"right","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"4","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"OIT94JKm1X"}],"key":"aH1ODDgp4I"},{"type":"tableCell","align":"right","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"4","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"m6l9lMZmhv"}],"key":"CP1ZtkJU5S"}],"key":"XOMhVqRm4I"},{"type":"tableRow","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"tableCell","align":"left","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Barrelli_012","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"iL9vBhexps"}],"key":"ZEkV0Z88Dz"},{"type":"tableCell","align":"right","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"38.751369","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"vBNL3m4xUv"}],"key":"O5mVs118wm"},{"type":"tableCell","align":"right","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"-122.974658","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"MLXwSkuOJn"}],"key":"JlBn6Aqo4T"},{"type":"tableCell","align":"right","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"112","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"qczv2NWYOY"}],"key":"uWGzVCtkR9"},{"type":"tableCell","align":"right","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"45","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"qJHOpikSWT"}],"key":"WffFCIS1IW"},{"type":"tableCell","align":"right","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"3.35","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"C3g9Otp9ES"}],"key":"B3tYH8wO4a"},{"type":"tableCell","align":"right","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"1.25","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"CNSduPzu8x"}],"key":"IlAOmPyj3Y"},{"type":"tableCell","align":"right","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"2.3","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"EVmoq4ks9x"}],"key":"V1LNK9O8B2"},{"type":"tableCell","align":"right","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"0.5","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"pIRJUMZOuR"}],"key":"H3WpVRQGxZ"},{"type":"tableCell","align":"right","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"1.8","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"PHKNpFpru0"}],"key":"X2Ij02NzhR"},{"type":"tableCell","align":"right","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"4.4","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"ZyDhrbQYlb"}],"key":"UE1zyHvult"},{"type":"tableCell","align":"right","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"4.4","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"UEbBhUIwq3"}],"key":"P8kbv7SbK4"}],"key":"dbbulXhB7Y"},{"type":"tableRow","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"tableCell","align":"left","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Sierra Loma-north","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"ndvfUnl4Vi"}],"key":"MveUojRyaY"},{"type":"tableCell","align":"right","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"38.289338","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"FEnBhFxLDu"}],"key":"QiuZaRSH2N"},{"type":"tableCell","align":"right","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"-121.117764","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"iKjx4Qeui6"}],"key":"Sxm42dM6q3"},{"type":"tableCell","align":"right","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"38","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"IvEZqfa8sV"}],"key":"E4g5G7uyiy"},{"type":"tableCell","align":"right","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"90","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"yUnrsEitcT"}],"key":"tplMrAPyhn"},{"type":"tableCell","align":"right","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"3.35","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"j02hEDTPNz"}],"key":"BJCHRrP7yi"},{"type":"tableCell","align":"right","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"0.5","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"ZV4ncKKSP0"}],"key":"tblukJWpjs"},{"type":"tableCell","align":"right","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"1.42","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"QsUOPxyti7"}],"key":"yLYPnqWLvS"},{"type":"tableCell","align":"right","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"0.8","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"ITshPKmcWz"}],"key":"sEWgi1ANWQ"},{"type":"tableCell","align":"right","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"2.6","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"bgi1gBxkFo"}],"key":"uH0ijVGmtU"},{"type":"tableCell","align":"right","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"5","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"NtMWJ6Ui7t"}],"key":"FssbuMZbTS"},{"type":"tableCell","align":"right","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"5","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"mJ2mgsFNc9"}],"key":"wF0xSQChi7"}],"key":"bIsyQZXQGn"},{"type":"tableRow","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"tableCell","align":"left","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Sierra Loma-south","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"gFRirE2eht"}],"key":"fQVrt5FDST"},{"type":"tableCell","align":"right","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"38.280488","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"Mw7g4emA8s"}],"key":"ji8lVGAlX4"},{"type":"tableCell","align":"right","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"-121.117597","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"qdOSYRQv1p"}],"key":"mj17z46BPV"},{"type":"tableCell","align":"right","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"37","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"orU1m2BtqC"}],"key":"qJWykgWMjC"},{"type":"tableCell","align":"right","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"90","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"rrSrXNXlmC"}],"key":"EHwJL8xGTa"},{"type":"tableCell","align":"right","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"3.35","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"Q032U36qlC"}],"key":"d75dG4xO6U"},{"type":"tableCell","align":"right","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"0.5","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"kCIXubluR2"}],"key":"FIa7lOAZoO"},{"type":"tableCell","align":"right","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"1.42","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"kClvE4teh4"}],"key":"LrUkWUmTZw"},{"type":"tableCell","align":"right","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"0.8","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"dNXNWK4CsY"}],"key":"dVM6zQotDC"},{"type":"tableCell","align":"right","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"2","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"IYL5JyX1Ss"}],"key":"v7E1SI4Od1"},{"type":"tableCell","align":"right","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"5","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"yHhs3Cltzj"}],"key":"aFs6UUkmwC"},{"type":"tableCell","align":"right","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"5","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"azy5VMqJVh"}],"key":"wrZhFHNBOW"}],"key":"dw3ImlWwXI"}],"key":"cgxdNiG46g"}],"label":"site-description","identifier":"site-description","enumerator":"1","html_id":"site-description","key":"MVL44u3mj3"},{"type":"paragraph","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"The input we will use can be found in ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"tOfz3YKfrT"},{"type":"link","url":"./input/meteo/","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[],"urlSource":"./input/meteo/","key":"D0klHB98Gu"},{"type":"text","value":" for the micrometeorological data and in ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"mAJgOUptnY"},{"type":"link","url":"./input/radiation","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[],"urlSource":"./input/radiation","key":"TTUiku7KQ7"},{"type":"text","value":" for the below canopy radiation measurements.","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"kOxdpusaGQ"}],"key":"iu4cVdHtP8"},{"type":"paragraph","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"On the other hand, LAI was obtained from Earth Observation data ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"lrYBNFN3Xq"},{"type":"citeGroup","kind":"parenthetical","children":[{"type":"cite","kind":"parenthetical","label":"Kang_2022","identifier":"https://doi.org/10.1007/s00271-022-00798-8","children":[{"type":"text","value":"Kang ","key":"Z2Q8d4ViR1"},{"type":"emphasis","children":[{"type":"text","value":"et al.","key":"zJjsNrP9MX"}],"key":"JLuw2HTSF0"},{"type":"text","value":", 2022","key":"YpwYwz3xVY"}],"enumerator":"3","key":"EIPKDKUicB"}],"key":"UWW3Dmie0o"}],"key":"sB1MkuM0VZ"}],"key":"MU2sjDFrxt"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Select a site","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tkOMIlGzbp"}],"identifier":"select-a-site","label":"Select a site","html_id":"select-a-site","implicit":true,"key":"L4YJwQ48VY"}],"key":"X0rc1WDb34"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"w_site = widgets.Dropdown(\n    options=[('Sierra Loma N', \"slmN\"), ('Sierra Loma S', \"slmS\"), ('Barrelli_007', \"bar007\"), ('Barrelli_012', \"bar012\")],\n    value=\"slmN\",\n    description='Site:',\n)\ndisplay(w_site)","key":"IBSQ0axHOA"},{"type":"output","id":"bTYwG12wBob0JJj6XGNn0","data":[],"key":"UqqrId3MSq"}],"key":"JkTvH067UQ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Read the radiation and LAI timeseries","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PvQ6VffnN6"}],"identifier":"read-the-radiation-and-lai-timeseries","label":"Read the radiation and LAI timeseries","html_id":"read-the-radiation-and-lai-timeseries","implicit":true,"key":"NJ7xAeLKYe"}],"key":"Kqoc3mbJFK"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Import Python libraries\nfrom pathlib import Path\nimport pandas as pd\n\n# Set the LAI and readiation folders\ninput_dir = Path().absolute() / \"input\"\nlai_dir = input_dir / \"canopy\"\nrad_dir = input_dir / \"radiation\"\n# Set the input files based on the chosen site\nlai_filename = lai_dir / f\"FLX_US-{w_site.value}_FLUXNET2015_AUXCANOPY_DD.csv\"\nrad_filename = rad_dir / f\"FLX_US-{w_site.value}_FLUXNET2015_AUXRADIATION_HH.csv\"\nprint(f\"LAI file path is {lai_filename}\")\nprint(f\"Radiation file path is {rad_filename}\")\n\n# Read the LAI and radiation tables\nlai = pd.read_csv(lai_filename, sep=\";\", na_values=-9999)\nrad = pd.read_csv(rad_filename, sep=\";\", na_values=-9999)\n\n# Merge both tables by date\nrad[\"TIMESTAMP\"] = pd.to_datetime(rad[\"TIMESTAMP\"], format=\"%Y%m%d%H%M\")\nlai[\"DATE\"] = pd.to_datetime(lai[\"TIMESTAMP\"], format=\"%Y%m%d\").dt.date\nlai = lai.drop(labels=[\"TIMESTAMP\"], axis=1)\nrad[\"DATE\"] = rad[\"TIMESTAMP\"].dt.date\nrad = rad.merge(lai, on=\"DATE\")\n\n# We discard all cases at night (SW_IN <=0)\nrad = rad[rad[\"SW_IN\"] > 0]\n","key":"MCgy9smNu0"},{"type":"output","id":"ZbEyNLjKtGjPvOB2ru9NC","data":[],"key":"Brn8HpvegT"}],"key":"OefqYWEMwg"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot the input variables","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"hiDrpnSWib"}],"identifier":"plot-the-input-variables","label":"Plot the input variables","html_id":"plot-the-input-variables","implicit":true,"key":"w3YEDgDAFv"}],"key":"VGtmc3KQCC"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from plotly.subplots import make_subplots\nimport plotly.graph_objects as go\nfig = make_subplots(specs=[[{\"secondary_y\": True}]])\n\nfig.add_trace(go.Scatter(x=rad[\"TIMESTAMP\"], y=rad[\"LAI\"], \n                         name=\"LAI\", \n                         mode=\"lines\", line={\"color\":\"green\"}),\n              secondary_y=True)\n\nfig.add_trace(go.Scatter(x=rad[\"TIMESTAMP\"], y=rad[\"SW_IN\"], \n                         name=\"Incoming shortwave irradiance\",\n                         mode=\"lines\",line={\"color\":\"black\"})\n             )\n\nfig.add_trace(go.Scatter(x=rad[\"TIMESTAMP\"], y=rad[\"SW_BELOW\"],\n                         name=\"Below-canopy shortwave irradiance\", \n                         mode=\"lines\", line={\"color\":\"blue\"})\n             )\n\nfig.update_layout(title_text=f\"Radiation measurements at {w_site.label}\",\n                 hovermode=\"x\")","key":"snnDXqugLY"},{"type":"output","id":"AusoWe3FYg2Xxxk-WvfQx","data":[],"key":"TT4j7SJKLm"}],"key":"gr1AyfHq1Z"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Get the canopy a priori structural properties","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cOxxuPtg5P"}],"identifier":"get-the-canopy-a-priori-structural-properties","label":"Get the canopy a priori structural properties","html_id":"get-the-canopy-a-priori-structural-properties","implicit":true,"key":"YWiBlCaUyU"}],"key":"UfzscXBngu"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import yaml\nyaml_file = input_dir / \"site_description.yaml\"\nsite_dict = yaml.safe_load(yaml_file.read_text())\nlat = float(site_dict[\"lat\"][w_site.value])\nlon = float(site_dict[\"lon\"][w_site.value])\nelev = float(site_dict[\"elev\"][w_site.value])\nrow_direction = float(site_dict[\"row_direction\"][w_site.value])\ninterrow = float(site_dict[\"interrow\"][w_site.value])\nhc_min = float(site_dict[\"hc_min\"][w_site.value])\nhc_max = float(site_dict[\"hc_max\"][w_site.value])\nwc_min = float(site_dict[\"wc_min\"][w_site.value])\nwc_max = float(site_dict[\"wc_max\"][w_site.value])\nzh = float(site_dict[\"zh\"][w_site.value])\nzm = float(site_dict[\"zm\"][w_site.value])\n\nprint(f\"{w_site.label} has the following site characteristics:\\n\"\n      f\"\\t Latitude: {lat} deg. \\n\"\n      f\"\\t Longitude: {lon} deg. \\n\"\n      f\"\\t Elevation: {elev} m \\n\"\n      f\"\\t Row direction: {row_direction} deg. \\n\"\n      f\"\\t Row spacing: {interrow} m \\n\"\n      f\"\\t Min. canopy height: {hc_min} m \\n\"\n      f\"\\t Max. canopy height: {hc_max} m \\n\"\n      f\"\\t Min. canopy width: {wc_min} m \\n\"\n      f\"\\t Max. canopy width: {wc_max} m \\n\"\n)","key":"Wupke9dsV9"},{"type":"output","id":"1NiB3aIJc0GuMvK6PVQo6","data":[],"key":"azcaeII834"}],"key":"nMlYjKjzwz"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Estimate the structural variables based on Earth Observation LAI timeseries","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lVYdJC1qtY"}],"identifier":"estimate-the-structural-variables-based-on-earth-observation-lai-timeseries","label":"Estimate the structural variables based on Earth Observation LAI timeseries","html_id":"estimate-the-structural-variables-based-on-earth-observation-lai-timeseries","implicit":true,"key":"rnweXllgZx"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"we will estimate timeseries of canopy structural variables based on LAI and empirical observations of trellis development. These relationships were obtained for Sierra Loma ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"qx9boQPz6S"},{"type":"citeGroup","kind":"parenthetical","children":[{"type":"cite","kind":"parenthetical","label":"Nieto_2018","identifier":"https://doi.org/10.1007/s00271-018-0611-y","children":[{"type":"text","value":"Nieto ","key":"NbTY2aR8IQ"},{"type":"emphasis","children":[{"type":"text","value":"et al.","key":"spUMQJjyFS"}],"key":"GnIYe0K9Ml"},{"type":"text","value":", 2018","key":"dw4Nmapzz5"}],"enumerator":"4","key":"vJsZCTOGg6"}],"key":"O65qOG989d"},{"type":"text","value":" so they might be less robust in other sites","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"OqsfUxtTe6"}],"key":"Ed1O1B7V18"},{"type":"container","kind":"figure","children":[{"type":"image","url":"/vineyard_structural_-5580286c447cd7404b3a56ad90a91a0d.png","alt":"Empirical structural functions","key":"Zj1FPxjrJb","urlSource":"./input/figures/vineyard_structural_functions.png","urlOptimized":"/vineyard_structural_-5580286c447cd7404b3a56ad90a91a0d.webp"},{"type":"caption","children":[{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"captionNumber","kind":"figure","label":"structural-functions","identifier":"structural-functions","html_id":"structural-functions","enumerator":"2","children":[{"type":"text","value":"Figure ","key":"oyuLvTO4Nq"},{"type":"text","value":"2","key":"se3onB80zt"},{"type":"text","value":":","key":"N76vDrYxyw"}],"template":"Figure %s:","key":"zQX7Ee0H17"},{"type":"text","value":"Empirical models relating canopy height , canopy width and the bottom of the canopy with the fused STARFM LAI. Solid dots represent in situ measured values","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"atCQL6bNjP"}],"key":"QtSspjFdjr"}],"key":"qsIxonHIx3"}],"label":"structural-functions","identifier":"structural-functions","enumerator":"2","html_id":"structural-functions","key":"xeiIKc7s0p"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"These empirical equations are coded in Python as:","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"YvrsphAIwR"}],"key":"GIO9bzeVJO"}],"key":"YuSY7OEvdJ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\n\n################################################################################\n# Empirical equations to generate canopy structural parameters from LAI\n################################################################################\ndef lai_2_hc(lai, hc_min):\n    slope = 0.42\n    hc = hc_min + slope * lai\n    return hc\n\n\ndef lai_2_hbratio(lai, hc_min):\n    hb_ratio_mean = 0.4848388065\n    hb_ratio = np.zeros(lai.shape)\n\n    hb_ratio[lai < hc_min] = 1. + ((hb_ratio_mean - 1.) / hc_min) * lai[\n        lai < hc_min]\n    hb_ratio[lai >= hc_min] = hb_ratio_mean\n\n    return hb_ratio\n\n\ndef lai_2_width(lai, wc_min, wc_max):\n    beta = 6.96560056\n    offset = 1.70825736\n\n    width = wc_min + (wc_max - wc_min) / (1.0 + np.exp(-beta * (lai - offset)))\n\n    return width\n\n\ndef lai_2_fcover(lai, fc_min, fc_max):\n    beta = 7.0\n    offset = 1.70\n\n    fcover = fc_min + (fc_max - fc_min) / (1.0 + np.exp(-beta * (lai - offset)))\n\n    return fcover\n\n\ndef lai_2_canopy(lai, hc_min, fc_min, fc_max):\n    hc = lai_2_hc(lai, hc_min)\n    hb_ratio = lai_2_hbratio(lai, hc_min)\n    fcover = lai_2_fcover(lai, fc_min, fc_max)\n\n    return hc, hb_ratio, fcover","key":"cDdjxVUxox"},{"type":"output","id":"a3sx275oUTRvV43jVwoC2","data":[],"key":"aIIftIWj2d"}],"key":"IWxtbcgl6Q"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"From these empirical functions together with the site description properties described in ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cwgaewoeX1"},{"type":"crossReference","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Site Description","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WhCMs6j40p"}],"identifier":"site-description","label":"site-description","kind":"heading","template":"{name}","resolved":true,"html_id":"site-description","remote":true,"url":"/seb-introduction","dataUrl":"/seb-introduction.json","key":"fYXjxEe1uX"},{"type":"text","value":" we can caluculate the time series of canopy structural variables needed to compute the shadowing as shown in ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xc1tpPfxj0"},{"type":"crossReference","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Figure ","key":"iOo9aPiPg2"},{"type":"text","value":"1","key":"u3QJiMvP3w"}],"identifier":"row-crop-model","label":"row-crop-model","kind":"figure","template":"Figure %s","enumerator":"1","resolved":true,"html_id":"row-crop-model","key":"D942FTMdHv"}],"key":"PdQUT6dX7R"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"NLeys6cZpF"}],"key":"hg7TdR10Fa"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"These equations are site specific and most likely not applicable to other sites and crops. For operational purposes, such as using Earth Observation/satellite data a trade-off must be made between accuracy and applicability.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"llC7Gbpi8M"}],"key":"f4atkgkKDi"}],"class":"dropdown","key":"bYqUCufjq3"}],"key":"hfXyjcS3Yy"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Compute the expected minimum and maximum canopy cover based on mininum and maximum canopy width\nfc_min = wc_min / interrow\nfc_max = wc_max / interrow\nh_c, hb_ratio, f_c = lai_2_canopy(rad[\"LAI\"].values,\n                                  hc_min,\n                                  fc_min,\n                                  fc_max)\n\n# Ensure that both canopy height and cover are within the limits\nh_c = np.clip(h_c, hc_min, hc_max)\nf_c = np.clip(f_c, 0, 1)","key":"z6e80MTDd3"},{"type":"output","id":"KJadD63iGm03iv8ISa-0_","data":[],"key":"TflDJmas6r"}],"key":"Df9Mz8OUOv"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We can define the spectral properties of our leaves and soil","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"l3NopVQRQj"}],"identifier":"we-can-define-the-spectral-properties-of-our-leaves-and-soil","label":"We can define the spectral properties of our leaves and soil","html_id":"we-can-define-the-spectral-properties-of-our-leaves-and-soil","implicit":true,"key":"zVlq8Y4qlu"}],"key":"FjjfqS6Rz4"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"style = {'description_width': 'initial'}\nw_rho_leaf_vis = widgets.BoundedFloatText(min=0, max=1, value=0.05, description='Leaf PAR reflectance', step=0.01, style=style)\nw_rho_leaf_nir = widgets.BoundedFloatText(min=0, max=1, value=0.35, description='Leaf NIR reflectance', step=0.01, style=style)\nw_tau_leaf_vis = widgets.BoundedFloatText(min=0, max=1, value=0.05, description='Leaf PAR transmittance', step=0.01, style=style)\nw_tau_leaf_nir = widgets.BoundedFloatText(min=0, max=1, value=0.35, description='Leaf NIR transmittance', step=0.01, style=style)\nw_rho_soil_vis = widgets.BoundedFloatText(min=0, max=1, value=0.15, description='Soil PAR reflectance', step=0.01, style=style)\nw_rho_soil_nir = widgets.BoundedFloatText(min=0, max=1, value=0.25, description='Soil NIR reflectance', step=0.01, style=style)\ndisplay(w_rho_leaf_vis, w_rho_leaf_nir, w_tau_leaf_vis, w_tau_leaf_nir, w_rho_soil_vis, w_rho_soil_nir)","key":"oLleFk9bLH"},{"type":"output","id":"vShvhMBC_yrirxNk00wKM","data":[],"key":"EswO2Lo5Kp"}],"key":"XJnNgJEDJ3"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now parse the spectral propoerties and also compute illumination angles","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ImQKCXvE0w"}],"identifier":"now-parse-the-spectral-propoerties-and-also-compute-illumination-angles","label":"Now parse the spectral propoerties and also compute illumination angles","html_id":"now-parse-the-spectral-propoerties-and-also-compute-illumination-angles","implicit":true,"key":"Z9OBZYwIuO"}],"key":"lcL0PxjVAU"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from pyTSEB import TSEB\n\n# We can get the leaf and soil spectral from the values above, or hard code the corresponding values\nrho_leaf_vis = w_rho_leaf_vis.value\nrho_leaf_nir = w_rho_leaf_nir.value\ntau_leaf_vis = w_tau_leaf_vis.value\ntau_leaf_nir = w_tau_leaf_nir.value\nrho_soil_vis = w_rho_soil_vis.value\nrho_soil_nir = w_rho_soil_nir.value\n\n# We also need to compute the solar angles\n# The time zone is PST, which corresponds to -120 deg, time longitude\nstdlon = -120\n# Call calc_sun_angles based on site coordinates and timestamp\nsza, saa = TSEB.met.calc_sun_angles(\n    np.full_like(rad['LAI'].values, lat),\n    np.full_like(rad[\"LAI\"].values, lon),\n    np.full_like(rad[\"LAI\"].values, stdlon),\n    rad['TIMESTAMP'].dt.dayofyear.values,\n    rad['TIMESTAMP'].dt.hour.values + rad['TIMESTAMP'].dt.minute.values / 60.)\n","key":"WP3XY7FVDU"},{"type":"output","id":"IXZVdetfdAAVdQN6oTH3p","data":[],"key":"UnEmgg8Y56"}],"key":"YvwFm5fp8w"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We compute the clumping index and effective LAI for row crops","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wVlfIoBmiD"}],"identifier":"we-compute-the-clumping-index-and-effective-lai-for-row-crops","label":"We compute the clumping index and effective LAI for row crops","html_id":"we-compute-the-clumping-index-and-effective-lai-for-row-crops","implicit":true,"key":"uoTd2bzWyc"}],"key":"GbVKmEJWsY"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# canopy width\nw_c = f_c * interrow\n# Canopy width to height ratio\nw_c_ratio = w_c / (h_c - hb_ratio * h_c)\n# Local LAI\nF = rad[\"LAI\"].values / f_c\n\n# Compute the relative sun-row azimuth angle\npsi = row_direction - saa\n# Compute the clumping index for row crops\n# Calculate the zenith angle of incidence towards the normal of the row direction\ntan_alpha_x = np.tan(np.radians(sza)) * abs(np.sin(np.radians(psi)))\n# Calculate the fraction that is transmitted trough vegetation\nf_sc = np.asarray(f_c * (1.0 + (tan_alpha_x / w_c)))\nf_sc = np.minimum(f_sc, 1.0)\n# Estimate the beam extinction coefficient based on a elipsoidal LAD function\n# Eq. 15.4 of Campbell and Norman (1998)\nk_be = TSEB.rad.calc_K_be_Campbell(sza, x_lad=1)\n# Calculate the real gap fraction of our canopy\ntrans = f_sc * np.exp(-k_be * F) + (1.0 - f_sc)\n# and then the clumping factor\nomega = np.zeros(F.shape)\nomega[trans > 0] = -np.log(trans[trans > 0]) / (F[trans > 0] * k_be[trans > 0])\n# And the effective LAI is the product of local LAI and the clumping index\nlai_eff = F * omega","key":"CFboDCyJPK"},{"type":"output","id":"IwqmfT-LUJta0R3XoBKdJ","data":[],"key":"NA7fhnYtV8"}],"key":"nAkWOpwT9M"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We can run get the shortwave radiation below canopy using ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AAnfI5QgAZ"},{"type":"cite","url":"https://doi.org/10.1007/978-1-4612-1626-1","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Campbell & Norman (1998)","key":"yj5O1MXxud"}],"kind":"narrative","label":"Campbell_1998","identifier":"https://doi.org/10.1007/978-1-4612-1626-1","enumerator":"2","key":"gYByZpglin"}],"identifier":"we-can-run-get-the-shortwave-radiation-below-canopy-using","label":"We can run get the shortwave radiation below canopy using ","html_id":"we-can-run-get-the-shortwave-radiation-below-canopy-using","implicit":true,"key":"ufXzmKHiGB"}],"key":"SAekjIxjOI"},{"type":"block","kind":"notebook-code","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Estimates the direct and diffuse solar radiation\ndifvis, difnir, fvis, fnir = TSEB.rad.calc_difuse_ratio(rad[\"SW_IN\"].values,\n                                                        sza,\n                                                        press=np.full_like(sza, 1013.15))\npar_dir = fvis * (1. - difvis) * rad[\"SW_IN\"].values\nnir_dir = fnir * (1. - difnir) * rad[\"SW_IN\"].values\npar_dif = fvis * difvis * rad[\"SW_IN\"].values\nnir_dif = fnir * difnir * rad[\"SW_IN\"].values\n\n# Compute the tramistted beam and diffuse radiation at both the PAR and NIR regions\n_, _, taubt, taudt = TSEB.rad.calc_spectra_Cambpell(\n                    rad[\"LAI\"].values,\n                    sza,\n                    np.array([np.full_like(sza, rho_leaf_vis), np.full_like(sza, rho_leaf_nir)]),\n                    np.array([np.full_like(sza, tau_leaf_vis), np.full_like(sza, tau_leaf_nir)]),\n                    np.array([np.full_like(sza, rho_soil_vis), np.full_like(sza, rho_soil_nir)]),\n                    lai_eff=lai_eff)\n\n# Compute the below canopy radiation as product of spectral tranmisttances and PAR and NIR irradiance\nsw_below = np.maximum(taubt[0] * par_dir + taubt[1] * nir_dir + taudt[0] * par_dif + taudt[1] * nir_dif, \n                      0)","visibility":"show","key":"qKYyHjbEnF"},{"type":"output","id":"XkFTISdCog31-Gl_yhnwh","data":[],"visibility":"show","key":"seGV9tp1Iw"}],"visibility":"show","key":"IV31rBGm9j"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We now estimate the radiation below canopy using the original clumplend and non-clumped formulation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lWhR1RdtNv"}],"identifier":"we-now-estimate-the-radiation-below-canopy-using-the-original-clumplend-and-non-clumped-formulation","label":"We now estimate the radiation below canopy using the original clumplend and non-clumped formulation","html_id":"we-now-estimate-the-radiation-below-canopy-using-the-original-clumplend-and-non-clumped-formulation","implicit":true,"key":"wEfNPsM16a"}],"key":"ODvskM4U34"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"omega_0 = TSEB.CI.calc_omega0_Kustas(rad[\"LAI\"].values, f_c, x_LAD=1, isLAIeff=True)\nomega = TSEB.CI.calc_omega_Kustas(omega_0, sza, w_C=w_c_ratio)\n# And the effective LAI is the product of local LAI and the clumping index\nlai_eff = F * omega\nalbb, albd, taubt, taudt = TSEB.rad.calc_spectra_Cambpell(\n                    rad[\"LAI\"].values,\n                    sza,\n                    np.array([np.full_like(sza, rho_leaf_vis), np.full_like(sza, rho_leaf_nir)]),\n                    np.array([np.full_like(sza, tau_leaf_vis), np.full_like(sza, tau_leaf_nir)]),\n                    np.array([np.full_like(sza, rho_soil_vis), np.full_like(sza, rho_soil_nir)]),\n                    lai_eff=lai_eff)\n\nsw_below_orig_clumped = np.maximum(taubt[0] * par_dir + taubt[1] * nir_dir + taudt[0] * par_dif + taudt[1] * nir_dif, \n                           0)\n\n# Homogeneous (non-clumped) vegetation\nalbb, albd, taubt, taudt = TSEB.rad.calc_spectra_Cambpell(\n                    rad[\"LAI\"].values,\n                    sza,\n                    np.array([np.full_like(sza, rho_leaf_vis), np.full_like(sza, rho_leaf_nir)]),\n                    np.array([np.full_like(sza, tau_leaf_vis), np.full_like(sza, tau_leaf_nir)]),\n                    np.array([np.full_like(sza, rho_soil_vis), np.full_like(sza, rho_soil_nir)]),\n                    lai_eff=rad[\"LAI\"].values)\n\nsw_below_orig = np.maximum(taubt[0] * par_dir + taubt[1] * nir_dir + taudt[0] * par_dif + taudt[1] * nir_dif, \n                           0)","key":"yi8folRUyk"},{"type":"output","id":"ECey3iHmCvAgF5lEWcxcZ","data":[],"key":"W6gmwKHYrl"}],"key":"THT94ZRdN4"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Finally we compare the different retrievals","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BjLAWsOTbk"}],"identifier":"finally-we-compare-the-different-retrievals","label":"Finally we compare the different retrievals","html_id":"finally-we-compare-the-different-retrievals","implicit":true,"key":"WKVkOcizQq"}],"key":"W61VMXSinL"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from model_evaluation import double_collocation as dc\nfrom tabulate import tabulate\n\nfig = make_subplots(rows=1, cols=3,\n                    shared_yaxes=True,\n                    horizontal_spacing=0.01,\n                   subplot_titles=[\"Row clumped\", \"Original clumped\", \"Non-clumped\"])\n\n\nfig.add_trace(go.Scattergl(x=sw_below, y=rad[\"SW_BELOW\"], \n                         name=\"Clumpling index for row crops\", mode=\"markers\"),\n             row=1, col=1)\n\nfig.add_trace(go.Scattergl(x=sw_below_orig_clumped, y=rad[\"SW_BELOW\"], \n                         name=\"Original clumpling index\", mode=\"markers\"),\n             row=1, col=2)\n\nfig.add_trace(go.Scattergl(x=sw_below_orig, y=rad[\"SW_BELOW\"], \n                         name=\"Non clumped\", mode=\"markers\"),\n             row=1, col=3)\n\nfig.add_trace(go.Scatter(x=[0, 800], y=[0, 800], mode=\"lines\", name=\"1:1 line\", line={\"color\": \"black\", \"dash\": \"dash\"}),\n             row=1, col=1)\nfig.add_trace(go.Scatter(x=[0, 800], y=[0, 800], mode=\"lines\", name=\"1:1 line\", line={\"color\": \"black\", \"dash\": \"dash\"}),\n             row=1, col=2)\nfig.add_trace(go.Scatter(x=[0, 800], y=[0, 800], mode=\"lines\", name=\"1:1 line\", line={\"color\": \"black\", \"dash\": \"dash\"}),\n             row=1, col=3)\n\nfig.update_layout(title_text=f\"Observed vs. Estimated below canopy radiation at {w_site.label}\",\n                 hovermode=\"y\", yaxis_range=[0, 800], xaxis_range=[0, 800])\n","key":"wiyOxJABC9"},{"type":"output","id":"Oks4iJiqgvKToKu6w-wVq","data":[],"key":"dF7j37r2j9"}],"key":"JqVkmjqIwb"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"mean_bias, mae, rmse = dc.error_metrics(rad[\"SW_BELOW\"].values, sw_below)\nmean_bias_orig_clumped, mae_orig_clumped, rmse_orig_clumped = dc.error_metrics(rad[\"SW_BELOW\"].values, sw_below_orig_clumped)\nmean_bias_orig, mae_orig, rmse_orig = dc.error_metrics(rad[\"SW_BELOW\"].values, sw_below_orig)\ncor, p_value, slope, intercept, d = dc.agreement_metrics(rad[\"SW_BELOW\"].values, sw_below)\ncor_orig_clumped, p_value_orig_clumped, slope_orig_clumped, intercept_orig_clumped, d_orig_clumped = dc.agreement_metrics(rad[\"SW_BELOW\"].values, sw_below_orig_clumped)\ncor_orig, p_value_orig, slope_orig, intercept_orig, d_orig = dc.agreement_metrics(rad[\"SW_BELOW\"].values, sw_below_orig)\n\ntable = [[\"bias\", mean_bias, mean_bias_orig_clumped,mean_bias_orig],\n         [\"RMSE\", rmse, rmse_orig_clumped, rmse_orig],\n         [\"MAE\",mae, mae_orig_clumped, mae_orig],\n         [\"Pearson\", cor, cor_orig_clumped, cor_orig],\n         [\"Willmot's d\", d, d_orig_clumped, d_orig]]\n\nprint(tabulate(table, headers=[\"Metric\", \"Row Crop\", \"Original CI\", \"Non clumped\"]))","key":"zJTE1sLPjv"},{"type":"output","id":"YObZevp1cRmzk60GgeT98","data":[],"key":"tkwMKCDiZw"}],"key":"PJU7btMbaZ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Save the results to an ASCII table","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"np8W3kjKCm"}],"identifier":"save-the-results-to-an-ascii-table","label":"Save the results to an ASCII table","html_id":"save-the-results-to-an-ascii-table","implicit":true,"key":"sjWdVMO9Nv"}],"key":"gmhyk9LPXj"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Define the output filename\nout_dir = Path().absolute() / \"output\"\noutfile = out_dir / f\"FLX_US-{w_site.value}_FLUXNET2015_SW-BELOW_HR.csv\"\n\n# Create the output folder in case it does not exist\nif not out_dir.exists():\n    out_dir.mkdir(parents=True)\n\n# Convert the outputs to a Python dictionary\noutdict = {\"TIMESTAMP\": rad[\"TIMESTAMP\"].dt.strftime(\"%Y%m%d%H%M\"),\n           \"SW_BELOW_ROWS\": sw_below, \n           \"SW_BELOW_ORIG-CLUMPED\": sw_below_orig_clumped, \n           \"SW_BELOW_NON-CLUMPED\": sw_below_orig,}\n\n# Crete the output dataframe and save it to csv\npd.DataFrame(outdict).to_csv(outfile, sep=\";\", na_rep=-9999, index=False)\nprint(f\"Saved to {outfile}\")","key":"SpSpSpbXr7"},{"type":"output","id":"v5pqX-OmVi1DTHpum6E2B","data":[],"key":"iThqx6obVC"}],"key":"I1UAbmKRca"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Conclusions","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"B4L4TLt146"}],"identifier":"conclusions","label":"Conclusions","html_id":"conclusions","implicit":true,"key":"GOTvl3roDA"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"However several model model limitations can be discussed based on the assumptions made in this approach:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"b3Sc0OQ9KV"}],"key":"BGuTSFNPCc"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"leaves are small, negligible in size as compared to the canopy size.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"I7MRHrrLcr"}],"key":"EUYlU2YN9T"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"leaves absorb all incident radiation (i.e. no scattering or transmission) while computing the shadowing for the clumping index.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"gEHvskHSVo"}],"key":"JQX9LCopyY"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Canopy resembles a prism","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"iDTxxnjtXu"}],"key":"T3dKHkk0o0"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"[...]","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"BC9b6m3mUK"}],"key":"ypkfD7jGco"}],"key":"rBPy14fuAV"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"ZAzWTJ4vjy"}],"key":"qGNUaGYvFY"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Please feel free comment any thoughts. This is work in progress!!!","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"jzlLXhO000"}],"key":"suQFKQWeC8"}],"key":"LrwzWaPfcn"}],"key":"j2ywZy5Sun"}],"key":"hFeX2YjLaW"},"references":{"cite":{"order":["Parry_2019","Campbell_1998","Kang_2022","Nieto_2018"],"data":{"Parry_2019":{"label":"Parry_2019","enumerator":"1","doi":"10.1007/s00271-019-00621-x","html":"Parry, C. K., Nieto, H., Guillevic, P., Agam, N., Kustas, W. P., Alfieri, J., McKee, L., & McElrone, A. J. (2019). An intercomparison of radiation partitioning models in vineyard canopies. <i>Irrigation Science</i>, <i>37</i>(3), 239–252. <a target=\"_blank\" rel=\"noreferrer\" href=\"https://doi.org/10.1007/s00271-019-00621-x\">10.1007/s00271-019-00621-x</a>","url":"https://doi.org/10.1007/s00271-019-00621-x"},"Campbell_1998":{"label":"Campbell_1998","enumerator":"2","doi":"10.1007/978-1-4612-1626-1","html":"Campbell, G. S., & Norman, J. M. (1998). <i>An Introduction to Environmental Biophysics</i>. Springer New York. <a target=\"_blank\" rel=\"noreferrer\" href=\"https://doi.org/10.1007/978-1-4612-1626-1\">10.1007/978-1-4612-1626-1</a>","url":"https://doi.org/10.1007/978-1-4612-1626-1"},"Kang_2022":{"label":"Kang_2022","enumerator":"3","doi":"10.1007/s00271-022-00798-8","html":"Kang, Y., Gao, F., Anderson, M., Kustas, W., Nieto, H., Knipper, K., Yang, Y., White, W., Alfieri, J., Torres-Rua, A., Alsina, M. M., & Karnieli, A. (2022). Evaluation of satellite Leaf Area Index in California vineyards for improving water use estimation. <i>Irrigation Science</i>, <i>40</i>(4–5), 531–551. <a target=\"_blank\" rel=\"noreferrer\" href=\"https://doi.org/10.1007/s00271-022-00798-8\">10.1007/s00271-022-00798-8</a>","url":"https://doi.org/10.1007/s00271-022-00798-8"},"Nieto_2018":{"label":"Nieto_2018","enumerator":"4","doi":"10.1007/s00271-018-0611-y","html":"Nieto, H., Kustas, W. P., Alfieri, J. G., Gao, F., Hipps, L. E., Los, S., Prueger, J. H., McKee, L. G., & Anderson, M. C. (2018). Impact of different within-canopy wind attenuation formulations on modelling sensible heat flux using TSEB. <i>Irrigation Science</i>, <i>37</i>(3), 315–331. <a target=\"_blank\" rel=\"noreferrer\" href=\"https://doi.org/10.1007/s00271-018-0611-y\">10.1007/s00271-018-0611-y</a>","url":"https://doi.org/10.1007/s00271-018-0611-y"}}}}}