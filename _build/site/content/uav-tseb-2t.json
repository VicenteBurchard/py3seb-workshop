{"version":2,"kind":"Notebook","sha256":"18dc9b54c1df59e1db8627748874cf7bcaf8f3bcdbe027d6348b97d54ace44f4","slug":"uav-tseb-2t","location":"/202-UAV_TSEB-2T.ipynb","dependencies":[],"frontmatter":{"title":"TSEB running with component Tc and Ts temperatures","short_title":"TSEB-2T","subtitle":"Notebook to evaluate the TSEB-2T version that uses directly soil and canopy temperatures retrieved from very high TIR imagery","keywords":["TSEB","TSEB-2T","component temperatures"],"authors":[{"nameParsed":{"literal":"Héctor Nieto","given":"Héctor","family":"Nieto"},"name":"Héctor Nieto","orcid":"0000-0003-4250-6424","email":"hector.nieto@ica.csic.es","affiliations":["Instituto de Ciencias Agrarias, ICA","CSIC"],"id":"contributors-202-UAV_TSEB-2T-generated-uid-0","corresponding":true},{"nameParsed":{"literal":"Benjamin Mary","given":"Benjamin","family":"Mary"},"name":"Benjamin Mary","orcid":"0000-0001-7199-2885","affiliations":["Insituto de Ciencias Agrarias","CSIC"],"id":"contributors-202-UAV_TSEB-2T-generated-uid-1"}],"affiliations":[{"id":"Instituto de Ciencias Agrarias, ICA","name":"Instituto de Ciencias Agrarias, ICA"},{"id":"CSIC","name":"CSIC"},{"id":"Insituto de Ciencias Agrarias","name":"Insituto de Ciencias Agrarias"}],"license":{"content":{"id":"CC-BY-SA-4.0","url":"https://creativecommons.org/licenses/by-sa/4.0/","name":"Creative Commons Attribution Share Alike 4.0 International","free":true,"CC":true}},"subject":"Tutorial","kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"open_access":false,"github":"https://github.com/VicenteBurchard/py3SEB-workshop","numbering":{"title":{"offset":1}},"edit_url":"https://github.com/VicenteBurchard/py3SEB-workshop/blob/master/202-UAV_TSEB-2T.ipynb","thumbnail":"/vineyard_structural_-59f51fdb831e95cbac9c5249ce0cd27d.png","thumbnailOptimized":"/vineyard_structural_-59f51fdb831e95cbac9c5249ce0cd27d.webp","exports":[{"format":"ipynb","filename":"202-UAV_TSEB-2T.ipynb","url":"/202-UAV_TSEB-2T-e9b54dd812dfb9a28215546ea8ef0840.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Summary","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"o15dJlUP0P"}],"identifier":"summary","label":"Summary","html_id":"summary","implicit":true,"key":"PQFJjowDtw"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"This interactive Jupyter Notebook has the objective of showing the implemenation of TSEB-2T with UAV imagery, which is based on  ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"JH3sNvqI26"},{"type":"cite","url":"https://doi.org/10.1007/s00271-018-0585-9","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Nieto ","key":"LoBRpXMGJM"},{"type":"emphasis","children":[{"type":"text","value":"et al.","key":"nlNhKWQa8I"}],"key":"pKztrAhy4V"},{"type":"text","value":" (2018)","key":"KHGFmP0zf1"}],"kind":"narrative","label":"Nieto_2018","identifier":"https://doi.org/10.1007/s00271-018-0585-9","enumerator":"1","key":"k95OZbZuIP"},{"type":"text","value":".","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"J14okEzRdn"}],"key":"wPz6EmZB0B"}],"key":"KZxOUZwSND"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Instructions","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"c77IDyGGqw"}],"identifier":"instructions","label":"Instructions","html_id":"instructions","implicit":true,"key":"u86jsZiMo7"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Read carefully all the text and follow the instructions.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"s0sAzFzAS1"}],"key":"sUPeR6SIob"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Once each section is read, run the jupyter code cell underneath (marked as ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"IYIMEtrvtA"},{"type":"inlineCode","value":"In []","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"ZhRRLgYQ6s"},{"type":"text","value":") by clicking the icon ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"X8TAVygTdZ"},{"type":"inlineCode","value":"Run","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"Dz2baNYMpW"},{"type":"text","value":", or pressing the keys SHIFT+ENTER of your keyboard. A graphical interface will then display, which allows you to interact with and perform the assigned tasks.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"DclspPVwfc"}],"key":"KEPWaLJlSx"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"To start, please run the following cell to import all the packages required for this notebook. Once you run the cell below, an acknowledgement message, stating all libraries were correctly imported, should be printed on screen.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"FAPnCJCvSd"}],"key":"IfBUfDlOju"}],"key":"M2IRRY3drq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%matplotlib inline\nfrom ipywidgets import interact, interactive, fixed, widgets\nfrom IPython.display import display\nimport numpy as np\nprint(\"Libraries imported, you can continue!\")","key":"l8mfJ3n2Zh"},{"type":"output","id":"gv0yXRijdlhHp0zSVe3OF","data":[],"key":"qJHp9ZnlYc"}],"key":"jMaHhCCByw"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"TSEB-2T","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DMuAlzb2Vo"}],"identifier":"tseb-2t","label":"TSEB-2T","html_id":"tseb-2t","implicit":true,"key":"fBHZ61GDwZ"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"The component temperature TSEB-2T ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"kxKu3dEeoq"},{"type":"citeGroup","kind":"parenthetical","children":[{"type":"cite","kind":"parenthetical","label":"Shuttleworth_1985","identifier":"https://doi.org/10.1002/qj.49711146910","children":[{"type":"text","value":"Shuttleworth & Wallace, 1985","key":"QskzH6ujtA"}],"enumerator":"2","key":"s0lUsf8oHt"}],"key":"keL89VjrKu"},{"type":"text","value":" was specifically designed to run TSEB when having already retrieved the soil (","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"DaytxY0H55"},{"type":"inlineMath","value":"T_S","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>T</mi><mi>S</mi></msub></mrow><annotation encoding=\"application/x-tex\">T_S</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05764em;\">S</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"YoZt3OvGgJ"},{"type":"text","value":") and canopy (","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"I97TAiqUsS"},{"type":"inlineMath","value":"T_C","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>T</mi><mi>C</mi></msub></mrow><annotation encoding=\"application/x-tex\">T_C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07153em;\">C</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"rYVYnDXNYk"},{"type":"text","value":") temeperatures. Therefore, TSEB-2T does not need to realy on an initial guess of potential transpiration and avoids the iterative reduction of canopy transpiration until realistic fluxes are obtained. Instead it computes soil and canopy sensible heat fluxes directly from the soil and canopy temperatures parsed into the model:","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"guqoQZu33K"}],"key":"FWOYN3UehY"},{"type":"math","value":"H_C & = \\rho C_p \\frac{T_C - T_{AC}}{R_x}\\\\\nH_S & = \\rho C_p \\frac{T_S - T_{AC}}{R_s}","html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mtable rowspacing=\"0.25em\" columnalign=\"right left\" columnspacing=\"0em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><msub><mi>H</mi><mi>C</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mi>ρ</mi><msub><mi>C</mi><mi>p</mi></msub><mfrac><mrow><msub><mi>T</mi><mi>C</mi></msub><mo>−</mo><msub><mi>T</mi><mrow><mi>A</mi><mi>C</mi></mrow></msub></mrow><msub><mi>R</mi><mi>x</mi></msub></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><msub><mi>H</mi><mi>S</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mi>ρ</mi><msub><mi>C</mi><mi>p</mi></msub><mfrac><mrow><msub><mi>T</mi><mi>S</mi></msub><mo>−</mo><msub><mi>T</mi><mrow><mi>A</mi><mi>C</mi></mrow></msub></mrow><msub><mi>R</mi><mi>s</mi></msub></mfrac></mrow></mstyle></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\begin{align*}\nH_C &amp; = \\rho C_p \\frac{T_C - T_{AC}}{R_x}\\\\\nH_S &amp; = \\rho C_p \\frac{T_S - T_{AC}}{R_s}\n\\end{align*}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:4.9927em;vertical-align:-2.2463em;\"></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-r\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.7463em;\"><span style=\"top:-4.7463em;\"><span class=\"pstrut\" style=\"height:3.3603em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07153em;\">C</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-2.25em;\"><span class=\"pstrut\" style=\"height:3.3603em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05764em;\">S</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.2463em;\"><span></span></span></span></span></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.7463em;\"><span style=\"top:-4.7463em;\"><span class=\"pstrut\" style=\"height:3.3603em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord mathnormal\">ρ</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">p</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3603em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07153em;\">C</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">A</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07153em;\">C</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.836em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span><span style=\"top:-2.25em;\"><span class=\"pstrut\" style=\"height:3.3603em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord mathnormal\">ρ</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">p</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3603em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">s</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05764em;\">S</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">A</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07153em;\">C</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.836em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.2463em;\"><span></span></span></span></span></span></span></span></span></span></span></span>","enumerator":"1","key":"OCED8GHUYg"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"with","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"EkfM6UKSel"}],"key":"wdhI1N82VS"},{"type":"math","value":"T_{AC} = \\frac{R_a/T_A + R_x/T_C + R_S/T_S}{1/T_A + 1/T_C + 1 T_S}","tight":"before","html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>T</mi><mrow><mi>A</mi><mi>C</mi></mrow></msub><mo>=</mo><mfrac><mrow><msub><mi>R</mi><mi>a</mi></msub><mi mathvariant=\"normal\">/</mi><msub><mi>T</mi><mi>A</mi></msub><mo>+</mo><msub><mi>R</mi><mi>x</mi></msub><mi mathvariant=\"normal\">/</mi><msub><mi>T</mi><mi>C</mi></msub><mo>+</mo><msub><mi>R</mi><mi>S</mi></msub><mi mathvariant=\"normal\">/</mi><msub><mi>T</mi><mi>S</mi></msub></mrow><mrow><mn>1</mn><mi mathvariant=\"normal\">/</mi><msub><mi>T</mi><mi>A</mi></msub><mo>+</mo><mn>1</mn><mi mathvariant=\"normal\">/</mi><msub><mi>T</mi><mi>C</mi></msub><mo>+</mo><mn>1</mn><msub><mi>T</mi><mi>S</mi></msub></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">T_{AC} = \\frac{R_a/T_A + R_x/T_C + R_S/T_S}{1/T_A + 1/T_C + 1 T_S}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">A</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07153em;\">C</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.363em;vertical-align:-0.936em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.427em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1/</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">A</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\">1/</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07153em;\">C</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05764em;\">S</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">a</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">/</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">A</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">/</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07153em;\">C</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05764em;\">S</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">/</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05764em;\">S</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.936em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span>","enumerator":"2","key":"fVSHKAbpWl"},{"type":"admonition","kind":"seealso","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"See Also","key":"Mp0p58d618"}],"key":"XysE2ahylU"},{"type":"paragraph","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"The full code for the TSEB-2T is at the ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"SYG8oTweay"},{"type":"link","url":"https://github.com/hectornieto/pyTSEB/blob/382e4fc01e965143ebafdaefe5be9b45c737455a/pyTSEB/TSEB.py#L144","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"pyTSEB GitHub repository","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"fnsGvRGWXc"}],"urlSource":"https://github.com/hectornieto/pyTSEB/blob/382e4fc01e965143ebafdaefe5be9b45c737455a/pyTSEB/TSEB.py#L144","data":{"kind":"file","org":"hectornieto","repo":"pyTSEB","reference":"382e4fc01e965143ebafdaefe5be9b45c737455a","file":"pyTSEB/TSEB.py","from":144,"raw":"https://raw.githubusercontent.com/hectornieto/pyTSEB/382e4fc01e965143ebafdaefe5be9b45c737455a/pyTSEB/TSEB.py"},"internal":false,"protocol":"github","key":"DURcghKXKf"}],"key":"aeFgghI4jb"}],"class":"dropdown","key":"xElmiyJYjT"}],"key":"BDPghHHLUw"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Application with UAV data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XO1ScoD5G1"}],"identifier":"application-with-uav-data","label":"Application with UAV data","html_id":"application-with-uav-data","implicit":true,"key":"fVLDU1KU89"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"For this exercise we will implmenent a code to run TSEB-2T with UAV imagery. We will use the canopy and soil temperatures that we derived in the ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"mCnagD6dTs"},{"type":"link","url":"./501-canopy_and_soil_temperatures.ipynb","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"501​-canopy​_and​_soil​_temperatures","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"H8KtpKHK7F"}],"urlSource":"./501-canopy_and_soil_temperatures.ipynb","key":"KmjeVOAZME"},{"type":"text","value":" notebook, which corresponds to the save UAV acquisition stored in the subfolder ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"wPtJ3RPy3v"},{"type":"link","url":"./input/pyTSEB%5D","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"./input/pyTSEB","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"fXDhmzFtBs"}],"urlSource":"./input/pyTSEB%5D","key":"SprvsoNE15"}],"key":"joYDQNsxRn"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"VrEhTR7rV7"}],"key":"dnCLLp7QXN"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"You will also see that running TSEB with an image is very similar to what we did in previous exercises when running the models with ASCII tables. The only differences will be on the way we read the inputs and save the outputs.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"NefzzWAn9u"}],"key":"ncMDRIp7er"}],"key":"TXFkEuKWnW"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"As with the previous exercices, we will work with the sites of GRAPEX, in this case since the UAV is over Sierra Loma we will use the informatio from that site.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"g2o2c6R55B"}],"key":"XKNTiarNo5"},{"type":"container","kind":"table","children":[{"type":"caption","children":[{"type":"paragraph","children":[{"type":"text","value":"Site characteristics","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"ncpVH2y22c"}],"key":"pF844iA44g"}],"key":"QSC9oCyxOu"},{"type":"table","position":{"start":{"line":13,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"tableRow","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"tableCell","header":true,"align":"left","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Site","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"BCuZcGcUsx"}],"key":"Ab63LnxLpO"},{"type":"tableCell","header":true,"align":"right","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Latitude","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"SXi2JAoYLv"}],"key":"W8YAil7VBG"},{"type":"tableCell","header":true,"align":"right","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Longitude","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"MP9FxnQab9"}],"key":"opZsNL9Y04"},{"type":"tableCell","header":true,"align":"right","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Elevation (m)","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"iiEz5pL4X9"}],"key":"YyibKbbD0X"},{"type":"tableCell","header":true,"align":"right","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Row direction (deg.)","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"CD4MPkSP0v"}],"key":"DYxbs9GNhM"},{"type":"tableCell","header":true,"align":"right","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Row spacing (m)","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"z2IPy6N4Vv"}],"key":"rZphsKC337"},{"type":"tableCell","header":true,"align":"right","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Min. height (m)","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"tPDXELg1xY"}],"key":"x4bq2vJRCz"},{"type":"tableCell","header":true,"align":"right","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Max. height (m)","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"Apk6udvmum"}],"key":"X4HQVzz30w"},{"type":"tableCell","header":true,"align":"right","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Min. width (m)","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"K3l3Mi9rHu"}],"key":"DgUK9pqMIM"},{"type":"tableCell","header":true,"align":"right","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Max. width (m)","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"E7VUBD90Hj"}],"key":"BmlGQueEDk"},{"type":"tableCell","header":true,"align":"right","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"TA height (m)","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"LcfmNWRAha"}],"key":"s4FWCKFxxT"},{"type":"tableCell","header":true,"align":"right","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"WS height (m)","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"KWLDkbh69c"}],"key":"purcn6GaXo"}],"key":"fuGBjDj5T5"},{"type":"tableRow","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"tableCell","align":"left","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Sierra Loma-north","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"vbpWprqNm3"}],"key":"kUNdOgZKAY"},{"type":"tableCell","align":"right","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"38.289338","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"QgmMsq43t3"}],"key":"vmth3lCdrf"},{"type":"tableCell","align":"right","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"-121.117764","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"StzYmzo48G"}],"key":"Cy4VAoQRPl"},{"type":"tableCell","align":"right","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"38","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"vGeFtpKxD3"}],"key":"JuTkhM6kOz"},{"type":"tableCell","align":"right","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"90","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"B3VwNamnKA"}],"key":"HtbwgYxzmV"},{"type":"tableCell","align":"right","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"3.35","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"hvvM81Izpe"}],"key":"Fptc8Yrr2f"},{"type":"tableCell","align":"right","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"0.5","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"x4uD4xKPSq"}],"key":"hOABKiFtl3"},{"type":"tableCell","align":"right","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"1.42","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"z1uYiDj3i7"}],"key":"oW1tFyYoFZ"},{"type":"tableCell","align":"right","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"0.8","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"ck00hhoJVi"}],"key":"mKieBxhU1W"},{"type":"tableCell","align":"right","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"2.6","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"WLMOMsPhHu"}],"key":"YFbcdsNYwM"},{"type":"tableCell","align":"right","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"5","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"ZmvLK7uHMz"}],"key":"UBoYGPYJfC"},{"type":"tableCell","align":"right","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"5","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"Hvpou0FRM0"}],"key":"wWPFycrRtx"}],"key":"JvU6dT7Tdj"},{"type":"tableRow","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"tableCell","align":"left","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"Sierra Loma-south","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"wCg01obGfI"}],"key":"p9V5pm4yDC"},{"type":"tableCell","align":"right","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"38.280488","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"AdwkNl24LK"}],"key":"r8ynPRmOjN"},{"type":"tableCell","align":"right","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"-121.117597","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"trRDknD31E"}],"key":"OKi1Nmx60y"},{"type":"tableCell","align":"right","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"37","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"FNnD8GfJ8l"}],"key":"FfwchaXcJF"},{"type":"tableCell","align":"right","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"90","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"ZQsOEjQTG3"}],"key":"nfZcBdXetV"},{"type":"tableCell","align":"right","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"3.35","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"PXbHu4U4xE"}],"key":"tVSI2MSUxr"},{"type":"tableCell","align":"right","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"0.5","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"JqcZEYtKF8"}],"key":"bTt0zQoMoa"},{"type":"tableCell","align":"right","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"1.42","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"xaadkHzwE5"}],"key":"sgJMi4I3hw"},{"type":"tableCell","align":"right","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"0.8","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"HuiZDUCW4X"}],"key":"rE7wHF7bJd"},{"type":"tableCell","align":"right","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"2","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"Kfkh17Mufv"}],"key":"HAjVjZ3Xz9"},{"type":"tableCell","align":"right","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"5","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"QB2uWiCs4q"}],"key":"O5dIzeXstt"},{"type":"tableCell","align":"right","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"5","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"mSfboGOmy4"}],"key":"dJuvcCfiy9"}],"key":"Nv7XvwrVc0"}],"key":"dj4obTyOat"}],"label":"site-description","identifier":"site-description","enumerator":"1","html_id":"site-description","key":"UpR36YcNkj"},{"type":"heading","depth":3,"position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"Define working folders","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"f2yvyJ7fc3"}],"identifier":"define-working-folders","label":"Define working folders","html_id":"define-working-folders","implicit":true,"key":"JUVVRX2yws"}],"key":"ZkEJkZ2EDv"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from pathlib import Path\nsite = \"slmN\"\n# Define the working directories\nworkdir = Path()\ninput_dir = workdir / \"input\" / \"pyTSEB\"  # here we have LAI, fc and TC_TS imagery that we will use\nprint(f\"Input folder is {input_dir}\")","key":"mgvSTqxKTm"},{"type":"output","id":"wLIw3UU7aCXGvU5J8PPJg","data":[],"key":"OpjtmWoDuO"}],"key":"zCJblFVlBH"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Read the LAI and ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pbHDUmsHIG"},{"type":"inlineMath","value":"f_c","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">f_c</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"gEv6FwhvsL"},{"type":"text","value":" imagery","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RQkx895oXx"}],"identifier":"read-the-lai-and-f-c-imagery","label":"Read the LAI and f_c imagery","html_id":"read-the-lai-and-f-c-imagery","implicit":true,"key":"f5SDim5X7c"}],"key":"qmF3QSlj6v"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Import Python libraries\nfrom osgeo import gdal\n\nlai_image = input_dir / \"ExampleImage_LAI.tif\"\nfc_image = input_dir / \"ExampleImage_Fc.tif\"\n\n# Read the LAI GDAL file and store it in a numpy array\nfid = gdal.Open(str(lai_image), gdal.GA_ReadOnly)\nlai = fid.GetRasterBand(1).ReadAsArray()\n# Get also the geotransform and projection as it is the same for all the products\ngt = fid.GetGeoTransform()\nproj = fid.GetProjection()\n\n# Read the fc GDAL file and store it in a numpy array\nfid = gdal.Open(str(fc_image), gdal.GA_ReadOnly)\nf_c = fid.GetRasterBand(1).ReadAsArray()\ndel fid\nprint(\"Read fractional cover and LAI\")","key":"HxFkHPOths"},{"type":"output","id":"nf2oIXHreMVizhvsd8G1j","data":[],"key":"q7jabyZzMq"}],"key":"CDMGEZe4zb"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Get the canopy a priori structural properties","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Jy2wyy4fpf"}],"identifier":"get-the-canopy-a-priori-structural-properties","label":"Get the canopy a priori structural properties","html_id":"get-the-canopy-a-priori-structural-properties","implicit":true,"key":"Su18EE9Rye"}],"key":"cOMqf2tDxU"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import yaml\nyaml_file = input_dir.parent / \"site_description.yaml\"\nsite_dict = yaml.safe_load(yaml_file.read_text())\nlat = float(site_dict[\"lat\"][site])\nlon = float(site_dict[\"lon\"][site])\nelev = float(site_dict[\"elev\"][site])\nrow_direction = float(site_dict[\"row_direction\"][site])\ninterrow = float(site_dict[\"interrow\"][site])\nhc_min = float(site_dict[\"hc_min\"][site])\nhc_max = float(site_dict[\"hc_max\"][site])\nwc_min = float(site_dict[\"wc_min\"][site])\nwc_max = float(site_dict[\"wc_max\"][site])\nzh = float(site_dict[\"zh\"][site])\nzm = float(site_dict[\"zm\"][site])\n\nprint(f\"{site} has the following site characteristics:\\n\"\n      f\"\\t Latitude: {lat} deg. \\n\"\n      f\"\\t Longitude: {lon} deg. \\n\"\n      f\"\\t Elevation: {elev} m \\n\"\n      f\"\\t Row direction: {row_direction} deg. \\n\"\n      f\"\\t Row spacing: {interrow} m \\n\"\n      f\"\\t Min. canopy height: {hc_min} m \\n\"\n      f\"\\t Max. canopy height: {hc_max} m \\n\"\n      f\"\\t Min. canopy width: {wc_min} m \\n\"\n      f\"\\t Max. canopy width: {wc_max} m \\n\"\n      f\"\\t Air temperature measurement height: {zh} m \\n\"\n      f\"\\t Wind speed temperature measurement height: {zh} m\"\n)","key":"UAp3E1Kib5"},{"type":"output","id":"hfucifZtqZHvY1QtRbAQT","data":[],"key":"tlrclVjckx"}],"key":"HE1KtpM2eF"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Estimate the structural variables based on Earth Observation LAI timeseries","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Po1CDexBIV"}],"identifier":"estimate-the-structural-variables-based-on-earth-observation-lai-timeseries","label":"Estimate the structural variables based on Earth Observation LAI timeseries","html_id":"estimate-the-structural-variables-based-on-earth-observation-lai-timeseries","implicit":true,"key":"NPKO9rGURM"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"As with the previous exercise, we could estimate the canopy structural variables based on LAI and empirical observations of trellis development.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"xyy3wDzCkq"}],"key":"UguD9UiMeg"},{"type":"container","kind":"figure","children":[{"type":"image","url":"/vineyard_structural_-59f51fdb831e95cbac9c5249ce0cd27d.png","alt":"Empirical structural functions","key":"xdJPR5MhJS","urlSource":"./input/figures/vineyard_structural_functions.png","urlOptimized":"/vineyard_structural_-59f51fdb831e95cbac9c5249ce0cd27d.webp"},{"type":"caption","children":[{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"captionNumber","kind":"figure","label":"structural-functions","identifier":"structural-functions","html_id":"structural-functions","enumerator":"2","children":[{"type":"text","value":"Figure ","key":"HAfXB24alO"},{"type":"text","value":"2","key":"DGxJy45Dvt"},{"type":"text","value":":","key":"eE6AshsGSJ"}],"template":"Figure %s:","key":"djn8eZatDC"},{"type":"text","value":"Empirical models relating canopy height , canopy width and the bottom of the canopy with the fused STARFM LAI. Solid dots represent in situ measured values","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"d7rRAg1gCS"}],"key":"j4R3gJz2hX"}],"key":"vxmJifJsYq"}],"label":"structural-functions","identifier":"structural-functions","enumerator":"1","html_id":"structural-functions","key":"fsAlFvrktl"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"These empirical equations are coded in Python as:","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"NuuHW6M8Pc"}],"key":"eNx4eRPUCw"}],"key":"SgVKdLdqso"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\n\n################################################################################\n# Empirical equations to generate canopy structural parameters from LAI\n################################################################################\ndef lai_2_hc(lai, hc_min):\n    slope = 0.42\n    hc = hc_min + slope * lai\n    return hc\n\n\ndef lai_2_hbratio(lai, hc_min):\n    hb_ratio_mean = 0.4848388065\n    hb_ratio = np.zeros(lai.shape)\n\n    hb_ratio[lai < hc_min] = 1. + ((hb_ratio_mean - 1.) / hc_min) * lai[\n        lai < hc_min]\n    hb_ratio[lai >= hc_min] = hb_ratio_mean\n\n    return hb_ratio\n\n\ndef lai_2_width(lai, wc_min, wc_max):\n    beta = 6.96560056\n    offset = 1.70825736\n\n    width = wc_min + (wc_max - wc_min) / (1.0 + np.exp(-beta * (lai - offset)))\n\n    return width\n\n\ndef lai_2_fcover(lai, fc_min, fc_max):\n    beta = 7.0\n    offset = 1.70\n\n    fcover = fc_min + (fc_max - fc_min) / (1.0 + np.exp(-beta * (lai - offset)))\n\n    return fcover\n\n\ndef lai_2_canopy(lai, hc_min, fc_min, fc_max):\n    hc = lai_2_hc(lai, hc_min)\n    hb_ratio = lai_2_hbratio(lai, hc_min)\n    fcover = lai_2_fcover(lai, fc_min, fc_max)\n\n    return hc, hb_ratio, fcover","key":"jrVaBDDm46"},{"type":"output","id":"ULA2T66CviDFsb6xuM_K6","data":[],"key":"lJAAyqeQj1"}],"key":"FbH4njAFa5"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"From these empirical functions together with the site description properties described in ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Fsb9QrBfRg"},{"type":"crossReference","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Site Description","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QngRQPiHUg"}],"identifier":"site-description","label":"site-description","kind":"heading","template":"{name}","resolved":true,"html_id":"site-description","remote":true,"url":"/seb-introduction","dataUrl":"/seb-introduction.json","key":"kmCM5TBRsn"},{"type":"text","value":" we can caluculate the time series of canopy structural variables needed to compute the shadowing as shown in ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fwgceWXdhH"},{"type":"crossReference","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Figure ","key":"xlFF3AUl5e"},{"type":"text","value":"1","key":"iJ6VcGEd3s"}],"identifier":"row-crop-model","label":"row-crop-model","kind":"figure","template":"Figure %s","enumerator":"1","resolved":true,"html_id":"row-crop-model","remote":true,"url":"/b01-row-crops","dataUrl":"/b01-row-crops.json","key":"wMINHwBgTt"}],"key":"K7j1qBqTxj"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"GT4IuOqsaI"}],"key":"yicEfCcV3k"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"These equations are site specific and most likely not applicable to other sites and crops. For operational purposes, such as using Earth Observation/satellite data a trade-off must be made between accuracy and applicability.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"FG8X9FQqxg"}],"key":"viZY0CH2Fq"}],"class":"dropdown","key":"EM46Pzc2oV"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"We already have a ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"Rj11Kh9fpB"},{"type":"inlineMath","value":"f_c","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>f</mi><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">f_c</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"CgTawv16TO"},{"type":"text","value":" map we can skip such computation:","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"c5QMGApXQY"}],"key":"LcT1ysD3Dv"}],"key":"lzYIRvJaLS"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Compute the expected minimum and maximum canopy cover based on mininum and maximum canopy width\nfc_min = wc_min / interrow\nfc_max = wc_max / interrow\nh_c, hb_ratio, _ = lai_2_canopy(lai,\n                                hc_min,\n                                fc_min,\n                                fc_max)\n# Ensure that both canopy height and cover are within the limits\nh_c = np.clip(h_c, hc_min, hc_max)\nprint(\"Computed canopy height\")","key":"qZAJ9PVvl4"},{"type":"output","id":"ahL27HtoTv2X_8SXfwTM2","data":[],"key":"cyrZaivjhQ"}],"key":"G5qJmWqx9K"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We can get the shortwave net radiation for row crops","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ei9SVl6XfV"}],"identifier":"we-can-get-the-shortwave-net-radiation-for-row-crops","label":"We can get the shortwave net radiation for row crops","html_id":"we-can-get-the-shortwave-net-radiation-for-row-crops","implicit":true,"key":"LvuHFsiZ9G"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"This step is very similar to previous exercies, but since we are working with a single scene of small extension, we can assume a constant value for the weather forcing:","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"fsnXCeKOg9"}],"key":"XdO27WMUjm"},{"type":"container","kind":"table","children":[{"type":"table","position":{"start":{"line":6,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"tableRow","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"tableCell","header":true,"align":"left","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"TA (K)","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"RLtEXlEx3v"}],"key":"eW4bPoZ8ce"},{"type":"tableCell","header":true,"align":"left","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"WS (m s","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"wMmwWUS2w6"},{"type":"inlineMath","value":"^{-1}","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mrow></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding=\"application/x-tex\">^{-1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span></span></span></span>","key":"jGptP8Umpm"},{"type":"text","value":")","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"NoQV2smWeQ"}],"key":"AtGBnQXYRC"},{"type":"tableCell","header":true,"align":"left","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"EA (kPa)","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"wqmjPirdIl"}],"key":"pbBet0VBbi"},{"type":"tableCell","header":true,"align":"left","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"PA (kPa)","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"MmgalZueIf"}],"key":"EylRANeCVx"},{"type":"tableCell","header":true,"align":"left","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"SW_IN (W m","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"Moc5sy5TtL"},{"type":"inlineMath","value":"^{-2}","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mrow></mrow><mrow><mo>−</mo><mn>2</mn></mrow></msup></mrow><annotation encoding=\"application/x-tex\">^{-2}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span></span>","key":"HaMG6Im9Tj"},{"type":"text","value":")","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"m5xi8Euobl"}],"key":"sMY5hUWTW4"},{"type":"tableCell","header":true,"align":"left","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"SW_IN_DD (W m","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"rBEcTEVbIB"},{"type":"inlineMath","value":"^{-2}","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mrow></mrow><mrow><mo>−</mo><mn>2</mn></mrow></msup></mrow><annotation encoding=\"application/x-tex\">^{-2}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span></span>","key":"CMbBLfVTL3"},{"type":"text","value":")","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"aylx8kffxf"}],"key":"tRoymUr2hl"}],"key":"ErdvuMlIa7"},{"type":"tableRow","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"tableCell","align":"left","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"291.11","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"zaw4QnIbqx"}],"key":"nzXuPQPvRs"},{"type":"tableCell","align":"left","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"2.15","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"r5lTLYJHYJ"}],"key":"hpyI6wtFHy"},{"type":"tableCell","align":"left","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"13.4","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"z1bgJFLq2k"}],"key":"Bkb6EJ358z"},{"type":"tableCell","align":"left","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"1011","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"yPBWZVtBSB"}],"key":"XBByXeHysN"},{"type":"tableCell","align":"left","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"861.74","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"AewoWYUsLY"}],"key":"Pkgs2QW9B0"},{"type":"tableCell","align":"left","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"304.97","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"DhF5LGOo7d"}],"key":"skVXpnOoXw"}],"key":"c2ljY0pcWv"}],"key":"ZVFvK6RX1f"}],"label":"Weater forcing at the UAV overpass. Info can be obtained from the pyTSEB local image configuration file at [](./input/pytseb_config_LocalImage.txt)","identifier":"weater forcing at the uav overpass. info can be obtained from the pytseb local image configuration file at [](./input/pytseb_config_localimage.txt)","enumerator":"2","html_id":"weater-forcing-at-the-uav-overpass-info-can-be-obtained-from-the-pytseb-local-image-configuration-file-at-input-pytseb-config-localimage-txt","key":"xWzkUaoCCN"}],"key":"OUaBtocQcW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from pyTSEB import TSEB\n\n# Define the date and acquisiton time\ndoy = 221\t\ntime = 10.9992\t\nsdtlon = -105\n\n# Define the weather forcing, and broacast the value to a numpy array of same size as the inputs\n# Shortwave irradiance\nsw_in = 861.74 \nsw_in = np.full_like(lai, sw_in)\n\n# Air temperature\nta = 299.18\nta = np.full_like(lai, ta)\n\n# Amospheric vapour pressure\nea = 13.4\nea = np.full_like(lai, ea)\n\n# Surface pressure\npa = 1011.\npa = np.full_like(lai, pa)\n\n# Wind speed\nws = 2.15\nws = np.full_like(ws, ws)\n\n# And we compute the downwelling longwave irradiance\ne_atm = TSEB.rad.calc_emiss_atm(ea, ta)\nlw_in = e_atm * TSEB.met.calc_stephan_boltzmann(ta)\n\nprint(\"Retrieved all the required weather forcint\")","key":"FQFkKlpKVV"},{"type":"output","id":"Nq9m16y59rH0qhsilnc6h","data":[],"key":"wblUS3OR7B"}],"key":"urDEKU9Y3j"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"...and now we get the shorwave net radioation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PeboPiQKxo"}],"key":"pcJysBpiHh"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"uXe3hGjAbT"}],"key":"ARnEDk3Yz1"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"check that the code is the same as when we worked with a timeseries of in situ observations","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"EhsDhPlOAE"}],"key":"HkJq5rClxH"}],"key":"LEP72ZVJbQ"}],"key":"PBpDuOrIYE"},{"type":"block","kind":"notebook-code","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"from pyTSEB import TSEB\n\n# We can get the leaf and soil spectral from the values above, or hard code the corresponding values\nrho_leaf_vis = 0.054\nrho_leaf_nir = 0.262\ntau_leaf_vis = 0.038\ntau_leaf_nir = 0.333\nrho_soil_vis = 0.07\nrho_soil_nir = 0.32\n\n# canopy width\nw_c = f_c * interrow\n# Canopy width to height ratio\nw_c_ratio = w_c / (h_c - hb_ratio * h_c)\n# Local LAI\nF = lai / f_c\n\n# The time zone is PST, which corresponds to -120 deg, time longitude\nstdlon = -120\n# Call calc_sun_angles based on site coordinates and timestamp\nsza, saa = TSEB.met.calc_sun_angles(\n    np.full_like(lai, lat),\n    np.full_like(lai, lon),\n    np.full_like(lai, stdlon),\n    doy,\n    time)\n\n# Compute the relative sun-row azimuth angle\npsi = row_direction - saa\n# Compute the clumping index for row crops\nomega = TSEB.CI.calc_omega_rows(lai, f_c, theta=sza,\n                                psi=psi, w_c=w_c_ratio)\n\n# And the effective LAI is the product of local LAI and the clumping index\nlai_eff = F * omega\n\n# Estimates the direct and diffuse solar radiation\ndifvis, difnir, fvis, fnir = TSEB.rad.calc_difuse_ratio(sw_in,\n                                                        sza,\n                                                        press=np.full_like(sza, 1013.15))\npar_dir = fvis * (1. - difvis) * sw_in\nnir_dir = fnir * (1. - difnir) * sw_in\npar_dif = fvis * difvis * sw_in\nnir_dif = fnir * difnir * sw_in\n\n# Compute the canopy and soil net radiation using Cambpell RTM\nsn_c, sn_s = TSEB.rad.calc_Sn_Campbell(lai,\n                                       sza,\n                                       par_dir + nir_dir,\n                                       par_dif + nir_dif,\n                                       fvis,\n                                       fnir,\n                                       np.full_like(sza, rho_leaf_vis),\n                                       np.full_like(sza, tau_leaf_vis),\n                                       np.full_like(sza, rho_leaf_nir),\n                                       np.full_like(sza, tau_leaf_nir),\n                                       np.full_like(sza, rho_soil_vis),\n                                       np.full_like(sza, rho_soil_nir),\n                                       x_LAD=1,\n                                       LAI_eff=lai_eff)\n\nsn_c[~np.isfinite(sn_c)] = 0\nsn_s[~np.isfinite(sn_s)] = 0\nprint(\"Finished computing net shortwave radiation\")","visibility":"show","key":"fRdk84X5Mr"},{"type":"output","id":"24QT_Kpvam-S7iawFSExD","data":[],"visibility":"show","key":"gKYu7kK8ZN"}],"visibility":"show","key":"uyxDyfaBwP"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Set additional site parameters needed for TSEB","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RYHzdEUe6b"}],"identifier":"set-additional-site-parameters-needed-for-tseb","label":"Set additional site parameters needed for TSEB","html_id":"set-additional-site-parameters-needed-for-tseb","implicit":true,"key":"CbOiH3n6R6"}],"key":"X5pnBTaX0U"},{"type":"block","kind":"notebook-code","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Grapevine leaf width\nleaf_width = 0.10\n\n# Roughness for bare soil\nz0_soil = 0.15\n\n# Kustas and Norman boundary layer resistance parameters\nroil_resistance_c_param = 0.0038\nroil_resistance_b_param = 0.012\nroil_resistance_cprime_param = 90.\n# Thermal spectra\ne_v = 0.99  # Leaf emissivity\ne_s = 0.94  # Soil emissivity\n\nprint(\"TSEB parameters registered in memory\")","visibility":"show","key":"Zx1DmFgI5A"},{"type":"output","id":"1aEbu4ofKDjBIAyxMR1-I","data":[],"visibility":"show","key":"XA9wGp8jvt"}],"visibility":"show","key":"acP2v3CeZM"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Estimate surface aerodynamic roughness","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"i9Y0HPgY39"}],"identifier":"estimate-surface-aerodynamic-roughness","label":"Estimate surface aerodynamic roughness","html_id":"estimate-surface-aerodynamic-roughness","implicit":true,"key":"U91zJtYpWL"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"We estimate aerodynamic roughness for tall canopies based on ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"nF0adWUp1Y"},{"type":"cite","url":"https://doi.org/10.1007/BF00709229","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Raupach (1994)","key":"coIhG4hIym"}],"kind":"narrative","label":"Raupach_1994","identifier":"https://doi.org/10.1007/BF00709229","enumerator":"3","key":"V28Vs04MPT"},{"type":"text","value":" and ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"wfMAtHJAuB"},{"type":"link","url":"https://doi.org/10.1016/S0168-1923(00)00153-2.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[],"urlSource":"http://dx.doi.org/10.1016/S0168-1923(00)00153-2.","data":{"doi":"10.1016/S0168-1923(00)00153-2."},"internal":false,"protocol":"doi","key":"n0CmyPI9I9"},{"type":"text","value":":","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"dSWHbpTfSP"}],"key":"Onxan72jN1"}],"key":"cOWIBNxcLD"},{"type":"block","kind":"notebook-code","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"z_0m, d_0 = TSEB.res.calc_roughness(lai, h_c, w_c_ratio, np.full_like(lai, TSEB.res.BROADLEAVED_D), f_c=f_c)\n# Ensure realistic values\nd_0[d_0 < 0] = 0\nz_0m[np.isnan(z_0m)] = z0_soil\nz_0m[z_0m < z0_soil] = z0_soil\nprint(f\"Computed aerodynamic roughness\")","visibility":"show","key":"LC4b7S8z12"},{"type":"output","id":"XfcU72xNWU0vPXBq1D9ZX","data":[],"visibility":"show","key":"vaJRn77DCX"}],"visibility":"show","key":"U8DWqs2rNZ"},{"type":"block","kind":"notebook-content","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We read the canopy and soil temperatures","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qYGoScAfsu"}],"identifier":"we-read-the-canopy-and-soil-temperatures","label":"We read the canopy and soil temperatures","html_id":"we-read-the-canopy-and-soil-temperatures","implicit":true,"key":"uaX2nP6Pfd"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"The canopy and soil temperatures were created in exercise ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"k52evIunr9"},{"type":"link","url":"./501-canopy_and_soil_temperatures.ipynb","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"501​-canopy​_and​_soil​_temperatures","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"d3fPXfkunJ"}],"urlSource":"./501-canopy_and_soil_temperatures.ipynb","key":"thrr4Stn9s"},{"type":"text","value":". As reminder these data were stored in a 3-band GeoTIFF file, with bands:","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"bIAmA0PpsZ"}],"key":"muu9lIZFLA"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Leaf Temperature (K)","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Ij95n9Wci1"}],"key":"cmYZPLhOdQ"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Soil Temperature (K)","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"dsKDERxn6D"}],"key":"ILVYdAE7ob"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Local correlation between lst and vnir inputs","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"HGsBf0ru0W"}],"key":"sWDqc84jeG"}],"key":"Tz7ujBKfwf"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"So we will need to read the first two bands and stored them in two variables, ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"xSzObhaUTg"},{"type":"inlineCode","value":"t_c","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"fR4hp7NfrA"},{"type":"text","value":" and ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"yKSZRLksWY"},{"type":"inlineCode","value":"t_s","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"ya8izzc9oj"},{"type":"text","value":":","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"U6LmCQakvr"}],"key":"lkmfSkifLp"}],"visibility":"show","key":"mvuV1iegWi"},{"type":"block","kind":"notebook-code","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Define the input canopy and soil temperature rater\nuav_dir = workdir / \"input\" / \"UAV\" \n\ntc_ts_file = uav_dir / \"SLM_001_002_20140809_1041_TC-TS.tif\"\n\nfid = gdal.Open(str(tc_ts_file), gdal.GA_ReadOnly)\n# Read and store the 1st band (canopy temperature) in a numpy array\nt_c = fid.GetRasterBand(1).ReadAsArray()\n# Read and store the 2nd band (soil temperature) in a numpy array\nt_s = fid.GetRasterBand(2).ReadAsArray()\ndel fid\n\n# And it is assuming that the UAV mosaci is mostly looking at nadir\nvza = np.zeros_like(t_c)\nprint(\"Read the t_c and t_s temperatures\")","visibility":"show","key":"Fy3xP8ZxWk"},{"type":"output","id":"ve24G8abCkUeZsHIy8VJA","data":[],"visibility":"show","key":"gEJNKQOjZj"}],"visibility":"show","key":"Tq9YENWX9a"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(t_s)","key":"RszSDVXDay"},{"type":"output","id":"MDHMNryUQPx9APF6zTECc","data":[],"key":"HEcYdNTYGf"}],"key":"DXAYZavyaw"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We run now TSEB-2T","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cXzm4KnT6Y"}],"identifier":"we-run-now-tseb-2t","label":"We run now TSEB-2T","html_id":"we-run-now-tseb-2t","implicit":true,"key":"WRS19TqhfD"},{"type":"admonition","kind":"seealso","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"See Also","key":"gvfhtmXHSy"}],"key":"GOk2mcekTS"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"The full code for the TSEB-2T is at the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ErTK7B3Wos"},{"type":"link","url":"https://github.com/hectornieto/pyTSEB/blob/382e4fc01e965143ebafdaefe5be9b45c737455a/pyTSEB/TSEB.py#L144","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"pyTSEB GitHub repository","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"YvC5YLhReD"}],"urlSource":"https://github.com/hectornieto/pyTSEB/blob/382e4fc01e965143ebafdaefe5be9b45c737455a/pyTSEB/TSEB.py#L144","data":{"kind":"file","org":"hectornieto","repo":"pyTSEB","reference":"382e4fc01e965143ebafdaefe5be9b45c737455a","file":"pyTSEB/TSEB.py","from":144,"raw":"https://raw.githubusercontent.com/hectornieto/pyTSEB/382e4fc01e965143ebafdaefe5be9b45c737455a/pyTSEB/TSEB.py"},"internal":false,"protocol":"github","key":"JLBsBE000p"}],"key":"pxmYqkLzWY"}],"class":"dropdown","key":"UdyUdZ33zA"}],"key":"BXR9vtcGyb"},{"type":"block","kind":"notebook-code","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"resistance_flag = [0, {\"KN_c\": np.full_like(t_c, roil_resistance_c_param),\n                       \"KN_b\": np.full_like(t_c, roil_resistance_b_param),\n                       \"KN_C_dash\": np.full_like(t_c, roil_resistance_cprime_param)}]\n\n# Run TSEB-2T\n[flag_2t, t_ac_2t, ln_s_2t, ln_c_2t, le_c_2t, h_c_2t, le_s_2t, h_s_2t, g_2t,\n r_s_2t, r_x_2t, r_a_2t, u_friction_2t, lmo_2t, n_iterations_2t] = TSEB.TSEB_2T(                                                     \n     t_c,\n     t_s,\n     ta,\n     ws,\n     ea,\n     pa,\n     sn_c,\n     sn_s,\n     lw_in,\n     lai,\n     h_c,\n     e_v,\n     e_s,\n     z_0m,\n     d_0,\n     zm,\n     zh,\n     x_LAD=np.ones_like(t_c),\n     f_c=f_c,\n     f_g=np.ones_like(t_c),\n     w_C=w_c_ratio,\n     leaf_width=leaf_width,\n     z0_soil=z0_soil,\n     resistance_form=resistance_flag,\n     calcG_params=[[1], 0.35])\n\n# ... and finally we compute the bulk fluxes\nle_2t = le_c_2t + le_s_2t\nh_2t = h_c_2t + h_s_2t\nnetrad_2t = sn_c + sn_s + ln_c_2t + ln_s_2t","visibility":"show","key":"fVCDlQzKvL"},{"type":"output","id":"Ql2y0VP3l8RapkiuZ17Ez","data":[],"visibility":"show","key":"xA8CdHGmJT"}],"visibility":"show","key":"OhNMYiOPO5"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"... and to compare we also run TSEB-PT","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LEKQIRaXx4"}],"identifier":"id-and-to-compare-we-also-run-tseb-pt","label":"... and to compare we also run TSEB-PT","html_id":"id-and-to-compare-we-also-run-tseb-pt","implicit":true,"key":"kRqMeRgJjI"}],"key":"FP5zzgfkSP"},{"type":"block","kind":"notebook-code","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Define the input composte radiometric temperature\nlst_file = input_dir / \"ExampleImage_Trad_pm.tif\"\n\nfid = gdal.Open(str(lst_file), gdal.GA_ReadOnly)\n# Read and store the 1st band (canopy temperature) in a numpy array\nlst = fid.GetRasterBand(1).ReadAsArray()\n\n\n# Run TSEB-PT\nalpha_PT_0 = 1.26\n[flag_pt, ts_pt, tc_pt, t_ac_pt, ln_s_pt, ln_c_pt, le_c_pt, h_c_pt, le_s_pt, h_s_pt, g_pt,\n r_s_pt, r_x_pt, r_a_pt, u_friction_pt, lmo_pt, n_iterations_pt] = TSEB.TSEB_PT(                                                     \n     lst,\n     vza,\n     ta,\n     ws,\n     ea,\n     pa,\n     sn_c,\n     sn_s,\n     lw_in,\n     lai,\n     h_c,\n     e_v,\n     e_s,\n     z_0m,\n     d_0,\n     zm,\n     zh,\n     x_LAD=np.ones_like(lst),\n     f_c=f_c,\n     f_g=np.ones_like(lst),\n     w_C=w_c_ratio,\n     leaf_width=leaf_width,\n     z0_soil=z0_soil,\n     alpha_PT=alpha_PT_0,\n     resistance_form=resistance_flag,\n     calcG_params=[[1], 0.35])\n\n# ... and we compute the bulk fluxes\nle_pt = le_c_pt + le_s_pt\nh_pt = h_c_pt + h_s_pt\nnetrad_pt = sn_c + sn_s + ln_c_pt + ln_s_pt","visibility":"show","key":"XxRiip3nqJ"},{"type":"output","id":"Ei3GpQGZIFjQERD5jiKRg","data":[],"visibility":"show","key":"U855GYwVgZ"}],"visibility":"show","key":"M4kzhi6PvO"},{"type":"block","kind":"notebook-content","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We compare both models","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AhZmggzNFT"}],"identifier":"we-compare-both-models","label":"We compare both models","html_id":"we-compare-both-models","implicit":true,"key":"Xi4NG9M0hV"}],"visibility":"show","key":"AaIiARwgJP"},{"type":"block","kind":"notebook-code","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Change to have a different colour stretch\nhigh_flux=600 # Maximum flux value in the display\nlow_flux=0 # Minimum flux value in the display\n\nfrom bokeh.plotting import *\nfrom bokeh.palettes import RdYlBu11 as colortable\nfrom bokeh.models.mappers import LinearColorMapper\nfrom bokeh.io import output_notebook\nfrom bokeh.resources import INLINE\noutput_notebook(resources=INLINE)\n\ncolortable = list(reversed(colortable))\nmap_le = LinearColorMapper(palette=colortable,high=high_flux,low=low_flux)\nrows, cols = le_2t.shape\n\n# Setup the figure\ns1 = figure(title=\"TSEB-PT LE\",width=cols, height=rows, x_range=[0, cols], y_range=[0, rows])\ns1.axis.visible = False\ns1.image(image=[np.flipud(le_pt)],x=[0],y=[0],dw=cols,dh=rows,color_mapper=map_le)\ns2 = figure(title=\"TSEB-2T LE\",width=cols, height=rows, x_range=s1.x_range, y_range=s1.y_range)\ns2.axis.visible = False\ns2.image(image=[np.flipud(le_2t)],x=[0],y=[0],dw=[cols],dh=[rows],color_mapper=map_le)\ns3 = figure(title=\"TSEB-PT H\",width=cols, height=rows, x_range=s1.x_range, y_range=s1.y_range)\ns3.image(image=[np.flipud(h_pt)],x=[0],y=[0],dw=[cols],dh=[rows],color_mapper=map_le)\ns3.axis.visible = False\ns4 = figure(title=\"TSEB-2T H\",width=cols, height=rows, x_range=s1.x_range, y_range=s1.y_range)\ns4.image(image=[np.flipud(h_2t)],x=[0],y=[0],dw=[cols],dh=[rows],color_mapper=map_le)\ns4.axis.visible = False\np = gridplot([[s1, s2],[s3,s4]], toolbar_location='above')\n\n# Add a colormap legend\ny = np.linspace(low_flux,high_flux,len(colortable))\ndy = y[1]-y[0]\nramp = figure(tools=\"\", y_range = [0, 1], x_range = [low_flux,high_flux], width = 650, height=100)\nramp.toolbar_location = None\nramp.yaxis.visible = False\nramp.rect(x=y, y=0.5, color=colortable, width=dy, height = 1)\n\nshow(p)\nshow(ramp);","visibility":"show","key":"aB5IJpDx3t"},{"type":"output","id":"kqfoNuURCPjc2KJOf5EDc","data":[],"visibility":"show","key":"krwBzGz6wr"}],"visibility":"show","key":"zzkPQZ9E5A"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Save the TSEB-2T outputs","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bjfstsmAbW"}],"identifier":"save-the-tseb-2t-outputs","label":"Save the TSEB-2T outputs","html_id":"save-the-tseb-2t-outputs","implicit":true,"key":"adiCb6AEux"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"To conclude we will save our TSEB outputs to single band GeoTIFF files:","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Q40kHGeZPK"}],"key":"vbHVR2nmoB"}],"key":"UwWHm4VgOj"},{"type":"block","kind":"notebook-code","data":{"editable":true,"slideshow":{"slide_type":""},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Set the output \noutdir = workdir / \"output\"\nif not outdir.exists():\n    outdir.mkdir()\n    \ndriver = gdal.GetDriverByName(\"GTiff\")\n\n# Latent heat flux\nout_file = outdir / \"SLM_001_002_20140809_1041_LE.tif\"\nfid = driver.Create(str(out_file), t_c.shape[1], t_c.shape[0], 1,\n                    gdal.GDT_Float32)\nfid.SetProjection(proj)\nfid.SetGeoTransform(gt)\nfid.GetRasterBand(1).WriteArray(le_2t)\n\n# Sensible heat flux\nout_file = outdir / \"SLM_001_002_20140809_1041_H.tif\"\nfid = driver.Create(str(out_file), t_c.shape[1], t_c.shape[0], 1,\n                    gdal.GDT_Float32)\nfid.SetProjection(proj)\nfid.SetGeoTransform(gt)\nfid.GetRasterBand(1).WriteArray(h_2t)\n\n# Net Radiation\nout_file = outdir / \"SLM_001_002_20140809_1041_NETRAD.tif\"\nfid = driver.Create(str(out_file), t_c.shape[1], t_c.shape[0], 1,\n                    gdal.GDT_Float32)\nfid.SetProjection(proj)\nfid.SetGeoTransform(gt)\nfid.GetRasterBand(1).WriteArray(netrad_2t)\n\n# Ground heat flux\nout_file = outdir / \"SLM_001_002_20140809_1041_G.tif\"\nfid = driver.Create(str(out_file), t_c.shape[1], t_c.shape[0], 1,\n                    gdal.GDT_Float32)\nfid.SetProjection(proj)\nfid.SetGeoTransform(gt)\nfid.GetRasterBand(1).WriteArray(g_2t)\n\ndel fid\n\nprint(f\"TSEB-2T fluxes saved at {out_file}\")","visibility":"show","key":"WxPTiUEwXy"},{"type":"output","id":"QttRawIghXNBD4MJrqb4t","data":[],"visibility":"show","key":"crlwQhggg4"}],"visibility":"show","key":"BoVqfJJxAF"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Conclusions","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EzvbkbQ8rO"}],"identifier":"conclusions","label":"Conclusions","html_id":"conclusions","implicit":true,"key":"PCOLu5Nt2u"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In this exercise we learned a new TSEB version available in pyTSEB","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"YRWUpCjQfi"}],"key":"irytGJJ4sN"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"In addition, we saw that running the model over an image insteaf of a timeseries is practically the same","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"ETiNxRVsfI"}],"key":"KWSYI8nL9E"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"[...]","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"mm7RzN5NaF"}],"key":"a3EURzIZYN"}],"key":"Ug5K4PUiEZ"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"STgRgFn8aG"}],"key":"daHs6MsHhv"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Please feel free comment any thoughts. This is work in progress!!!","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"GYsdtsFC4y"}],"key":"bWuYjCm6zW"}],"key":"Btyn1leJpO"}],"key":"UOSo6V3f9E"}],"key":"cNYEMapny7"},"references":{"cite":{"order":["Nieto_2018","Shuttleworth_1985","Raupach_1994"],"data":{"Nieto_2018":{"label":"Nieto_2018","enumerator":"1","doi":"10.1007/s00271-018-0585-9","html":"Nieto, H., Kustas, W. P., Torres-Rúa, A., Alfieri, J. G., Gao, F., Anderson, M. C., White, W. A., Song, L., Alsina, M. del M., Prueger, J. H., McKee, M., Elarab, M., & McKee, L. G. (2018). Evaluation of TSEB turbulent fluxes using different methods for the retrieval of soil and canopy component temperatures from UAV thermal and multispectral imagery. <i>Irrigation Science</i>, <i>37</i>(3), 389–406. <a target=\"_blank\" rel=\"noreferrer\" href=\"https://doi.org/10.1007/s00271-018-0585-9\">10.1007/s00271-018-0585-9</a>","url":"https://doi.org/10.1007/s00271-018-0585-9"},"Shuttleworth_1985":{"label":"Shuttleworth_1985","enumerator":"2","doi":"10.1002/qj.49711146910","html":"Shuttleworth, W. J., & Wallace, J. S. (1985). Evaporation from sparse crops‐an energy combination theory. <i>Quarterly Journal of the Royal Meteorological Society</i>, <i>111</i>(469), 839–855. <a target=\"_blank\" rel=\"noreferrer\" href=\"https://doi.org/10.1002/qj.49711146910\">10.1002/qj.49711146910</a>","url":"https://doi.org/10.1002/qj.49711146910"},"Raupach_1994":{"label":"Raupach_1994","enumerator":"3","doi":"10.1007/bf00709229","html":"Raupach, M. R. (1994). Simplified expressions for vegetation roughness length and zero-plane displacement as functions of canopy height and area index. <i>Boundary-Layer Meteorology</i>, <i>71</i>(1–2), 211–216. <a target=\"_blank\" rel=\"noreferrer\" href=\"https://doi.org/10.1007/bf00709229\">10.1007/bf00709229</a>","url":"https://doi.org/10.1007/bf00709229"}}}}}